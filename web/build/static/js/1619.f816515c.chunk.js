"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[1619],{16018:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(93766),n=s(21215),r=s.n(n);class i{constructor(e){this.group="",this.getById=async e=>{let t=await a.A.get("/".concat(this.group,"/").concat(e));if(1===t.code)return t.data},this.getPaging=async e=>{let t=r().stringify(e),s=await a.A.get("/".concat(this.group,"/paging?").concat(t));return 1!==s.code?{}:s.data},this.getAll=async()=>{let e=await a.A.get("/".concat(this.group));return 1!==e.code?[]:e.data},this.create=async e=>1===(await a.A.post("/".concat(this.group),e)).code,this.updateById=async(e,t)=>1===(await a.A.put("/".concat(this.group,"/").concat(e),t)).code,this.deleteById=async e=>1===(await a.A.delete("/".concat(this.group,"/").concat(e))).code,this.group=e}}},85067:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(93766);const n=new class{constructor(){this.group="permissions",this.getMenus=async()=>{let e=await a.A.get("/menus");return 1!==e.code?[]:e.data}}}},43868:(e,t,s)=>{s.d(t,{A:()=>i});var a=s(93766),n=s(16018);class r extends n.A{constructor(){super("roles"),this.GetAll=async()=>{let e=await a.A.get("/".concat(this.group));return 1!==e.code?[]:e.data}}}const i=new r},11619:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var a=s(9950),n=s(68832),r=s(56231),i=s(48538),l=s(42074),c=s(27666),o=s(43868),d=s(87827),u=s(87427),h=s(55902),g=s(73049),A=s(85067),m=s(41920),y=s(98409),p=s(44414);const S=o.A,f={labelCol:{span:4},wrapperCol:{span:18}},x=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e)return[];for(const a of e){if(s.push(a.key),t(a))return s;if(a.children){const e=x(a.children,t,s);if(e.length)return e}s.pop()}return[]},I=e=>{let{visible:t,handleOk:s,handleCancel:n,confirmLoading:r,id:i}=e;const[l]=d.A.useForm();let[c,o]=(0,a.useState)([]);(0,m.useQuery)("roleQuery",(()=>S.getById(i)),{enabled:t&&y.A.hasText(i),onSuccess:e=>{l.setFieldsValue(e);let t=[];for(let s=0;s<e.menus.length;s++)!0===e.menus[s].checked&&t.push(e.menus[s].menuId);o(t)}});let I=(0,m.useQuery)("menuQuery",A.A.getMenus,{enabled:t});return(0,p.jsx)(u.A,{width:960,title:i?"\u66f4\u65b0\u89d2\u8272":"\u65b0\u5efa\u89d2\u8272",visible:t,maskClosable:!1,destroyOnClose:!0,onOk:()=>{l.validateFields().then((async e=>{await s(e)&&l.resetFields()}))},onCancel:()=>{l.resetFields(),o([]),n()},confirmLoading:r,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,p.jsxs)(d.A,{form:l,...f,children:[(0,p.jsx)(d.A.Item,{name:"id",noStyle:!0,children:(0,p.jsx)(h.A,{hidden:!0})}),(0,p.jsx)(d.A.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"}],children:(0,p.jsx)(h.A,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0"})}),(0,p.jsx)(d.A.Item,{label:"\u6743\u9650",name:"menus",rules:[{required:!0}],children:(0,p.jsx)(g.A,{checkable:!0,onCheck:e=>{let t=new Set;for(let s=0;s<e.length;s++){let a=e[s],n=x(I.data,(e=>e.key===a));for(let e=0;e<n.length;e++){let s=n[e];e+1===n.length?t.add(JSON.stringify({menuId:s,checked:!0})):t.add(JSON.stringify({menuId:s,checked:!1}))}}console.log(t),o(e),l.setFieldsValue({menus:Array.from(t).map((e=>JSON.parse(e)))})},checkedKeys:c,treeData:I.data})})]})})};var O=s(27891),C=s(50070),E=s(68201);const j=o.A,{Content:w}=n.A,N=a.createRef(),k=()=>{let[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[o,d]=(0,a.useState)(void 0);const[u,h]=(0,O.j)(O.A.ROLE),g=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u540d\u79f0",dataIndex:"name",render:(e,t)=>{let s=(0,p.jsx)("div",{children:e});return(0,C.as)("role-detail")&&(s=(0,p.jsx)(l.N_,{to:"/role/".concat(t.id),children:e})),s}},{title:"\u7c7b\u578b",dataIndex:"type",valueType:"radio",sorter:!0,valueEnum:{default:{text:"\u5185\u7f6e\u89d2\u8272"},new:{text:"\u7528\u6237\u6dfb\u52a0"}}},{title:"\u521b\u5efa\u65f6\u95f4",key:"created",dataIndex:"created",hideInSearch:!0},{title:"\u64cd\u4f5c",valueType:"option",key:"option",render:(e,s,a,n)=>[(0,p.jsx)(E.A,{menu:"role-detail",children:(0,p.jsx)(l.N_,{to:"/role/".concat(s.id),children:"\u8be6\u60c5"},"get")},"role-get"),(0,p.jsx)(E.A,{menu:"role-edit",children:(0,p.jsx)("a",{disabled:!s.modifiable,onClick:()=>{t(!0),d(s.id)},children:"\u7f16\u8f91"},"edit")},"role-edit"),(0,p.jsx)(E.A,{menu:"role-del",children:(0,p.jsx)(r.A,{title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64\u884c\u5417?",onConfirm:async()=>{await j.deleteById(s.id),N.current.reload()},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",children:(0,p.jsx)("a",{disabled:!s.deletable,className:"danger",children:"\u5220\u9664"},"delete")},"confirm-delete")},"role-del")]}];return(0,p.jsxs)(w,{className:"page-container",children:[(0,p.jsx)(c.A,{columns:g,actionRef:N,columnsState:{value:u,onChange:h},request:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,s="",a="";Object.keys(t).length>0&&(s=Object.keys(t)[0],a=Object.values(t)[0]);let n={pageIndex:e.current,pageSize:e.pageSize,name:e.name,type:e.type,field:s,order:a},r=await j.getPaging(n);return{data:r.items,success:!0,total:r.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10},dateFormatter:"string",headerTitle:"\u89d2\u8272\u5217\u8868",toolBarRender:()=>[(0,p.jsx)(E.A,{menu:"role-add",children:(0,p.jsx)(i.A,{type:"primary",onClick:()=>{t(!0)},children:"\u65b0\u5efa"},"button")})]}),(0,p.jsx)(I,{id:o,visible:e,confirmLoading:s,handleCancel:()=>{t(!1),d(void 0)},handleOk:async e=>{n(!0);try{let s;s=e.id?await j.updateById(e.id,e):await j.create(e),s&&t(!1),N.current.reload()}finally{n(!1)}}})]})}},68201:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(50070);const n=e=>{let{menu:t,children:s}=e;if(Array.isArray(t)){if((0,a.as)(...t))return s}else if((0,a.as)(t))return s}},27891:(e,t,s)=>{s.d(t,{A:()=>i,j:()=>l});var a=s(98409),n=s(9950);let r=new class{constructor(){this.ASSET="cs-asset",this.CREDENTIAL="cs-credential",this.COMMAND="cs-command",this.ACCESS_GATEWAY="cs-access-gateway",this.ONLINE_SESSION="cs-online-session",this.OFFLINE_SESSION="cs-offline-session",this.LOGIN_LOG="cs-login-log",this.STORAGE_LOG="cs-storage-log",this.JOB="cs-job",this.STORAGE="cs-storage",this.LOGIN_POLICY="cs-login-policy",this.ACCESS_SECURITY="cs-access-security",this.USER="cs-user",this.ROLE="cs-role",this.USER_GROUP="cs-user-group",this.COMMAND_FILTER="cs-command-filter",this.STRATEGY="cs-strategy"}};const i=r,l=e=>{let[t,s]=(0,n.useState)(c(e));return[t,t=>{new Promise((e=>{s(t),e(t)})).then((t=>{o(e,t)}))}]},c=e=>{switch(e){case r.ASSET:case r.CREDENTIAL:case r.COMMAND:case r.ACCESS_GATEWAY:case r.ONLINE_SESSION:case r.OFFLINE_SESSION:}return d(e,{})},o=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},d=(e,t)=>{let s=localStorage.getItem(e);if(!a.A.hasText(s))return t;try{return JSON.parse(s)}catch(n){return t}}},98409:(e,t,s)=>{s.d(t,{A:()=>a});const a=new class{constructor(){this.hasText=function(e){return!(void 0===e||null===e||0===e.length)},this.zeroPad=function(e,t){let s=e.toString();for(;s.length<t;)s="0"+s;return s}}}}}]);