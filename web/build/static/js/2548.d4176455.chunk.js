(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[2548],{82548:e=>{var t;(t=t||{}).ArrayBufferReader=function(e){var t=this;e.onblob=function(e){for(var n=window.atob(e),r=new ArrayBuffer(n.length),i=new Uint8Array(r),o=0;o<n.length;o++)i[o]=n.charCodeAt(o);t.ondata&&t.ondata(r)},e.onend=function(){t.onend&&t.onend()},this.ondata=null,this.onend=null},(t=t||{}).ArrayBufferWriter=function(e){var n=this;function r(t){for(var n="",r=0;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);e.sendBlob(window.btoa(n))}e.onack=function(e){n.onack&&n.onack(e)},this.blobLength=t.ArrayBufferWriter.DEFAULT_BLOB_LENGTH,this.sendData=function(e){var t=new Uint8Array(e);if(t.length<=n.blobLength)r(t);else for(var i=0;i<t.length;i+=n.blobLength)r(t.subarray(i,i+n.blobLength))},this.sendEnd=function(){e.sendEnd()},this.onack=null},t.ArrayBufferWriter.DEFAULT_BLOB_LENGTH=6048,(t=t||{}).AudioContextFactory={singleton:null,getAudioContext:function(){var e=window.AudioContext||window.webkitAudioContext;if(e)try{return t.AudioContextFactory.singleton||(t.AudioContextFactory.singleton=new e),t.AudioContextFactory.singleton}catch(n){}return null}},(t=t||{}).AudioPlayer=function(){this.sync=function(){}},t.AudioPlayer.isSupportedType=function(e){return t.RawAudioPlayer.isSupportedType(e)},t.AudioPlayer.getSupportedTypes=function(){return t.RawAudioPlayer.getSupportedTypes()},t.AudioPlayer.getInstance=function(e,n){return t.RawAudioPlayer.isSupportedType(n)?new t.RawAudioPlayer(e,n):null},t.RawAudioPlayer=function(e,n){var r=t.RawAudioFormat.parse(n),i=t.AudioContextFactory.getAudioContext(),o=i.currentTime,a=new t.ArrayBufferReader(e),s=1===r.bytesPerSample?window.Int8Array:window.Int16Array,u=1===r.bytesPerSample?128:32768,c=[],l=function(){var e=function(e){if(e.length<=1)return e[0];var t=0;e.forEach((function(e){t+=e.length}));var n=0,r=new s(t);return e.forEach((function(e){r.set(e,n),n+=e.length})),r}(c);return e?(c=function(e){for(var t=Number.MAX_VALUE,n=e.length,i=Math.floor(e.length/r.channels),o=Math.floor(.02*r.rate),a=Math.max(r.channels*o,r.channels*(i-o));a<e.length;a+=r.channels){for(var u=0,c=0;c<r.channels;c++)u+=Math.abs(e[a+c]);u<=t&&(n=a+r.channels,t=u)}return n===e.length?[e]:[new s(e.buffer.slice(0,n*r.bytesPerSample)),new s(e.buffer.slice(n*r.bytesPerSample))]}(e),e=c.shift()):null};a.ondata=function(e){!function(e){c.push(new s(e))}(new s(e));var t=l();if(t){var n=i.currentTime;o<n&&(o=n);var a=i.createBufferSource();a.connect(i.destination),a.start||(a.start=a.noteOn),a.buffer=function(e){var t=e.length/r.channels,n=i.currentTime;o<n&&(o=n);for(var a=i.createBuffer(r.channels,t,r.rate),s=0;s<r.channels;s++)for(var c=a.getChannelData(s),l=s,h=0;h<t;h++)c[h]=e[l]/u,l+=r.channels;return a}(t),a.start(o),o+=t.length/r.channels/r.rate}},this.sync=function(){var e=i.currentTime;o=Math.min(o,e+.3)}},t.RawAudioPlayer.prototype=new t.AudioPlayer,t.RawAudioPlayer.isSupportedType=function(e){return!!t.AudioContextFactory.getAudioContext()&&null!==t.RawAudioFormat.parse(e)},t.RawAudioPlayer.getSupportedTypes=function(){return t.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]},(t=t||{}).AudioRecorder=function(){this.onclose=null,this.onerror=null},t.AudioRecorder.isSupportedType=function(e){return t.RawAudioRecorder.isSupportedType(e)},t.AudioRecorder.getSupportedTypes=function(){return t.RawAudioRecorder.getSupportedTypes()},t.AudioRecorder.getInstance=function(e,n){return t.RawAudioRecorder.isSupportedType(n)?new t.RawAudioRecorder(e,n):null},t.RawAudioRecorder=function(e,n){var r=this,i=t.RawAudioFormat.parse(n),o=t.AudioContextFactory.getAudioContext();navigator.mediaDevices||(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia).bind(navigator));var a=new t.ArrayBufferWriter(e),s=1===i.bytesPerSample?window.Int8Array:window.Int16Array,u=1===i.bytesPerSample?128:32768,c=0,l=0,h=null,d=null,f=null,p=function(e){if(0===e)return 1;var t=Math.PI*e;return Math.sin(t)/t},v=function(e,t){for(var n,r,i=(e.length-1)*t,o=Math.floor(i)-3+1,a=Math.floor(i)+3,s=0,u=o;u<=a;u++)s+=(e[u]||0)*(-(r=3)<(n=i-u)&&n<r?p(n)*p(n/r):0);return s},g=function(e){(f=o.createScriptProcessor(2048,i.channels,i.channels)).connect(o.destination),f.onaudioprocess=function(e){a.sendData(function(e){var t=e.length;c+=t;var n=Math.round(c*i.rate/e.sampleRate)-l;l+=n;for(var r=new s(n*i.channels),o=0;o<i.channels;o++)for(var a=e.getChannelData(o),h=o,d=0;d<n;d++)r[h]=v(a,d/(n-1))*u,h+=i.channels;return r}(e.inputBuffer).buffer)},(d=o.createMediaStreamSource(e)).connect(f),"suspended"===o.state&&o.resume(),h=e},y=function(){a.sendEnd(),r.onerror&&r.onerror()};a.onack=function(e){e.code!==t.Status.Code.SUCCESS||h?(!function(){if(d&&d.disconnect(),f&&f.disconnect(),h)for(var e=h.getTracks(),t=0;t<e.length;t++)e[t].stop();f=null,d=null,h=null,a.sendEnd()}(),a.onack=null,e.code===t.Status.Code.RESOURCE_CLOSED?r.onclose&&r.onclose():r.onerror&&r.onerror()):function(){var e=navigator.mediaDevices.getUserMedia({audio:!0},g,y);e&&e.then&&e.then(g,y)}()}},t.RawAudioRecorder.prototype=new t.AudioRecorder,t.RawAudioRecorder.isSupportedType=function(e){return!!t.AudioContextFactory.getAudioContext()&&null!==t.RawAudioFormat.parse(e)},t.RawAudioRecorder.getSupportedTypes=function(){return t.AudioContextFactory.getAudioContext()?["audio/L8","audio/L16"]:[]},(t=t||{}).BlobReader=function(e,t){var n,r=this,i=0;n=window.BlobBuilder?new BlobBuilder:window.WebKitBlobBuilder?new WebKitBlobBuilder:window.MozBlobBuilder?new MozBlobBuilder:new function(){var e=[];this.append=function(n){e.push(new Blob([n],{type:t}))},this.getBlob=function(){return new Blob(e,{type:t})}},e.onblob=function(t){for(var o=window.atob(t),a=new ArrayBuffer(o.length),s=new Uint8Array(a),u=0;u<o.length;u++)s[u]=o.charCodeAt(u);n.append(a),i+=a.byteLength,r.onprogress&&r.onprogress(a.byteLength),e.sendAck("OK",0)},e.onend=function(){r.onend&&r.onend()},this.getLength=function(){return i},this.getBlob=function(){return n.getBlob()},this.onprogress=null,this.onend=null},(t=t||{}).BlobWriter=function(e){var n=this,r=new t.ArrayBufferWriter(e);r.onack=function(e){n.onack&&n.onack(e)};this.sendBlob=function(e){var t=0,i=new FileReader,o=function(){if(t>=e.size)n.oncomplete&&n.oncomplete(e);else{var o=function(e,t,n){var r=(e.slice||e.webkitSlice||e.mozSlice).bind(e),i=n-t;if(i!==n){var o=r(t,i);if(o.size===i)return o}return r(t,n)}(e,t,t+r.blobLength);t+=r.blobLength,i.readAsArrayBuffer(o)}};i.onload=function(){r.sendData(i.result),r.onack=function(i){n.onack&&n.onack(i),i.isError()||(n.onprogress&&n.onprogress(e,t-r.blobLength),o())}},i.onerror=function(){n.onerror&&n.onerror(e,t,i.error)},o()},this.sendEnd=function(){r.sendEnd()},this.onack=null,this.onerror=null,this.onprogress=null,this.oncomplete=null},(t=t||{}).Client=function(e){var n=this,r=0,i=0,o=null,a={0:"butt",1:"round",2:"square"},s={0:"bevel",1:"miter",2:"round"},u=new t.Display,c={},l={},h={},d=[],f=[],p=[],v=new t.IntegerPool,g=[];function y(e){e!=r&&(r=e,n.onstatechange&&n.onstatechange(r))}function m(){return 3==r||2==r}this.exportState=function(e){var t={currentState:r,currentTimestamp:i,layers:{}},n={};for(var o in c)n[o]=c[o];u.flush((function(){for(var r in n){var i=parseInt(r),o=n[r],a=o.toCanvas(),s={width:o.width,height:o.height};o.width&&o.height&&(s.url=a.toDataURL("image/png")),i>0&&(s.x=o.x,s.y=o.y,s.z=o.z,s.alpha=o.alpha,s.matrix=o.matrix,s.parent=S(o.parent)),t.layers[r]=s}e(t)}))},this.importState=function(e,n){var o,a;for(o in r=e.currentState,i=e.currentTimestamp,c)(a=parseInt(o))>0&&u.dispose(c[o]);for(o in c={},e.layers){a=parseInt(o);var s=e.layers[o],l=w(a);if(u.resize(l,s.width,s.height),s.url&&(u.setChannelMask(l,t.Layer.SRC),u.draw(l,0,0,s.url)),a>0&&s.parent>=0){var h=w(s.parent);u.move(l,h,s.x,s.y,s.z),u.shade(l,s.alpha);var d=s.matrix;u.distort(l,d[0],d[1],d[2],d[3],d[4],d[5])}}u.flush(n)},this.getDisplay=function(){return u},this.sendSize=function(t,n){m()&&e.sendMessage("size",t,n)},this.sendKeyEvent=function(t,n){m()&&e.sendMessage("key",n,t)},this.sendMouseState=function(t,n){if(m()){var r=t.x,i=t.y;n&&(r/=u.getScale(),i/=u.getScale()),u.moveCursor(Math.floor(r),Math.floor(i));var o=0;t.left&&(o|=1),t.middle&&(o|=2),t.right&&(o|=4),t.up&&(o|=8),t.down&&(o|=16),e.sendMessage("mouse",Math.floor(r),Math.floor(i),o)}},this.sendTouchState=function(t,n){if(m()){var r=t.x,i=t.y;n&&(r/=u.getScale(),i/=u.getScale()),e.sendMessage("touch",t.id,Math.floor(r),Math.floor(i),Math.floor(t.radiusX),Math.floor(t.radiusY),t.angle,t.force)}},this.createOutputStream=function(){var e=v.next();return g[e]=new t.OutputStream(n,e)},this.createAudioStream=function(t){var r=n.createOutputStream();return e.sendMessage("audio",r.index,t),r},this.createFileStream=function(t,r){var i=n.createOutputStream();return e.sendMessage("file",i.index,t,r),i},this.createPipeStream=function(t,r){var i=n.createOutputStream();return e.sendMessage("pipe",i.index,t,r),i},this.createClipboardStream=function(t){var r=n.createOutputStream();return e.sendMessage("clipboard",r.index,t),r},this.createArgumentValueStream=function(t,r){var i=n.createOutputStream();return e.sendMessage("argv",i.index,t,r),i},this.createObjectOutputStream=function(t,r,i){var o=n.createOutputStream();return e.sendMessage("put",t,o.index,r,i),o},this.requestObjectInputStream=function(t,n){m()&&e.sendMessage("get",t,n)},this.sendAck=function(t,n,r){m()&&e.sendMessage("ack",t,n,r)},this.sendBlob=function(t,n){m()&&e.sendMessage("blob",t,n)},this.endStream=function(t){m()&&(e.sendMessage("end",t),g[t]&&(v.free(t),delete g[t]))},this.onstatechange=null,this.onname=null,this.onerror=null,this.onaudio=null,this.onvideo=null,this.onmultitouch=null,this.onargv=null,this.onclipboard=null,this.onfile=null,this.onfilesystem=null,this.onpipe=null,this.onrequired=null,this.onsync=null;var w=function(e){var t=c[e];return t||(t=0===e?u.getDefaultLayer():e>0?u.createLayer():u.createBuffer(),c[e]=t),t},S=function(e){if(!e)return null;for(var t in c)if(e===c[t])return parseInt(t);return null};var T={"miter-limit":function(e,t){u.setMiterLimit(e,parseFloat(t))},"multi-touch":function(e,r){n.onmultitouch&&e instanceof t.Display.VisibleLayer&&n.onmultitouch(e,parseInt(r))}},E={ack:function(e){var n=parseInt(e[0]),r=e[1],i=parseInt(e[2]),o=g[n];o&&(o.onack&&o.onack(new t.Status(i,r)),i>=256&&g[n]===o&&(v.free(n),delete g[n]))},arc:function(e){var t=w(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),i=parseInt(e[3]),o=parseFloat(e[4]),a=parseFloat(e[5]),s=parseInt(e[6]);u.arc(t,n,r,i,o,a,0!=s)},argv:function(e){var r=parseInt(e[0]),i=e[1],o=e[2];if(n.onargv){var a=f[r]=new t.InputStream(n,r);n.onargv(a,i,o)}else n.sendAck(r,"Receiving argument values unsupported",256)},audio:function(e){var r=parseInt(e[0]),i=e[1],o=f[r]=new t.InputStream(n,r),a=null;n.onaudio&&(a=n.onaudio(o,i)),a||(a=t.AudioPlayer.getInstance(o,i)),a?(l[r]=a,n.sendAck(r,"OK",0)):n.sendAck(r,"BAD TYPE",783)},blob:function(e){var t=parseInt(e[0]),n=e[1],r=f[t];r&&r.onblob&&r.onblob(n)},body:function(e){var r=parseInt(e[0]),i=p[r],o=parseInt(e[1]),a=e[2],s=e[3];if(i&&i.onbody){var u=f[o]=new t.InputStream(n,o);i.onbody(u,a,s)}else n.sendAck(o,"Receipt of body unsupported",256)},cfill:function(e){var t=parseInt(e[0]),n=w(parseInt(e[1])),r=parseInt(e[2]),i=parseInt(e[3]),o=parseInt(e[4]),a=parseInt(e[5]);u.setChannelMask(n,t),u.fillColor(n,r,i,o,a)},clip:function(e){var t=w(parseInt(e[0]));u.clip(t)},clipboard:function(e){var r=parseInt(e[0]),i=e[1];if(n.onclipboard){var o=f[r]=new t.InputStream(n,r);n.onclipboard(o,i)}else n.sendAck(r,"Clipboard unsupported",256)},close:function(e){var t=w(parseInt(e[0]));u.close(t)},copy:function(e){var t=w(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),i=parseInt(e[3]),o=parseInt(e[4]),a=parseInt(e[5]),s=w(parseInt(e[6])),c=parseInt(e[7]),l=parseInt(e[8]);u.setChannelMask(s,a),u.copy(t,n,r,i,o,s,c,l)},cstroke:function(e){var t=parseInt(e[0]),n=w(parseInt(e[1])),r=a[parseInt(e[2])],i=s[parseInt(e[3])],o=parseInt(e[4]),c=parseInt(e[5]),l=parseInt(e[6]),h=parseInt(e[7]),d=parseInt(e[8]);u.setChannelMask(n,t),u.strokeColor(n,r,i,o,c,l,h,d)},cursor:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),r=w(parseInt(e[2])),i=parseInt(e[3]),o=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]);u.setCursor(t,n,r,i,o,a,s)},curve:function(e){var t=w(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),i=parseInt(e[3]),o=parseInt(e[4]),a=parseInt(e[5]),s=parseInt(e[6]);u.curveTo(t,n,r,i,o,a,s)},disconnect:function(e){n.disconnect()},dispose:function(e){var t=parseInt(e[0]);if(t>0){var n=w(t);u.dispose(n),delete c[t]}else t<0&&delete c[t]},distort:function(e){var t=parseInt(e[0]),n=parseFloat(e[1]),r=parseFloat(e[2]),i=parseFloat(e[3]),o=parseFloat(e[4]),a=parseFloat(e[5]),s=parseFloat(e[6]);if(t>=0){var c=w(t);u.distort(c,n,r,i,o,a,s)}},error:function(e){var r=e[0],i=parseInt(e[1]);n.onerror&&n.onerror(new t.Status(i,r)),n.disconnect()},end:function(e){var t=parseInt(e[0]),n=f[t];n&&(n.onend&&n.onend(),delete f[t])},file:function(e){var r=parseInt(e[0]),i=e[1],o=e[2];if(n.onfile){var a=f[r]=new t.InputStream(n,r);n.onfile(a,i,o)}else n.sendAck(r,"File transfer unsupported",256)},filesystem:function(e){var r=parseInt(e[0]),i=e[1];if(n.onfilesystem){var o=p[r]=new t.Object(n,r);n.onfilesystem(o,i)}},identity:function(e){var t=w(parseInt(e[0]));u.setTransform(t,1,0,0,1,0,0)},img:function(e){var r=parseInt(e[0]),i=parseInt(e[1]),o=w(parseInt(e[2])),a=e[3],s=parseInt(e[4]),c=parseInt(e[5]),l=f[r]=new t.InputStream(n,r);u.setChannelMask(o,i),u.drawStream(o,s,c,l,a)},jpeg:function(e){var t=parseInt(e[0]),n=w(parseInt(e[1])),r=parseInt(e[2]),i=parseInt(e[3]),o=e[4];u.setChannelMask(n,t),u.draw(n,r,i,"data:image/jpeg;base64,"+o)},lfill:function(e){var t=parseInt(e[0]),n=w(parseInt(e[1])),r=w(parseInt(e[2]));u.setChannelMask(n,t),u.fillLayer(n,r)},line:function(e){var t=w(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]);u.lineTo(t,n,r)},lstroke:function(e){var t=parseInt(e[0]),n=w(parseInt(e[1])),r=w(parseInt(e[2]));u.setChannelMask(n,t),u.strokeLayer(n,r)},mouse:function(e){var t=parseInt(e[0]),n=parseInt(e[1]);u.showCursor(!0),u.moveCursor(t,n)},move:function(e){var t=parseInt(e[0]),n=parseInt(e[1]),r=parseInt(e[2]),i=parseInt(e[3]),o=parseInt(e[4]);if(t>0&&n>=0){var a=w(t),s=w(n);u.move(a,s,r,i,o)}},name:function(e){n.onname&&n.onname(e[0])},nest:function(n){(function(n){var r=d[n];return null==r&&((r=d[n]=new t.Parser).oninstruction=e.oninstruction),r})(parseInt(n[0])).receive(n[1])},pipe:function(e){var r=parseInt(e[0]),i=e[1],o=e[2];if(n.onpipe){var a=f[r]=new t.InputStream(n,r);n.onpipe(a,i,o)}else n.sendAck(r,"Named pipes unsupported",256)},png:function(e){var t=parseInt(e[0]),n=w(parseInt(e[1])),r=parseInt(e[2]),i=parseInt(e[3]),o=e[4];u.setChannelMask(n,t),u.draw(n,r,i,"data:image/png;base64,"+o)},pop:function(e){var t=w(parseInt(e[0]));u.pop(t)},push:function(e){var t=w(parseInt(e[0]));u.push(t)},rect:function(e){var t=w(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]),i=parseInt(e[3]),o=parseInt(e[4]);u.rect(t,n,r,i,o)},required:function(e){n.onrequired&&n.onrequired(e)},reset:function(e){var t=w(parseInt(e[0]));u.reset(t)},set:function(e){var t=w(parseInt(e[0])),n=e[1],r=e[2],i=T[n];i&&i(t,r)},shade:function(e){var t=parseInt(e[0]),n=parseInt(e[1]);if(t>=0){var r=w(t);u.shade(r,n)}},size:function(e){var t=parseInt(e[0]),n=w(t),r=parseInt(e[1]),i=parseInt(e[2]);u.resize(n,r,i)},start:function(e){var t=w(parseInt(e[0])),n=parseInt(e[1]),r=parseInt(e[2]);u.moveTo(t,n,r)},sync:function(t){var o=parseInt(t[0]);u.flush((function(){for(var t in l){var n=l[t];n&&n.sync()}o!==i&&(e.sendMessage("sync",o),i=o)})),2===r&&y(3),n.onsync&&n.onsync(o)},transfer:function(e){var n=w(parseInt(e[0])),r=parseInt(e[1]),i=parseInt(e[2]),o=parseInt(e[3]),a=parseInt(e[4]),s=parseInt(e[5]),c=w(parseInt(e[6])),l=parseInt(e[7]),h=parseInt(e[8]);3===s?u.put(n,r,i,o,a,c,l,h):5!==s&&u.transfer(n,r,i,o,a,c,l,h,t.Client.DefaultTransferFunction[s])},transform:function(e){var t=w(parseInt(e[0])),n=parseFloat(e[1]),r=parseFloat(e[2]),i=parseFloat(e[3]),o=parseFloat(e[4]),a=parseFloat(e[5]),s=parseFloat(e[6]);u.transform(t,n,r,i,o,a,s)},undefine:function(e){var t=parseInt(e[0]),n=p[t];n&&n.onundefine&&n.onundefine()},video:function(e){var r=parseInt(e[0]),i=w(parseInt(e[1])),o=e[2],a=f[r]=new t.InputStream(n,r),s=null;n.onvideo&&(s=n.onvideo(a,i,o)),s||(s=t.VideoPlayer.getInstance(a,i,o)),s?(h[r]=s,n.sendAck(r,"OK",0)):n.sendAck(r,"BAD TYPE",783)}};e.oninstruction=function(e,t){var n=E[e];n&&n(t)},this.disconnect=function(){5!=r&&4!=r&&(y(4),o&&window.clearInterval(o),e.sendMessage("disconnect"),e.disconnect(),y(5))},this.connect=function(t){y(1);try{e.connect(t)}catch(n){throw y(0),n}o=window.setInterval((function(){e.sendMessage("nop")}),5e3),y(2)}},t.Client.DefaultTransferFunction={0:function(e,t){t.red=t.green=t.blue=0},15:function(e,t){t.red=t.green=t.blue=255},3:function(e,t){t.red=e.red,t.green=e.green,t.blue=e.blue,t.alpha=e.alpha},5:function(e,t){},12:function(e,t){t.red=255&~e.red,t.green=255&~e.green,t.blue=255&~e.blue,t.alpha=e.alpha},10:function(e,t){t.red=255&~t.red,t.green=255&~t.green,t.blue=255&~t.blue},1:function(e,t){t.red=e.red&t.red,t.green=e.green&t.green,t.blue=e.blue&t.blue},14:function(e,t){t.red=255&~(e.red&t.red),t.green=255&~(e.green&t.green),t.blue=255&~(e.blue&t.blue)},7:function(e,t){t.red=e.red|t.red,t.green=e.green|t.green,t.blue=e.blue|t.blue},8:function(e,t){t.red=255&~(e.red|t.red),t.green=255&~(e.green|t.green),t.blue=255&~(e.blue|t.blue)},6:function(e,t){t.red=e.red^t.red,t.green=e.green^t.green,t.blue=e.blue^t.blue},9:function(e,t){t.red=255&~(e.red^t.red),t.green=255&~(e.green^t.green),t.blue=255&~(e.blue^t.blue)},4:function(e,t){t.red=~e.red&t.red&255,t.green=~e.green&t.green&255,t.blue=~e.blue&t.blue&255},13:function(e,t){t.red=255&(~e.red|t.red),t.green=255&(~e.green|t.green),t.blue=255&(~e.blue|t.blue)},2:function(e,t){t.red=e.red&~t.red&255,t.green=e.green&~t.green&255,t.blue=e.blue&~t.blue&255},11:function(e,t){t.red=255&(e.red|~t.red),t.green=255&(e.green|~t.green),t.blue=255&(e.blue|~t.blue)}},(t=t||{}).DataURIReader=function(e,t){var n=this,r="data:"+t+";base64,";e.onblob=function(e){r+=e},e.onend=function(){n.onend&&n.onend()},this.getURI=function(){return r},this.onend=null},(t=t||{}).Display=function(){var e=this,n=0,r=0,i=1,o=document.createElement("div");o.style.position="relative",o.style.width=n+"px",o.style.height=r+"px",o.style.transformOrigin=o.style.webkitTransformOrigin=o.style.MozTransformOrigin=o.style.OTransformOrigin=o.style.msTransformOrigin="0 0";var a=new t.Display.VisibleLayer(n,r),s=new t.Display.VisibleLayer(0,0);s.setChannelMask(t.Layer.SRC),o.appendChild(a.getElement()),o.appendChild(s.getElement());var u=document.createElement("div");u.style.position="relative",u.style.width=n*i+"px",u.style.height=r*i+"px",u.appendChild(o),this.cursorHotspotX=0,this.cursorHotspotY=0,this.cursorX=0,this.cursorY=0,this.onresize=null,this.oncursor=null;var c=[],l=[];function h(){for(var e=0;e<l.length;){var t=l[e];if(!t.isReady())break;t.flush(),e++}l.splice(0,e)}function d(e,t){this.isReady=function(){for(var e=0;e<t.length;e++)if(t[e].blocked)return!1;return!0},this.flush=function(){for(var n=0;n<t.length;n++)t[n].execute();e&&e()}}function f(e,t){var n=this;this.blocked=t,this.unblock=function(){n.blocked&&(n.blocked=!1,h())},this.execute=function(){e&&e()}}function p(e,t){var n=new f(e,t);return c.push(n),n}this.getElement=function(){return u},this.getWidth=function(){return n},this.getHeight=function(){return r},this.getDefaultLayer=function(){return a},this.getCursorLayer=function(){return s},this.createLayer=function(){var e=new t.Display.VisibleLayer(n,r);return e.move(a,0,0,0),e},this.createBuffer=function(){var e=new t.Layer(0,0);return e.autosize=1,e},this.flush=function(e){l.push(new d(e,c)),c=[],h()},this.setCursor=function(t,n,r,i,o,a,u){p((function(){e.cursorHotspotX=t,e.cursorHotspotY=n,s.resize(a,u),s.copy(r,i,o,a,u,0,0),e.moveCursor(e.cursorX,e.cursorY),e.oncursor&&e.oncursor(s.toCanvas(),t,n)}))},this.showCursor=function(e){var t=s.getElement(),n=t.parentNode;!1===e?n&&n.removeChild(t):n!==o&&o.appendChild(t)},this.moveCursor=function(t,n){s.translate(t-e.cursorHotspotX,n-e.cursorHotspotY),e.cursorX=t,e.cursorY=n},this.resize=function(t,s,c){p((function(){t.resize(s,c),t===a&&(n=s,r=c,o.style.width=n+"px",o.style.height=r+"px",u.style.width=n*i+"px",u.style.height=r*i+"px",e.onresize&&e.onresize(s,c))}))},this.drawImage=function(e,t,n,r){p((function(){e.drawImage(t,n,r)}))},this.drawBlob=function(e,t,n,r){var i;if(window.createImageBitmap){var o;i=p((function(){e.drawImage(t,n,o)}),!0),window.createImageBitmap(r).then((function(e){o=e,i.unblock()}))}else{var a=URL.createObjectURL(r);i=p((function(){s.width&&s.height&&e.drawImage(t,n,s),URL.revokeObjectURL(a)}),!0);var s=new Image;s.onload=i.unblock,s.onerror=i.unblock,s.src=a}},this.drawStream=function(n,r,i,o,a){var s;window.createImageBitmap?(s=new t.BlobReader(o,a)).onend=function(){e.drawBlob(n,r,i,s.getBlob())}:(s=new t.DataURIReader(o,a)).onend=function(){e.draw(n,r,i,s.getURI())}},this.draw=function(e,t,n,r){var i=p((function(){o.width&&o.height&&e.drawImage(t,n,o)}),!0),o=new Image;o.onload=i.unblock,o.onerror=i.unblock,o.src=r},this.play=function(e,t,n,r){var i=document.createElement("video");i.type=t,i.src=r,i.addEventListener("play",(function(){!function t(){e.drawImage(0,0,i),i.ended||window.setTimeout(t,20)}()}),!1),p(i.play)},this.transfer=function(e,t,n,r,i,o,a,s,u){p((function(){o.transfer(e,t,n,r,i,a,s,u)}))},this.put=function(e,t,n,r,i,o,a,s){p((function(){o.put(e,t,n,r,i,a,s)}))},this.copy=function(e,t,n,r,i,o,a,s){p((function(){o.copy(e,t,n,r,i,a,s)}))},this.moveTo=function(e,t,n){p((function(){e.moveTo(t,n)}))},this.lineTo=function(e,t,n){p((function(){e.lineTo(t,n)}))},this.arc=function(e,t,n,r,i,o,a){p((function(){e.arc(t,n,r,i,o,a)}))},this.curveTo=function(e,t,n,r,i,o,a){p((function(){e.curveTo(t,n,r,i,o,a)}))},this.close=function(e){p((function(){e.close()}))},this.rect=function(e,t,n,r,i){p((function(){e.rect(t,n,r,i)}))},this.clip=function(e){p((function(){e.clip()}))},this.strokeColor=function(e,t,n,r,i,o,a,s){p((function(){e.strokeColor(t,n,r,i,o,a,s)}))},this.fillColor=function(e,t,n,r,i){p((function(){e.fillColor(t,n,r,i)}))},this.strokeLayer=function(e,t,n,r,i){p((function(){e.strokeLayer(t,n,r,i)}))},this.fillLayer=function(e,t){p((function(){e.fillLayer(t)}))},this.push=function(e){p((function(){e.push()}))},this.pop=function(e){p((function(){e.pop()}))},this.reset=function(e){p((function(){e.reset()}))},this.setTransform=function(e,t,n,r,i,o,a){p((function(){e.setTransform(t,n,r,i,o,a)}))},this.transform=function(e,t,n,r,i,o,a){p((function(){e.transform(t,n,r,i,o,a)}))},this.setChannelMask=function(e,t){p((function(){e.setChannelMask(t)}))},this.setMiterLimit=function(e,t){p((function(){e.setMiterLimit(t)}))},this.dispose=function(e){p((function(){e.dispose()}))},this.distort=function(e,t,n,r,i,o,a){p((function(){e.distort(t,n,r,i,o,a)}))},this.move=function(e,t,n,r,i){p((function(){e.move(t,n,r,i)}))},this.shade=function(e,t){p((function(){e.shade(t)}))},this.scale=function(e){o.style.transform=o.style.WebkitTransform=o.style.MozTransform=o.style.OTransform=o.style.msTransform="scale("+e+","+e+")",i=e,u.style.width=n*i+"px",u.style.height=r*i+"px"},this.getScale=function(){return i},this.flatten=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height;var t=e.getContext("2d");return function e(n,r,i){if(n.width>0&&n.height>0){var o=t.globalAlpha;t.globalAlpha*=n.alpha/255,t.drawImage(n.getCanvas(),r,i);for(var a=function(e){var t=[];for(var n in e.children)t.push(e.children[n]);return t.sort((function(e,t){var n=e.z-t.z;if(0!==n)return n;var r=e.getElement(),i=t.getElement().compareDocumentPosition(r);return i&Node.DOCUMENT_POSITION_PRECEDING?-1:i&Node.DOCUMENT_POSITION_FOLLOWING?1:0})),t}(n),s=0;s<a.length;s++){var u=a[s];e(u,r+u.x,i+u.y)}t.globalAlpha=o}}(a,0,0),e}},t.Display.VisibleLayer=function(e,n){t.Layer.apply(this,[e,n]);var r=this;this.__unique_id=t.Display.VisibleLayer.__next_id++,this.alpha=255,this.x=0,this.y=0,this.z=0,this.matrix=[1,0,0,1,0,0],this.parent=null,this.children={};var i=r.getCanvas();i.style.position="absolute",i.style.left="0px",i.style.top="0px";var o=document.createElement("div");o.appendChild(i),o.style.width=e+"px",o.style.height=n+"px",o.style.position="absolute",o.style.left="0px",o.style.top="0px",o.style.overflow="hidden";var a=this.resize;this.resize=function(e,t){o.style.width=e+"px",o.style.height=t+"px",a(e,t)},this.getElement=function(){return o};var s="translate(0px, 0px)",u="matrix(1, 0, 0, 1, 0, 0)";this.translate=function(e,t){r.x=e,r.y=t,s="translate("+e+"px,"+t+"px)",o.style.transform=o.style.WebkitTransform=o.style.MozTransform=o.style.OTransform=o.style.msTransform=s+" "+u},this.move=function(e,t,n,i){r.parent!==e&&(r.parent&&delete r.parent.children[r.__unique_id],r.parent=e,e.children[r.__unique_id]=r,e.getElement().appendChild(o));r.translate(t,n),r.z=i,o.style.zIndex=i},this.shade=function(e){r.alpha=e,o.style.opacity=e/255},this.dispose=function(){r.parent&&(delete r.parent.children[r.__unique_id],r.parent=null),o.parentNode&&o.parentNode.removeChild(o)},this.distort=function(e,t,n,i,a,c){r.matrix=[e,t,n,i,a,c],u="matrix("+e+","+t+","+n+","+i+","+a+","+c+")",o.style.transform=o.style.WebkitTransform=o.style.MozTransform=o.style.OTransform=o.style.msTransform=s+" "+u}},t.Display.VisibleLayer.__next_id=0,(t=t||{}).Event=function(e){this.type=e,this.timestamp=(new Date).getTime(),this.getAge=function(){return(new Date).getTime()-this.timestamp},this.invokeLegacyHandler=function(e){}},t.Event.DOMEvent=function(e,n){t.Event.call(this,e),n=n||[],Array.isArray(n)||(n=[n]),this.preventDefault=function(){n.forEach((function(e){e.preventDefault&&e.preventDefault(),e.returnValue=!1}))},this.stopPropagation=function(){n.forEach((function(e){e.stopPropagation()}))}},t.Event.DOMEvent.cancelEvent=function(e){e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1},t.Event.Target=function(){var e={};this.on=function(t,n){var r=e[t];r||(e[t]=r=[]),r.push(n)},this.onEach=function(e,t){e.forEach((function(e){this.on(e,t)}),this)},this.dispatch=function(t){t.invokeLegacyHandler(this);var n=e[t.type];if(n)for(var r=0;r<n.length;r++)n[r](t,this)},this.off=function(t,n){var r=e[t];if(!r)return!1;for(var i=0;i<r.length;i++)if(r[i]===n)return r.splice(i,1),!0;return!1},this.offEach=function(e,t){var n=!1;return e.forEach((function(e){n|=this.off(e,t)}),this),n}},(t=t||{}).InputSink=function(){var e=this,t=document.createElement("textarea");t.style.position="fixed",t.style.outline="none",t.style.border="none",t.style.margin="0",t.style.padding="0",t.style.height="0",t.style.width="0",t.style.left="0",t.style.bottom="0",t.style.resize="none",t.style.background="transparent",t.style.color="transparent",t.addEventListener("keypress",(function(e){t.value=""}),!1),t.addEventListener("compositionend",(function(e){e.data&&(t.value="")}),!1),t.addEventListener("input",(function(e){e.data&&!e.isComposing&&(t.value="")}),!1),t.addEventListener("focus",(function(){window.setTimeout((function(){t.click(),t.select()}),0)}),!0),this.focus=function(){window.setTimeout((function(){t.focus()}),0)},this.getElement=function(){return t},document.addEventListener("keydown",(function(t){var n=document.activeElement;if(n&&n!==document.body){var r=n.getBoundingClientRect();if(r.left+r.width>0&&r.top+r.height>0)return}e.focus()}),!0)},(t=t||{}).InputStream=function(e,t){var n=this;this.index=t,this.onblob=null,this.onend=null,this.sendAck=function(t,r){e.sendAck(n.index,t,r)}},(t=t||{}).IntegerPool=function(){var e=this,t=[];this.next_int=0,this.next=function(){return t.length>0?t.shift():e.next_int++},this.free=function(e){t.push(e)}},(t=t||{}).JSONReader=function(e){var n=this,r=new t.StringReader(e),i="";this.getLength=function(){return i.length},this.getJSON=function(){return JSON.parse(i)},r.ontext=function(e){i+=e,n.onprogress&&n.onprogress(e.length)},r.onend=function(){n.onend&&n.onend()},this.onprogress=null,this.onend=null},(t=t||{}).Keyboard=function(e){var n=this,r="_GUAC_KEYBOARD_HANDLED_BY_"+t.Keyboard._nextID++;this.onkeydown=null,this.onkeyup=null;var i={keyupUnreliable:!1,altIsTypableOnly:!1,capsLockKeyupUnreliable:!1};navigator&&navigator.platform&&(navigator.platform.match(/ipad|iphone|ipod/i)?i.keyupUnreliable=!0:navigator.platform.match(/^mac/i)&&(i.altIsTypableOnly=!0,i.capsLockKeyupUnreliable=!0));var o=function(e){var n=this;this.keyCode=e?e.which||e.keyCode:0,this.keyIdentifier=e&&e.keyIdentifier,this.key=e&&e.key,this.location=e?L(e):0,this.modifiers=e?t.Keyboard.ModifierState.fromKeyboardEvent(e):new t.Keyboard.ModifierState,this.timestamp=(new Date).getTime(),this.defaultPrevented=!1,this.keysym=null,this.reliable=!1,this.getAge=function(){return(new Date).getTime()-n.timestamp}},a=function(e){o.call(this,e),this.keysym=S(this.key,this.location)||E(this.keyCode,this.location),this.keyupReliable=!i.keyupUnreliable,this.keysym&&!w(this.keysym)&&(this.reliable=!0),!this.keysym&&b(this.keyCode,this.keyIdentifier)&&(this.keysym=S(this.keyIdentifier,this.location,this.modifiers.shift)),(this.modifiers.meta&&65511!==this.keysym&&65512!==this.keysym||65509===this.keysym&&i.capsLockKeyupUnreliable)&&(this.keyupReliable=!1);var t=!this.modifiers.ctrl&&!i.altIsTypableOnly;(!this.modifiers.alt&&this.modifiers.ctrl||t&&this.modifiers.alt||this.modifiers.meta||this.modifiers.hyper)&&(this.reliable=!0),v[this.keyCode]=this.keysym};a.prototype=new o;var s=function(e){o.call(this,e),this.keysym=T(this.keyCode),this.reliable=!0};s.prototype=new o;var u=function(e){o.call(this,e),this.keysym=E(this.keyCode,this.location)||S(this.key,this.location),n.pressed[this.keysym]||(this.keysym=v[this.keyCode]||this.keysym),this.reliable=!0};u.prototype=new o;var c=[],l={8:[65288],9:[65289],12:[65291,65291,65291,65461],13:[65293],16:[65505,65505,65506],17:[65507,65507,65508],18:[65513,65513,65027],19:[65299],20:[65509],27:[65307],32:[32],33:[65365,65365,65365,65465],34:[65366,65366,65366,65459],35:[65367,65367,65367,65457],36:[65360,65360,65360,65463],37:[65361,65361,65361,65460],38:[65362,65362,65362,65464],39:[65363,65363,65363,65462],40:[65364,65364,65364,65458],45:[65379,65379,65379,65456],46:[65535,65535,65535,65454],91:[65511],92:[65512],93:[65383],96:[65456],97:[65457],98:[65458],99:[65459],100:[65460],101:[65461],102:[65462],103:[65463],104:[65464],105:[65465],106:[65450],107:[65451],109:[65453],110:[65454],111:[65455],112:[65470],113:[65471],114:[65472],115:[65473],116:[65474],117:[65475],118:[65476],119:[65477],120:[65478],121:[65479],122:[65480],123:[65481],144:[65407],145:[65300],225:[65027]},h={Again:[65382],AllCandidates:[65341],Alphanumeric:[65328],Alt:[65513,65513,65027],Attn:[64782],AltGraph:[65027],ArrowDown:[65364],ArrowLeft:[65361],ArrowRight:[65363],ArrowUp:[65362],Backspace:[65288],CapsLock:[65509],Cancel:[65385],Clear:[65291],Convert:[65313],Copy:[64789],Crsel:[64796],CrSel:[64796],CodeInput:[65335],Compose:[65312],Control:[65507,65507,65508],ContextMenu:[65383],Delete:[65535],Down:[65364],End:[65367],Enter:[65293],EraseEof:[64774],Escape:[65307],Execute:[65378],Exsel:[64797],ExSel:[64797],F1:[65470],F2:[65471],F3:[65472],F4:[65473],F5:[65474],F6:[65475],F7:[65476],F8:[65477],F9:[65478],F10:[65479],F11:[65480],F12:[65481],F13:[65482],F14:[65483],F15:[65484],F16:[65485],F17:[65486],F18:[65487],F19:[65488],F20:[65489],F21:[65490],F22:[65491],F23:[65492],F24:[65493],Find:[65384],GroupFirst:[65036],GroupLast:[65038],GroupNext:[65032],GroupPrevious:[65034],FullWidth:null,HalfWidth:null,HangulMode:[65329],Hankaku:[65321],HanjaMode:[65332],Help:[65386],Hiragana:[65317],HiraganaKatakana:[65319],Home:[65360],Hyper:[65517,65517,65518],Insert:[65379],JapaneseHiragana:[65317],JapaneseKatakana:[65318],JapaneseRomaji:[65316],JunjaMode:[65336],KanaMode:[65325],KanjiMode:[65313],Katakana:[65318],Left:[65361],Meta:[65511,65511,65512],ModeChange:[65406],NumLock:[65407],PageDown:[65366],PageUp:[65365],Pause:[65299],Play:[64790],PreviousCandidate:[65342],PrintScreen:[65377],Redo:[65382],Right:[65363],RomanCharacters:null,Scroll:[65300],Select:[65376],Separator:[65452],Shift:[65505,65505,65506],SingleCandidate:[65340],Super:[65515,65515,65516],Tab:[65289],UIKeyInputDownArrow:[65364],UIKeyInputEscape:[65307],UIKeyInputLeftArrow:[65361],UIKeyInputRightArrow:[65363],UIKeyInputUpArrow:[65362],Up:[65362],Undo:[65381],Win:[65511,65511,65512],Zenkaku:[65320],ZenkakuHankaku:[65322]},d={65027:!0,65505:!0,65506:!0,65507:!0,65508:!0,65509:!0,65511:!0,65512:!0,65513:!0,65514:!0,65515:!0,65516:!0};this.modifiers=new t.Keyboard.ModifierState,this.pressed={};var f={},p={},v={},g=null,y=null,m=function(e,t){return e?e[t]||e[0]:null},w=function(e){return e>=0&&e<=255||16777216===(4294901760&e)};function S(e,t,n){if(!e)return null;var r,i=e.indexOf("U+");if(i>=0){var o=e.substring(i+2);r=String.fromCharCode(parseInt(o,16))}else{if(1!==e.length||3===t)return m(h[e],t);r=e}return!0===n?r=r.toUpperCase():!1===n&&(r=r.toLowerCase()),T(r.charCodeAt(0))}function T(e){return function(e){return e<=31||e>=127&&e<=159}(e)?65280|e:e>=0&&e<=255?e:e>=256&&e<=1114111?16777216|e:null}function E(e,t){return m(l[e],t)}var b=function(e,t){if(!t)return!1;var n=t.indexOf("U+");return-1===n||(e!==parseInt(t.substring(n+2),16)||(e>=65&&e<=90||e>=48&&e<=57))};this.press=function(e){if(null!==e){if(!n.pressed[e]&&(n.pressed[e]=!0,n.onkeydown)){var t=n.onkeydown(e);return p[e]=t,window.clearTimeout(g),window.clearInterval(y),d[e]||(g=window.setTimeout((function(){y=window.setInterval((function(){n.onkeyup(e),n.onkeydown(e)}),50)}),500)),t}return p[e]||!1}},this.release=function(e){n.pressed[e]&&(delete n.pressed[e],delete f[e],window.clearTimeout(g),window.clearInterval(y),null!==e&&n.onkeyup&&n.onkeyup(e))},this.type=function(e){for(var t=0;t<e.length;t++){var r=T(e.codePointAt?e.codePointAt(t):e.charCodeAt(t));n.press(r),n.release(r)}},this.reset=function(){for(var e in n.pressed)n.release(parseInt(e));c=[]};var I=function(e,t,r){var i,o=r.modifiers[e],a=n.modifiers[e];if(-1===t.indexOf(r.keysym))if(a&&!1===o)for(i=0;i<t.length;i++)n.release(t[i]);else if(!a&&o){for(i=0;i<t.length;i++)if(n.pressed[t[i]])return;var s=t[0];r.keysym&&(f[s]=!0),n.press(s)}},C=function(e){I("alt",[65513,65514,65027],e),I("shift",[65505,65506],e),I("ctrl",[65507,65508],e),I("meta",[65511,65512],e),I("hyper",[65515,65516],e),n.modifiers=e.modifiers};function k(){var e,t=A();if(!t)return!1;do{e=t,t=A()}while(null!==t);return function(){for(var e in n.pressed)if(!f[e])return!1;return!0}()&&n.reset(),e.defaultPrevented}var A=function(){var e=c[0];if(!e)return null;if(!(e instanceof a))return e instanceof u&&!i.keyupUnreliable?(t=e.keysym)?(n.release(t),delete v[e.keyCode],e.defaultPrevented=!0,C(e),c.shift()):(n.reset(),e):c.shift();var t=null,r=[];if(65511===e.keysym||65512===e.keysym){if(1===c.length)return null;if(c[1].keysym!==e.keysym){if(!c[1].modifiers.meta)return c.shift()}else if(c[1]instanceof a)return c.shift()}if(e.reliable?(t=e.keysym,r=c.splice(0,1)):c[1]instanceof s?(t=c[1].keysym,r=c.splice(0,2)):c[1]&&(t=e.keysym,r=c.splice(0,1)),r.length>0){if(C(e),t){!function(e){n.modifiers.ctrl&&n.modifiers.alt&&(e>=65&&e<=90||e>=97&&e<=122||(e<=255||16777216===(4278190080&e))&&(n.release(65507),n.release(65508),n.release(65513),n.release(65514)))}(t);var o=!n.press(t);v[e.keyCode]=t,e.keyupReliable||n.release(t);for(var l=0;l<r.length;l++)r[l].defaultPrevented=o}return e}return null},L=function(e){return"location"in e?e.location:"keyLocation"in e?e.keyLocation:0},M=function(e){return!e[r]&&(e[r]=!0,!0)};this.listenTo=function(e){e.addEventListener("keydown",(function(e){if(n.onkeydown&&M(e)){var t=new a(e);229!==t.keyCode&&(c.push(t),k()&&e.preventDefault())}}),!0),e.addEventListener("keypress",(function(e){(n.onkeydown||n.onkeyup)&&M(e)&&(c.push(new s(e)),k()&&e.preventDefault())}),!0),e.addEventListener("keyup",(function(e){n.onkeyup&&M(e)&&(e.preventDefault(),c.push(new u(e)),k())}),!0);var t=function(t){(n.onkeydown||n.onkeyup)&&M(t)&&t.data&&!t.isComposing&&(e.removeEventListener("compositionend",r,!1),n.type(t.data))},r=function(r){(n.onkeydown||n.onkeyup)&&M(r)&&r.data&&(e.removeEventListener("input",t,!1),n.type(r.data))};e.addEventListener("input",t,!1),e.addEventListener("compositionend",r,!1)},e&&n.listenTo(e)},t.Keyboard._nextID=0,t.Keyboard.ModifierState=function(){this.shift=!1,this.ctrl=!1,this.alt=!1,this.meta=!1,this.hyper=!1},t.Keyboard.ModifierState.fromKeyboardEvent=function(e){var n=new t.Keyboard.ModifierState;return n.shift=e.shiftKey,n.ctrl=e.ctrlKey,n.alt=e.altKey,n.meta=e.metaKey,e.getModifierState&&(n.hyper=e.getModifierState("OS")||e.getModifierState("Super")||e.getModifierState("Hyper")||e.getModifierState("Win")),n},(t=t||{}).Layer=function(e,n){var r=this,i=document.createElement("canvas"),o=i.getContext("2d");o.save();var a=!0,s=!0,u=0,c={1:"destination-in",2:"destination-out",4:"source-in",6:"source-atop",8:"source-out",9:"destination-atop",10:"xor",11:"destination-over",12:"copy",14:"source-over",15:"lighter"},l=function(e,t){e=e||0,t=t||0;var n=64*Math.ceil(e/64),s=64*Math.ceil(t/64);if(i.width!==n||i.height!==s){var c=null;if(!a&&0!==i.width&&0!==i.height)(c=document.createElement("canvas")).width=Math.min(r.width,e),c.height=Math.min(r.height,t),c.getContext("2d").drawImage(i,0,0,c.width,c.height,0,0,c.width,c.height);var l=o.globalCompositeOperation;i.width=n,i.height=s,c&&o.drawImage(c,0,0,c.width,c.height,0,0,c.width,c.height),o.globalCompositeOperation=l,u=0,o.save()}else r.reset();r.width=e,r.height=t};function h(e,t,n,i){var o,a,s=n+e,u=i+t;o=s>r.width?s:r.width,a=u>r.height?u:r.height,r.resize(o,a)}this.autosize=!1,this.width=e,this.height=n,this.getCanvas=function(){return i},this.toCanvas=function(){var e=document.createElement("canvas");return e.width=r.width,e.height=r.height,e.getContext("2d").drawImage(r.getCanvas(),0,0),e},this.resize=function(e,t){e===r.width&&t===r.height||l(e,t)},this.drawImage=function(e,t,n){r.autosize&&h(e,t,n.width,n.height),o.drawImage(n,e,t),a=!1},this.transfer=function(e,n,i,s,u,c,l,d){var f=e.getCanvas();if(!(n>=f.width||i>=f.height)&&(n+s>f.width&&(s=f.width-n),i+u>f.height&&(u=f.height-i),0!==s&&0!==u)){r.autosize&&h(c,l,s,u);for(var p=e.getCanvas().getContext("2d").getImageData(n,i,s,u),v=o.getImageData(c,l,s,u),g=0;g<s*u*4;g+=4){var y=new t.Layer.Pixel(p.data[g],p.data[g+1],p.data[g+2],p.data[g+3]),m=new t.Layer.Pixel(v.data[g],v.data[g+1],v.data[g+2],v.data[g+3]);d(y,m),v.data[g]=m.red,v.data[g+1]=m.green,v.data[g+2]=m.blue,v.data[g+3]=m.alpha}o.putImageData(v,c,l),a=!1}},this.put=function(e,t,n,i,s,u,c){var l=e.getCanvas();if(!(t>=l.width||n>=l.height)&&(t+i>l.width&&(i=l.width-t),n+s>l.height&&(s=l.height-n),0!==i&&0!==s)){r.autosize&&h(u,c,i,s);var d=e.getCanvas().getContext("2d").getImageData(t,n,i,s);o.putImageData(d,u,c),a=!1}},this.copy=function(e,t,n,i,s,u,c){var l=e.getCanvas();t>=l.width||n>=l.height||(t+i>l.width&&(i=l.width-t),n+s>l.height&&(s=l.height-n),0!==i&&0!==s&&(r.autosize&&h(u,c,i,s),o.drawImage(l,t,n,i,s,u,c,i,s),a=!1))},this.moveTo=function(e,t){s&&(o.beginPath(),s=!1),r.autosize&&h(e,t,0,0),o.moveTo(e,t)},this.lineTo=function(e,t){s&&(o.beginPath(),s=!1),r.autosize&&h(e,t,0,0),o.lineTo(e,t)},this.arc=function(e,t,n,i,a,u){s&&(o.beginPath(),s=!1),r.autosize&&h(e,t,0,0),o.arc(e,t,n,i,a,u)},this.curveTo=function(e,t,n,i,a,u){s&&(o.beginPath(),s=!1),r.autosize&&h(a,u,0,0),o.bezierCurveTo(e,t,n,i,a,u)},this.close=function(){o.closePath(),s=!0},this.rect=function(e,t,n,i){s&&(o.beginPath(),s=!1),r.autosize&&h(e,t,n,i),o.rect(e,t,n,i)},this.clip=function(){o.clip(),s=!0},this.strokeColor=function(e,t,n,r,i,u,c){o.lineCap=e,o.lineJoin=t,o.lineWidth=n,o.strokeStyle="rgba("+r+","+i+","+u+","+c/255+")",o.stroke(),a=!1,s=!0},this.fillColor=function(e,t,n,r){o.fillStyle="rgba("+e+","+t+","+n+","+r/255+")",o.fill(),a=!1,s=!0},this.strokeLayer=function(e,t,n,r){o.lineCap=e,o.lineJoin=t,o.lineWidth=n,o.strokeStyle=o.createPattern(r.getCanvas(),"repeat"),o.stroke(),a=!1,s=!0},this.fillLayer=function(e){o.fillStyle=o.createPattern(e.getCanvas(),"repeat"),o.fill(),a=!1,s=!0},this.push=function(){o.save(),u++},this.pop=function(){u>0&&(o.restore(),u--)},this.reset=function(){for(;u>0;)o.restore(),u--;o.restore(),o.save(),o.beginPath(),s=!1},this.setTransform=function(e,t,n,r,i,a){o.setTransform(e,t,n,r,i,a)},this.transform=function(e,t,n,r,i,a){o.transform(e,t,n,r,i,a)},this.setChannelMask=function(e){o.globalCompositeOperation=c[e]},this.setMiterLimit=function(e){o.miterLimit=e},l(e,n),i.style.zIndex=-1},t.Layer.ROUT=2,t.Layer.ATOP=6,t.Layer.XOR=10,t.Layer.ROVER=11,t.Layer.OVER=14,t.Layer.PLUS=15,t.Layer.RIN=1,t.Layer.IN=4,t.Layer.OUT=8,t.Layer.RATOP=9,t.Layer.SRC=12,t.Layer.Pixel=function(e,t,n,r){this.red=e,this.green=t,this.blue=n,this.alpha=r},(t=t||{}).Mouse=function(e){t.Mouse.Event.Target.call(this);var n=this;this.touchMouseThreshold=3,this.scrollThreshold=53,this.PIXELS_PER_LINE=18,this.PIXELS_PER_PAGE=16*this.PIXELS_PER_LINE;var r=[t.Mouse.State.Buttons.LEFT,t.Mouse.State.Buttons.MIDDLE,t.Mouse.State.Buttons.RIGHT],i=0,o=0;function a(){i=n.touchMouseThreshold}function s(e){var r=e.deltaY||-e.wheelDeltaY||-e.wheelDelta;if(r?1===e.deltaMode?r=e.deltaY*n.PIXELS_PER_LINE:2===e.deltaMode&&(r=e.deltaY*n.PIXELS_PER_PAGE):r=e.detail*n.PIXELS_PER_LINE,(o+=r)<=-n.scrollThreshold){do{n.click(t.Mouse.State.Buttons.UP),o+=n.scrollThreshold}while(o<=-n.scrollThreshold);o=0}if(o>=n.scrollThreshold){do{n.click(t.Mouse.State.Buttons.DOWN),o-=n.scrollThreshold}while(o>=n.scrollThreshold);o=0}t.Event.DOMEvent.cancelEvent(e)}e.addEventListener("contextmenu",(function(e){t.Event.DOMEvent.cancelEvent(e)}),!1),e.addEventListener("mousemove",(function(r){if(i)return t.Event.DOMEvent.cancelEvent(r),void i--;n.move(t.Position.fromClientPosition(e,r.clientX,r.clientY),r)}),!1),e.addEventListener("mousedown",(function(e){if(i)t.Event.DOMEvent.cancelEvent(e);else{var o=r[e.button];o&&n.press(o,e)}}),!1),e.addEventListener("mouseup",(function(e){if(i)t.Event.DOMEvent.cancelEvent(e);else{var o=r[e.button];o&&n.release(o,e)}}),!1),e.addEventListener("mouseout",(function(t){t||(t=window.event);for(var r=t.relatedTarget||t.toElement;r;){if(r===e)return;r=r.parentNode}n.reset(t),n.out(t)}),!1),e.addEventListener("selectstart",(function(e){t.Event.DOMEvent.cancelEvent(e)}),!1),e.addEventListener("touchmove",a,!1),e.addEventListener("touchstart",a,!1),e.addEventListener("touchend",a,!1),e.addEventListener("DOMMouseScroll",s,!1),e.addEventListener("mousewheel",s,!1),e.addEventListener("wheel",s,!1);var u=function(){var e=document.createElement("div");if(!("cursor"in e.style))return!1;try{e.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX///+nxBvIAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==) 0 0, auto"}catch(t){return!1}return/\burl\([^()]*\)\s+0\s+0\b/.test(e.style.cursor||"")}();this.setCursor=function(t,n,r){if(u){var i=t.toDataURL("image/png");return e.style.cursor="url("+i+") "+n+" "+r+", auto",!0}return!1}},t.Mouse.State=function(e){e=arguments.length>1?function(e,t,n,r,i,o,a){return{x:e,y:t,left:n,middle:r,right:i,up:o,down:a}}.apply(this,arguments):e||{},t.Position.call(this,e),this.left=e.left||!1,this.middle=e.middle||!1,this.right=e.right||!1,this.up=e.up||!1,this.down=e.down||!1},t.Mouse.State.Buttons={LEFT:"left",MIDDLE:"middle",RIGHT:"right",UP:"up",DOWN:"down"},t.Mouse.Event=function(e,n,r){t.Event.DOMEvent.call(this,e,r);var i="on"+this.type;this.state=n,this.invokeLegacyHandler=function(e){e[i]&&(this.preventDefault(),this.stopPropagation(),e[i](this.state))}},t.Mouse.Event.Target=function(){t.Event.Target.call(this),this.currentState=new t.Mouse.State,this.press=function(e,n){this.currentState[e]||(this.currentState[e]=!0,this.dispatch(new t.Mouse.Event("mousedown",this.currentState,n)))},this.release=function(e,n){this.currentState[e]&&(this.currentState[e]=!1,this.dispatch(new t.Mouse.Event("mouseup",this.currentState,n)))},this.click=function(e,t){this.press(e,t),this.release(e,t)},this.move=function(e,n){this.currentState.x===e.x&&this.currentState.y===e.y||(this.currentState.x=e.x,this.currentState.y=e.y,this.dispatch(new t.Mouse.Event("mousemove",this.currentState,n)))},this.out=function(e){this.dispatch(new t.Mouse.Event("mouseout",this.currentState,e))},this.reset=function(e){for(var n in t.Mouse.State.Buttons)this.release(t.Mouse.State.Buttons[n],e)}},t.Mouse.Touchpad=function(e){t.Mouse.Event.Target.call(this);var n=this;this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=10*(window.devicePixelRatio||1),this.currentState=new t.Mouse.State;var r=0,i=0,o=0,a=0,s=0,u={1:"left",2:"right",3:"middle"},c=!1,l=null;e.addEventListener("touchend",(function(e){if(e.preventDefault(),c&&0===e.touches.length){var t=(new Date).getTime(),i=u[r];n.currentState[i]&&(n.release(i,e),l&&(window.clearTimeout(l),l=null)),t-a<=n.clickTimingThreshold&&s<n.clickMoveThreshold&&(n.press(i,e),l=window.setTimeout((function(){n.release(i,e),c=!1}),n.clickTimingThreshold)),l||(c=!1)}}),!1),e.addEventListener("touchstart",(function(e){if(e.preventDefault(),r=Math.min(e.touches.length,3),l&&(window.clearTimeout(l),l=null),!c){c=!0;var t=e.touches[0];i=t.clientX,o=t.clientY,a=(new Date).getTime(),s=0}}),!1),e.addEventListener("touchmove",(function(u){u.preventDefault();var c=u.touches[0],l=c.clientX-i,h=c.clientY-o;if(s+=Math.abs(l)+Math.abs(h),1===r){var d=1+s/((new Date).getTime()-a),f=new t.Position(n.currentState);f.x+=l*d,f.y+=h*d,f.x=Math.min(Math.max(0,f.x),e.offsetWidth-1),f.y=Math.min(Math.max(0,f.y),e.offsetHeight-1),n.move(f,u),i=c.clientX,o=c.clientY}else if(2===r){var p;if(Math.abs(h)>=n.scrollThreshold)p=h>0?"down":"up",n.click(p,u),i=c.clientX,o=c.clientY}}),!1)},t.Mouse.Touchscreen=function(e){t.Mouse.Event.Target.call(this);var n=this,r=!1,i=null,o=null,a=null,s=null;function u(e){var t=e.touches[0]||e.changedTouches[0],r=t.clientX-i,a=t.clientY-o;return Math.sqrt(r*r+a*a)>=n.clickMoveThreshold}function c(){window.clearTimeout(a),window.clearTimeout(s),r=!1}this.scrollThreshold=20*(window.devicePixelRatio||1),this.clickTimingThreshold=250,this.clickMoveThreshold=16*(window.devicePixelRatio||1),this.longPressThreshold=500,e.addEventListener("touchend",(function(i){if(r)if(0===i.touches.length&&1===i.changedTouches.length){if(window.clearTimeout(s),n.release(t.Mouse.State.Buttons.LEFT,i),!u(i)&&(i.preventDefault(),!n.currentState.left)){var o=i.changedTouches[0];n.move(t.Position.fromClientPosition(e,o.clientX,o.clientY)),n.press(t.Mouse.State.Buttons.LEFT,i),a=window.setTimeout((function(){n.release(t.Mouse.State.Buttons.LEFT,i),c()}),n.clickTimingThreshold)}}else c()}),!1),e.addEventListener("touchstart",(function(u){1===u.touches.length?(u.preventDefault(),function(e){var t=e.touches[0];r=!0,i=t.clientX,o=t.clientY}(u),window.clearTimeout(a),s=window.setTimeout((function(){var r=u.touches[0];n.move(t.Position.fromClientPosition(e,r.clientX,r.clientY)),n.click(t.Mouse.State.Buttons.RIGHT,u),c()}),n.longPressThreshold)):c()}),!1),e.addEventListener("touchmove",(function(i){if(r)if(u(i)&&window.clearTimeout(s),1===i.touches.length){if(n.currentState.left){i.preventDefault();var o=i.touches[0];n.move(t.Position.fromClientPosition(e,o.clientX,o.clientY),i)}}else c()}),!1)},(t=(t=t||{})||{}).Object=function(e,t){var n=this,r={};this.index=t,this.onbody=function(e,t,n){var i=function(e){var t=r[e];if(!t)return null;var n=t.shift();return 0===t.length&&delete r[e],n}(n);i&&i(e,t)},this.onundefine=null,this.requestInputStream=function(t,i){i&&function(e,t){var n=r[e];n||(n=[],r[e]=n),n.push(t)}(t,i),e.requestObjectInputStream(n.index,t)},this.createOutputStream=function(t,r){return e.createObjectOutputStream(n.index,t,r)}},t.Object.ROOT_STREAM="/",t.Object.STREAM_INDEX_MIMETYPE="application/vnd.glyptodon.guacamole.stream-index+json",(t=t||{}).OnScreenKeyboard=function(e){var n=this,r={},i={},o=[],a=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},s=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(/([^ ]+)[ ]*/g,(function(e,n){return n===t?"":e}))},u=0,c=function(e,t,n,r){this.width=t,this.height=n,this.scale=function(i){e.style.width=t*i+"px",e.style.height=n*i+"px",r&&(e.style.lineHeight=n*i+"px",e.style.fontSize=i+"px")}},l=function(e){for(var t=0;t<e.length;t++){if(!(e[t]in r))return!1}return!0},h=function(e){var t=n.keys[e];if(!t)return null;for(var r=t.length-1;r>=0;r--){var i=t[r];if(l(i.requires))return i}return null},d=function(e,t){if(!i[e]){a(t,"guac-keyboard-pressed");var o=h(e);if(o.modifier){var u="guac-keyboard-modifier-"+g(o.modifier),c=r[o.modifier];void 0===c?(a(p,u),r[o.modifier]=o.keysym,o.keysym&&n.onkeydown&&n.onkeydown(o.keysym)):(s(p,u),delete r[o.modifier],c&&n.onkeyup&&n.onkeyup(c))}else n.onkeydown&&n.onkeydown(o.keysym);i[e]=!0}},f=function(e,t){if(i[e]){s(t,"guac-keyboard-pressed");var r=h(e);!r.modifier&&n.onkeyup&&n.onkeyup(r.keysym),i[e]=!1}},p=document.createElement("div");p.className="guac-keyboard",p.onselectstart=p.onmousemove=p.onmouseup=p.onmousedown=function(e){return u&&u--,e.stopPropagation(),!1},this.touchMouseThreshold=3,this.onkeydown=null,this.onkeyup=null,this.layout=new t.OnScreenKeyboard.Layout(e),this.getElement=function(){return p},this.resize=function(e){for(var t=Math.floor(10*e/n.layout.width)/10,r=0;r<o.length;r++){o[r].scale(t)}};var v=function(e,n){if(n instanceof Array){for(var r=[],i=0;i<n.length;i++)r.push(new t.OnScreenKeyboard.Key(n[i],e));return r}return"number"===typeof n?[new t.OnScreenKeyboard.Key({name:e,keysym:n})]:"string"===typeof n?[new t.OnScreenKeyboard.Key({name:e,title:n})]:[new t.OnScreenKeyboard.Key(n,e)]};this.keys=function(t){var n={};for(var r in e.keys)n[r]=v(r,t[r]);return n}(e.keys);var g=function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/[^A-Za-z0-9]+/g,"-").toLowerCase()};!function e(t,r,i){var s,l=document.createElement("div");if(i&&a(l,"guac-keyboard-"+g(i)),r instanceof Array)for(a(l,"guac-keyboard-group"),s=0;s<r.length;s++)e(l,r[s]);else if(r instanceof Object){a(l,"guac-keyboard-group");var h=Object.keys(r).sort();for(s=0;s<h.length;s++){i=h[s];e(l,r[i],i)}}else if("number"===typeof r)a(l,"guac-keyboard-gap"),o.push(new c(l,r,r));else if("string"===typeof r){var p=r;1===p.length&&(p="0x"+p.charCodeAt(0).toString(16)),a(l,"guac-keyboard-key-container");var v=document.createElement("div");v.className="guac-keyboard-key guac-keyboard-key-"+g(p);var y=n.keys[r];if(y)for(s=0;s<y.length;s++){var m=y[s],w=document.createElement("div");w.className="guac-keyboard-cap",w.textContent=m.title;for(var S=0;S<m.requires.length;S++){var T=m.requires[S];a(w,"guac-keyboard-requires-"+g(T)),a(v,"guac-keyboard-uses-"+g(T))}v.appendChild(w)}l.appendChild(v),o.push(new c(l,n.layout.keyWidths[r]||1,1,!0));var E=function(e){e.preventDefault(),0===u&&f(r,v)};v.addEventListener("touchstart",(function(e){e.preventDefault(),u=n.touchMouseThreshold,d(r,v)}),!0),v.addEventListener("touchend",(function(e){e.preventDefault(),u=n.touchMouseThreshold,f(r,v)}),!0),v.addEventListener("mousedown",(function(e){e.preventDefault(),0===u&&d(r,v)}),!0),v.addEventListener("mouseup",E,!0),v.addEventListener("mouseout",E,!0)}t.appendChild(l)}(p,e.layout)},t.OnScreenKeyboard.Layout=function(e){this.language=e.language,this.type=e.type,this.keys=e.keys,this.layout=e.layout,this.width=e.width,this.keyWidths=e.keyWidths||{}},t.OnScreenKeyboard.Key=function(e,t){this.name=t||e.name,this.title=e.title||this.name,this.keysym=e.keysym||function(e){if(!e||1!==e.length)return null;var t=e.charCodeAt(0);return t>=0&&t<=255?t:t>=256&&t<=1114111?16777216|t:null}(this.title),this.modifier=e.modifier,this.requires=e.requires||[]},(t=t||{}).OutputStream=function(e,t){var n=this;this.index=t,this.onack=null,this.sendBlob=function(t){e.sendBlob(n.index,t)},this.sendEnd=function(){e.endStream(n.index)}},(t=t||{}).Parser=function(){var e=this,t="",n=[],r=-1,i=0;this.receive=function(o){for(i>4096&&r>=i&&(t=t.substring(i),r-=i,i=0),t+=o;r<t.length;){if(r>=i){var a=t.substring(i,r),s=t.substring(r,r+1);if(n.push(a),";"==s){var u=n.shift();null!=e.oninstruction&&e.oninstruction(u,n),n.length=0}else if(","!=s)throw new Error("Illegal terminator.");i=r+1}var c=t.indexOf(".",i);if(-1==c){i=t.length;break}var l=parseInt(t.substring(r+1,c));if(isNaN(l))throw new Error("Non-numeric character in element length.");r=(i=c+1)+l}},this.oninstruction=null},(t=t||{}).Position=function(e){e=e||{},this.x=e.x||0,this.y=e.y||0,this.fromClientPosition=function(e,t,n){this.x=t-e.offsetLeft,this.y=n-e.offsetTop;for(var r=e.offsetParent;r&&r!==document.body;)this.x-=r.offsetLeft-r.scrollLeft,this.y-=r.offsetTop-r.scrollTop,r=r.offsetParent;if(r){var i=document.body.scrollLeft||document.documentElement.scrollLeft,o=document.body.scrollTop||document.documentElement.scrollTop;this.x-=r.offsetLeft-i,this.y-=r.offsetTop-o}}},t.Position.fromClientPosition=function(e,n,r){var i=new t.Position;return i.fromClientPosition(e,n,r),i},(t=t||{}).RawAudioFormat=function(e){this.bytesPerSample=e.bytesPerSample,this.channels=e.channels,this.rate=e.rate},t.RawAudioFormat.parse=function(e){var n,r=null,i=1;if("audio/L8;"===e.substring(0,9))e=e.substring(9),n=1;else{if("audio/L16;"!==e.substring(0,10))return null;e=e.substring(10),n=2}for(var o=e.split(","),a=0;a<o.length;a++){var s=o[a],u=s.indexOf("=");if(-1===u)return null;var c=s.substring(0,u),l=s.substring(u+1);switch(c){case"channels":i=parseInt(l);break;case"rate":r=parseInt(l);break;default:return null}}return null===r?null:new t.RawAudioFormat({bytesPerSample:n,channels:i,rate:r})},(t=t||{}).SessionRecording=function(e){var n=this,r=[],i=[],o=0,a=0,s=new t.SessionRecording._PlaybackTunnel,u=new t.Client(s),c=-1,l=null,h=null,d=null;u.connect(),u.getDisplay().showCursor(!1),e.oninstruction=function(e,s){var u=new t.SessionRecording._Frame.Instruction(e,s.slice());if(i.push(u),o+=u.getSize(),"sync"===e){var c=parseInt(s[0]),l=new t.SessionRecording._Frame(c,i);r.push(l),(1===r.length||o>=16384&&c-a>=5e3)&&(l.keyframe=!0,a=c,o=0),i=[],n.onprogress&&n.onprogress(n.getDuration())}};var f=function(e){return 0===r.length?0:e-r[0].timestamp},p=function e(t,n,i){if(t===n)return t;var o=Math.floor((t+n)/2),a=f(r[o].timestamp);return i<a&&o>t?e(t,o-1,i):i>a&&o<n?e(o+1,n,i):o},v=function(e){for(var t=r[e],n=0;n<t.instructions.length;n++){var i=t.instructions[n];s.receiveInstruction(i.opcode,i.args)}t.keyframe&&!t.clientState&&u.exportState((function(e){t.clientState=e}))},g=function e(t,i,o){y(),d=window.setTimeout((function(){var a;for(a=t;a>=0;a--){var s=r[a];if(a===c)break;if(s.clientState){u.importState(s.clientState);break}}a++;for(var l=(new Date).getTime();a<=t;a++){if((new Date).getTime()-l>=5)break;v(a)}c=a-1,n.onseek&&n.onseek(n.getPosition()),c!==t?e(t,i,Math.max(o-((new Date).getTime()-l),0)):i()}),o||0)},y=function(){window.clearTimeout(d)},m=function e(){if(c+1<r.length){var t=r[c+1].timestamp-l+h,i=Math.max(t-(new Date).getTime(),0);g(c+1,(function(){e()}),i)}else n.pause()};this.onprogress=null,this.onplay=null,this.onpause=null,this.onseek=null,this.connect=function(t){e.connect(t)},this.disconnect=function(){e.disconnect()},this.getDisplay=function(){return u.getDisplay()},this.isPlaying=function(){return!!l},this.getPosition=function(){return-1===c?0:f(r[c].timestamp)},this.getDuration=function(){return 0===r.length?0:f(r[r.length-1].timestamp)},this.play=function(){if(!n.isPlaying()&&c+1<r.length){n.onplay&&n.onplay();var e=r[c+1];l=e.timestamp,h=(new Date).getTime(),m()}},this.seek=function(e,t){if(0!==r.length){var i=n.isPlaying();n.pause(),g(p(0,r.length-1,e),(function(){i&&n.play(),t&&t()}))}},this.pause=function(){y(),n.isPlaying()&&(n.onpause&&n.onpause(),l=null,h=null)}},t.SessionRecording._Frame=function(e,t){this.keyframe=!1,this.timestamp=e,this.instructions=t,this.clientState=null},t.SessionRecording._Frame.Instruction=function(e,t){var n=this;this.opcode=e,this.args=t,this.getSize=function(){for(var e=n.opcode.length,t=0;t<n.args.length;t++)e+=n.args[t].length;return e}},t.SessionRecording._PlaybackTunnel=function(){var e=this;this.connect=function(e){},this.sendMessage=function(e){},this.disconnect=function(){},this.receiveInstruction=function(t,n){e.oninstruction&&e.oninstruction(t,n)}},(t=t||{}).Status=function(e,t){var n=this;this.code=e,this.message=t,this.isError=function(){return n.code<0||n.code>255}},t.Status.Code={SUCCESS:0,UNSUPPORTED:256,SERVER_ERROR:512,SERVER_BUSY:513,UPSTREAM_TIMEOUT:514,UPSTREAM_ERROR:515,RESOURCE_NOT_FOUND:516,RESOURCE_CONFLICT:517,RESOURCE_CLOSED:518,UPSTREAM_NOT_FOUND:519,UPSTREAM_UNAVAILABLE:520,SESSION_CONFLICT:521,SESSION_TIMEOUT:522,SESSION_CLOSED:523,CLIENT_BAD_REQUEST:768,CLIENT_UNAUTHORIZED:769,CLIENT_FORBIDDEN:771,CLIENT_TIMEOUT:776,CLIENT_OVERRUN:781,CLIENT_BAD_TYPE:783,CLIENT_TOO_MANY:797},t.Status.Code.fromHTTPCode=function(e){switch(e){case 400:return t.Status.Code.CLIENT_BAD_REQUEST;case 403:return t.Status.Code.CLIENT_FORBIDDEN;case 404:return t.Status.Code.RESOURCE_NOT_FOUND;case 429:return t.Status.Code.CLIENT_TOO_MANY;case 503:return t.Status.Code.SERVER_BUSY}return t.Status.Code.SERVER_ERROR},t.Status.Code.fromWebSocketCode=function(e){switch(e){case 1e3:return t.Status.Code.SUCCESS;case 1006:case 1015:return t.Status.Code.UPSTREAM_NOT_FOUND;case 1001:case 1012:case 1013:case 1014:return t.Status.Code.UPSTREAM_UNAVAILABLE}return t.Status.Code.SERVER_ERROR},(t=t||{}).StringReader=function(e){var n=this,r=new t.ArrayBufferReader(e),i=0,o=0;r.ondata=function(e){var t=function(e){for(var t="",n=new Uint8Array(e),r=0;r<n.length;r++){var a=n[r];0===i?127===(127|a)?t+=String.fromCharCode(a):223===(31|a)?(o=31&a,i=1):239===(15|a)?(o=15&a,i=2):247===(7|a)?(o=7&a,i=3):t+="\ufffd":191===(63|a)?(o=o<<6|63&a,0===--i&&(t+=String.fromCharCode(o))):(i=0,t+="\ufffd")}return t}(e);n.ontext&&n.ontext(t)},r.onend=function(){n.onend&&n.onend()},this.ontext=null,this.onend=null},(t=t||{}).StringWriter=function(e){var n=this,r=new t.ArrayBufferWriter(e),i=new Uint8Array(8192),o=0;function a(e){var t,n;if(e<=127)t=0,n=1;else if(e<=2047)t=192,n=2;else if(e<=65535)t=224,n=3;else{if(!(e<=2097151))return void a(65533);t=240,n=4}!function(e){if(o+e>=i.length){var t=new Uint8Array(2*(o+e));t.set(i),i=t}o+=e}(n);for(var r=o-1,s=1;s<n;s++)i[r--]=128|63&e,e>>=6;i[r]=t|e}r.onack=function(e){n.onack&&n.onack(e)},this.sendText=function(e){e.length&&r.sendData(function(e){for(var t=0;t<e.length;t++)a(e.charCodeAt(t));if(o>0){var n=i.subarray(0,o);return o=0,n}}(e))},this.sendEnd=function(){r.sendEnd()},this.onack=null},(t=t||{}).Touch=function(e){t.Event.Target.call(this);var n=this,r=Math.floor(16*window.devicePixelRatio);this.touches={},this.activeTouches=0,e.addEventListener("touchstart",(function(i){for(var o=0;o<i.changedTouches.length;o++){var a=i.changedTouches[o],s=a.identifier;if(!n.touches[s]){var u=n.touches[s]=new t.Touch.State({id:s,radiusX:a.radiusX||r,radiusY:a.radiusY||r,angle:a.angle||0,force:a.force||1});n.activeTouches++,u.fromClientPosition(e,a.clientX,a.clientY),n.dispatch(new t.Touch.Event("touchmove",i,u))}}}),!1),e.addEventListener("touchmove",(function(i){for(var o=0;o<i.changedTouches.length;o++){var a=i.changedTouches[o],s=a.identifier,u=n.touches[s];u&&(a.force&&(u.force=a.force),u.angle=a.angle||0,u.radiusX=a.radiusX||r,u.radiusY=a.radiusY||r,u.fromClientPosition(e,a.clientX,a.clientY),n.dispatch(new t.Touch.Event("touchmove",i,u)))}}),!1),e.addEventListener("touchend",(function(r){for(var i=0;i<r.changedTouches.length;i++){var o=r.changedTouches[i],a=o.identifier,s=n.touches[a];s&&(delete n.touches[a],n.activeTouches--,s.force=0,s.fromClientPosition(e,o.clientX,o.clientY),n.dispatch(new t.Touch.Event("touchend",r,s)))}}),!1)},t.Touch.State=function(e){e=e||{},t.Position.call(this,e),this.id=e.id||0,this.radiusX=e.radiusX||0,this.radiusY=e.radiusY||0,this.angle=e.angle||0,this.force=e.force||1},t.Touch.Event=function(e,n,r){t.Event.DOMEvent.call(this,e,[n]),this.state=r},(t=t||{}).Tunnel=function(){this.connect=function(e){},this.disconnect=function(){},this.sendMessage=function(e){},this.setState=function(e){e!==this.state&&(this.state=e,this.onstatechange&&this.onstatechange(e))},this.setUUID=function(e){this.uuid=e,this.onuuid&&this.onuuid(e)},this.isConnected=function(){return this.state===t.Tunnel.State.OPEN||this.state===t.Tunnel.State.UNSTABLE},this.state=t.Tunnel.State.CONNECTING,this.receiveTimeout=15e3,this.unstableThreshold=1500,this.uuid=null,this.onuuid=null,this.onerror=null,this.onstatechange=null,this.oninstruction=null},t.Tunnel.INTERNAL_DATA_OPCODE="",t.Tunnel.State={CONNECTING:0,OPEN:1,CLOSED:2,UNSTABLE:3},t.HTTPTunnel=function(e,n,r){var i=this,o=e+"?connect",a=e+"?read:",s=e+"?write:",u=1,c=!1,l="",h=!!n,d=null,f=null,p=null,v=r||{},g="Guacamole-Tunnel-Token",y=null;function m(e,t){for(var n in t)e.setRequestHeader(n,t[n])}function w(){window.clearTimeout(d),window.clearTimeout(f),i.state===t.Tunnel.State.UNSTABLE&&i.setState(t.Tunnel.State.OPEN),d=window.setTimeout((function(){S(new t.Status(t.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))}),i.receiveTimeout),f=window.setTimeout((function(){i.setState(t.Tunnel.State.UNSTABLE)}),i.unstableThreshold)}function S(e){window.clearTimeout(d),window.clearTimeout(f),window.clearInterval(p),i.state!==t.Tunnel.State.CLOSED&&(e.code!==t.Status.Code.SUCCESS&&i.onerror&&(i.state!==t.Tunnel.State.CONNECTING&&e.code===t.Status.Code.RESOURCE_NOT_FOUND||i.onerror(e)),c=!1,i.setState(t.Tunnel.State.CLOSED))}function T(){if(i.isConnected())if(l.length>0){c=!0;var e=new XMLHttpRequest;e.open("POST",s+i.uuid),e.withCredentials=h,m(e,v),e.setRequestHeader("Content-type","application/octet-stream"),e.setRequestHeader(g,y),e.onreadystatechange=function(){4===e.readyState&&(w(),200!==e.status?E(e):T())},e.send(l),l=""}else c=!1}function E(e){var n=parseInt(e.getResponseHeader("Guacamole-Status-Code"));if(n){var r=e.getResponseHeader("Guacamole-Error-Message");S(new t.Status(n,r))}else e.status?S(new t.Status(t.Status.Code.fromHTTPCode(e.status),e.statusText)):S(new t.Status(t.Status.Code.UPSTREAM_NOT_FOUND))}function b(e){var t=null,n=null,r=0,o=-1,a=0,s=new Array;function c(){if(i.isConnected()){if(!(e.readyState<2)){var r;try{r=e.status}catch(g){r=200}if(n||200!==r||(n=C()),3===e.readyState||4===e.readyState){if(w(),1===u&&(3!==e.readyState||t?4===e.readyState&&t&&clearInterval(t):t=setInterval(c,30)),0===e.status)return void i.disconnect();if(200!==e.status)return void E(e);var l;try{l=e.responseText}catch(g){return}for(;o<l.length;){if(o>=a){var h=l.substring(a,o),d=l.substring(o,o+1);if(s.push(h),";"===d){var f=s.shift();i.oninstruction&&i.oninstruction(f,s),s.length=0}a=o+1}var p=l.indexOf(".",a);if(-1===p){a=l.length;break}var v=parseInt(l.substring(o+1,p));if(0===v){t&&clearInterval(t),e.onreadystatechange=null,e.abort(),n&&b(n);break}o=(a=p+1)+v}}}}else null!==t&&clearInterval(t)}e.onreadystatechange=1===u?function(){3===e.readyState&&++r>=2&&(u=0,e.onreadystatechange=c),c()}:c,c()}this.sendMessage=function(){if(i.isConnected()&&0!==arguments.length){for(var e=n(arguments[0]),t=1;t<arguments.length;t++)e+=","+n(arguments[t]);l+=e+=";",c||T()}function n(e){var t=new String(e);return t.length+"."+t}};var I=0;function C(){var e=new XMLHttpRequest;return e.open("GET",a+i.uuid+":"+I++),e.setRequestHeader(g,y),e.withCredentials=h,m(e,v),e.send(null),e}this.connect=function(e){w(),i.setState(t.Tunnel.State.CONNECTING);var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&(200===n.status?(w(),i.setUUID(n.responseText),(y=n.getResponseHeader(g))?(i.setState(t.Tunnel.State.OPEN),p=setInterval((function(){i.sendMessage("nop")}),500),b(C())):S(new t.Status(t.Status.Code.UPSTREAM_NOT_FOUND))):E(n))},n.open("POST",o,!0),n.withCredentials=h,m(n,v),n.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(e)},this.disconnect=function(){S(new t.Status(t.Status.Code.SUCCESS,"Manually closed."))}},t.HTTPTunnel.prototype=new t.Tunnel,t.WebSocketTunnel=function(e){var n=this,r=null,i=null,o=null,a=null;if("ws:"!==e.substring(0,3)&&"wss:"!==e.substring(0,4)){var s={"http:":"ws:","https:":"wss:"}[window.location.protocol];if("/"===e.substring(0,1))e=s+"//"+window.location.host+e;else{var u=window.location.pathname.lastIndexOf("/"),c=window.location.pathname.substring(0,u+1);e=s+"//"+window.location.host+c+e}}function l(){window.clearTimeout(i),window.clearTimeout(o),n.state===t.Tunnel.State.UNSTABLE&&n.setState(t.Tunnel.State.OPEN),i=window.setTimeout((function(){h(new t.Status(t.Status.Code.UPSTREAM_TIMEOUT,"Server timeout."))}),n.receiveTimeout),o=window.setTimeout((function(){n.setState(t.Tunnel.State.UNSTABLE)}),n.unstableThreshold)}function h(e){window.clearTimeout(i),window.clearTimeout(o),window.clearInterval(a),n.state!==t.Tunnel.State.CLOSED&&(e.code!==t.Status.Code.SUCCESS&&n.onerror&&n.onerror(e),n.setState(t.Tunnel.State.CLOSED),r.close())}this.sendMessage=function(e){if(n.isConnected()&&0!==arguments.length){for(var t=o(arguments[0]),i=1;i<arguments.length;i++)t+=","+o(arguments[i]);t+=";",r.send(t)}function o(e){var t=new String(e);return t.length+"."+t}},this.connect=function(i){l(),n.setState(t.Tunnel.State.CONNECTING),(r=new WebSocket(e+"?"+i,"guacamole")).onopen=function(e){l(),a=setInterval((function(){n.sendMessage(t.Tunnel.INTERNAL_DATA_OPCODE,"ping",(new Date).getTime())}),500)},r.onclose=function(e){e.reason?h(new t.Status(parseInt(e.reason),e.reason)):e.code?h(new t.Status(t.Status.Code.fromWebSocketCode(e.code))):h(new t.Status(t.Status.Code.UPSTREAM_NOT_FOUND))},r.onmessage=function(e){l();var r,i=e.data,o=0,a=[];do{var s=i.indexOf(".",o);if(-1!==s)r=(o=s+1)+parseInt(i.substring(r+1,s));else h(new t.Status(t.Status.Code.SERVER_ERROR,"Incomplete instruction."));var u=i.substring(o,r),c=i.substring(r,r+1);if(a.push(u),";"===c){var d=a.shift();null===n.uuid&&(d===t.Tunnel.INTERNAL_DATA_OPCODE&&n.setUUID(a[0]),n.setState(t.Tunnel.State.OPEN)),d!==t.Tunnel.INTERNAL_DATA_OPCODE&&n.oninstruction&&n.oninstruction(d,a),a.length=0}o=r+1}while(o<i.length)}},this.disconnect=function(){h(new t.Status(t.Status.Code.SUCCESS,"Manually closed."))}},t.WebSocketTunnel.prototype=new t.Tunnel,t.ChainedTunnel=function(e){for(var n,r=this,i=[],o=null,a=0;a<arguments.length;a++)i.push(arguments[a]);function s(e){r.disconnect=e.disconnect,r.sendMessage=e.sendMessage;var a=function(n){if(n&&n.code===t.Status.Code.UPSTREAM_TIMEOUT)return i=[],null;var r=i.shift();return r&&(e.onerror=null,e.oninstruction=null,e.onstatechange=null,s(r)),r};function u(){e.onstatechange=r.onstatechange,e.oninstruction=r.oninstruction,e.onerror=r.onerror,e.onuuid=r.onuuid,e.uuid&&r.setUUID(e.uuid),o=e}e.onstatechange=function(e){switch(e){case t.Tunnel.State.OPEN:u(),r.onstatechange&&r.onstatechange(e);break;case t.Tunnel.State.CLOSED:!a()&&r.onstatechange&&r.onstatechange(e)}},e.oninstruction=function(e,t){u(),r.oninstruction&&r.oninstruction(e,t)},e.onerror=function(e){!a(e)&&r.onerror&&r.onerror(e)},e.connect(n)}this.connect=function(e){n=e;var a=o||i.shift();a?s(a):r.onerror&&r.onerror(t.Status.Code.SERVER_ERROR,"No tunnels to try.")}},t.ChainedTunnel.prototype=new t.Tunnel,t.StaticHTTPTunnel=function(e,n,r){var i=this,o=null,a=r||{};this.sendMessage=function(e){},this.connect=function(r){i.disconnect(),i.setState(t.Tunnel.State.CONNECTING),(o=new XMLHttpRequest).open("GET",e),o.withCredentials=!!n,function(e,t){for(var n in t)e.setRequestHeader(n,t[n])}(o,a),o.responseType="text",o.send(null);var s=0,u=new t.Parser;u.oninstruction=function(e,t){i.oninstruction&&i.oninstruction(e,t)},o.onreadystatechange=function(){if(3===o.readyState||4===o.readyState){i.setState(t.Tunnel.State.OPEN);var e=o.responseText,n=e.length;s<n&&(u.receive(e.substring(s)),s=n)}4===o.readyState&&i.disconnect()},o.onerror=function(){i.onerror&&i.onerror(new t.Status(t.Status.Code.fromHTTPCode(o.status),o.statusText)),i.disconnect()}},this.disconnect=function(){o&&(o.abort(),o=null),i.setState(t.Tunnel.State.CLOSED)}},t.StaticHTTPTunnel.prototype=new t.Tunnel,(t=t||{}).API_VERSION="1.4.0",(t=t||{}).VideoPlayer=function(){this.sync=function(){}},t.VideoPlayer.isSupportedType=function(e){return!1},t.VideoPlayer.getSupportedTypes=function(){return[]},t.VideoPlayer.getInstance=function(e,t,n){return null},e.exports=t}}]);