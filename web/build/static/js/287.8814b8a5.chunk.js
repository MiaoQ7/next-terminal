"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[287],{16018:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(93766),r=s(21215),c=s.n(r);class n{constructor(e){this.group="",this.getById=async e=>{let t=await a.A.get("/".concat(this.group,"/").concat(e));if(1===t.code)return t.data},this.getPaging=async e=>{let t=c().stringify(e),s=await a.A.get("/".concat(this.group,"/paging?").concat(t));return 1!==s.code?{}:s.data},this.getAll=async()=>{let e=await a.A.get("/".concat(this.group));return 1!==e.code?[]:e.data},this.create=async e=>1===(await a.A.post("/".concat(this.group),e)).code,this.updateById=async(e,t)=>1===(await a.A.put("/".concat(this.group,"/").concat(e),t)).code,this.deleteById=async e=>1===(await a.A.delete("/".concat(this.group,"/").concat(e))).code,this.group=e}}},75098:(e,t,s)=>{s.d(t,{A:()=>o});var a=s(93766),r=s(21215),c=s.n(r),n=s(16018);class i extends n.A{constructor(){super("login-policies"),this.Bind=async(e,t)=>1===(await a.A.post("/".concat(this.group,"/").concat(e,"/bind"),t)).code,this.Unbind=async(e,t)=>1===(await a.A.post("/".concat(this.group,"/").concat(e,"/unbind"),t)).code,this.GetUserPagingByForbiddenCommandId=async(e,t)=>{let s=c().stringify(t),r=await a.A.get("/".concat(this.group,"/").concat(e,"/users/paging?").concat(s));return 1!==r.code?{}:r.data},this.GetUserIdByLoginPolicyId=async e=>{let t=await a.A.get("/".concat(this.group,"/").concat(e,"/users/id"));return 1!==t.code?[]:t.data}}}const o=new i},60287:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var a=s(9950),r=s(68832),c=s(56231),n=s(48538),i=s(27666),o=s(87827),l=s(87427),d=s(55902),h=s(6579),u=s(17811),g=s(52765),p=s(69627),m=s(27646),f=s(44414);const x=Array.from(Array(24)).map(((e,t)=>t)),w=(e,t)=>{const s={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(const a in s)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?s[a]:("00"+s[a]).substr((""+s[a]).length)));return t},y=["\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d","\u661f\u671f\u65e5"].map(((e,t)=>({value:e,row:t,child:((e,t,s)=>{return(a=s,Array.from(Array(a)).map(((e,t)=>t))).map(((s,a)=>{let r=(e=>{const t=1542384e6+18e5*e,s=t+18e5,a=w(new Date(t),"hh:mm"),r=w(new Date(s),"hh:mm");return"".concat(a,"~").concat(r)})(a);return{week:e,value:r,begin:r.split("~")[0],end:r.split("~")[1],row:t,col:a,checked:!1}}));var a})(e,t,48)}))),A=e=>{const t=[];let s=!1;for(const a in e){let r=e[a];r.checked&&(r.checked!==s?t.push("\u3001",r.begin,"~",r.end):t.length&&(t.pop(),t.push(r.end))),s=r.checked}return t.shift(),t.join("")},j=e=>{let{onRef:t,onChange:s}=e;(0,a.useImperativeHandle)(t,(()=>({renderWeekTime:O,reset:N})));let[r,c]=(0,a.useState)(y),[n,i]=(0,a.useState)(!1),[o,l]=(0,a.useState)(!1),[d,h]=(0,a.useState)(0),[u,g]=(0,a.useState)(0),[w,j]=(0,a.useState)(0),[S,I]=(0,a.useState)({width:0,height:0,left:0,top:0}),[k,v]=(0,a.useState)([]);const E=(e,t,s)=>{const[a,n]=e,[i,o]=t;r.forEach((e=>{e.child.forEach((e=>{e.row>=a&&e.row<=n&&e.col>=i&&e.col<=o&&(e.checked=s)}))})),c(r)},N=()=>{r.forEach((e=>{e.child.forEach((e=>{e.checked=!1}))})),c(r),C([])},b=()=>{let e=r.map((e=>({key:6===e.row?0:e.row+1,value:A(e.child)})));C(e)},C=e=>{s&&s(e),e.length>0?i(!0):i(!1),v(e)},O=e=>{N();for(let t in e){let s=e[t].value;if(!(0,m.I3)(s))continue;let a=s.split("\u3001");for(const r in a)T(e[t].key,a[r])}b()},T=(e,t)=>{let s=0===e?6:e-1;const[a,n]=t.split("~"),i=L(a),o=L(n);for(let c=i;c<(0===o?48:o);c++){r[s].child[c].checked=!0}c(r)},L=e=>{const t=e.substr(0,2),s=t.startsWith("0")?t.substr(1,2):t,a=RegExp(/30/);return 2*s+(e.match(a)?1:0)};return(0,f.jsxs)("div",{className:"week-time",children:[(0,f.jsx)("div",{className:"schedule ".concat(o?"schedule-notransi":""),style:S}),(0,f.jsxs)("table",{className:"week-time-table",children:[(0,f.jsxs)("thead",{className:"week-time-head",children:[(0,f.jsxs)("tr",{children:[(0,f.jsx)("th",{rowSpan:8,className:"week-td",children:"\u661f\u671f/\u65f6\u95f4"}),(0,f.jsx)("th",{colSpan:24,children:"00:00 - 12:00"}),(0,f.jsx)("th",{colSpan:24,children:"12:00 - 24:00"})]}),(0,f.jsx)("tr",{children:x.map((e=>(0,f.jsx)("td",{colSpan:2,children:e},e)))})]}),(0,f.jsxs)("tbody",{className:"week-time-body",children:[r.map((e=>(0,f.jsxs)("tr",{children:[(0,f.jsx)("td",{children:e.value},"td"+e.value),e.child.map((e=>(0,f.jsx)("td",{className:"week-time-item ".concat(e.checked?"ui-selected":""),onMouseEnter:t=>((e,t)=>{let{width:s,height:a,left:r,top:c}=S;o?t.col<=u&&t.row<=d?(s=(u-t.col+1)*e.target.offsetWidth,a=(d-t.row+1)*e.target.offsetHeight,r=e.target.offsetLeft,c=e.target.offsetTop):t.col>=u&&t.row>=d?(s=(t.col-u+1)*e.target.offsetWidth,a=(t.row-d+1)*e.target.offsetHeight,t.col>u&&t.row===d&&(c=e.target.offsetTop),t.col===u&&t.row>d&&(r=e.target.offsetLeft)):t.col>u&&t.row<d?(s=(t.col-u+1)*e.target.offsetWidth,a=(d-t.row+1)*e.target.offsetHeight,c=e.target.offsetTop):t.col<u&&t.row>d&&(s=(u-t.col+1)*e.target.offsetWidth,a=(t.row-d+1)*e.target.offsetHeight,r=e.target.offsetLeft):(r=e.target.offsetLeft,c=e.target.offsetTop),I({width:s,height:a,left:r,top:c})})(t,e),onMouseDown:t=>((e,t)=>{j(t.checked),l(!0),h(t.row),g(t.col)})(0,e),onMouseUp:t=>((e,t)=>{t.col<=u&&t.row<=d?E([t.row,d],[t.col,u],!w):t.col>=u&&t.row>=d?E([d,t.row],[u,t.col],!w):t.col>u&&t.row<d?E([t.row,d],[u,t.col],!w):t.col<u&&t.row>d&&E([d,t.row],[t.col,u],!w),I({width:0,height:0,left:0,top:0}),l(!1),b()})(0,e)},"".concat(e.row,"-").concat(e.col))))]},"tr"+e.value))),(0,f.jsx)("tr",{children:(0,f.jsxs)("td",{colSpan:"49",className:"week-time-preview",children:[(0,f.jsxs)("div",{className:"d-clearfix week-time-con",children:[(0,f.jsx)("span",{className:"g-pull-left",children:n?"\u5df2\u9009\u62e9\u65f6\u95f4\u6bb5":"\u53ef\u62d6\u52a8\u9f20\u6807\u9009\u62e9\u65f6\u95f4\u6bb5"}),(0,f.jsx)("a",{className:"g-pull-right",onClick:N,children:"\u6e05\u7a7a\u9009\u62e9"}),(0,f.jsx)("a",{className:"g-pull-right",onClick:()=>{r.forEach((e=>{e.child.forEach((e=>{e.checked=!0}))})),c(r),b()},children:"\u5168\u9009"})]}),n?(0,f.jsx)("div",{className:"week-time-time",children:k.map((e=>{if((0,m.I3)(e.value))return(0,f.jsx)("div",{children:(0,f.jsxs)("p",{children:[(0,f.jsx)("span",{className:"g-tip-text",children:(0,p.N)(e.key)}),(0,f.jsx)("span",{children:e.value})]})},e.key)}))}):void 0]})})]})]})]})};var S=s(75098);const I={labelCol:{span:4},wrapperCol:{span:18}};let k=a.createRef();const v=e=>{let{visible:t,handleOk:s,handleCancel:r,confirmLoading:c,id:n,userId:i}=e;const[p]=o.A.useForm();return(0,a.useEffect)((()=>{t&&n?(async()=>{let e=await S.A.getById(n);e&&(p.setFieldsValue(e),k.current.renderWeekTime(e.timePeriod))})():p.setFieldsValue({ipGroup:"0.0.0.0/0",priority:50,rule:"reject",enabled:!0})}),[t]),(0,f.jsx)(l.A,{title:n?"\u66f4\u65b0\u767b\u5f55\u7b56\u7565":"\u65b0\u5efa\u767b\u5f55\u7b56\u7565",visible:t,maskClosable:!1,destroyOnClose:!0,width:900,onOk:()=>{p.validateFields().then((async e=>{e.userId=i,await s(e)&&p.resetFields()}))},onCancel:()=>{p.resetFields(),k.current.reset(),r()},confirmLoading:c,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,f.jsxs)(o.A,{form:p,...I,children:[(0,f.jsx)(o.A.Item,{name:"id",noStyle:!0,children:(0,f.jsx)(d.A,{hidden:!0})}),(0,f.jsx)(o.A.Item,{label:"\u540d\u79f0",name:"name",rules:[{required:!0}],children:(0,f.jsx)(d.A,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u7b56\u7565\u540d\u79f0"})}),(0,f.jsx)(o.A.Item,{label:"\u4f18\u5148\u7ea7",name:"priority",rules:[{required:!0}],extra:"\u4f18\u5148\u7ea7\u53ef\u9009\u8303\u56f4\u4e3a 1-100 (\u6570\u503c\u8d8a\u5c0f\u8d8a\u4f18\u5148)",children:(0,f.jsx)(h.A,{autoComplete:"off",min:1,max:100})}),(0,f.jsx)(o.A.Item,{label:"IP\u5730\u5740",name:"ipGroup",rules:[{required:!0}],extra:"\u683c\u5f0f\u4e3a\u9017\u53f7\u5206\u9694\u7684\u5b57\u7b26\u4e32, 0.0.0.0/0 \u5339\u914d\u6240\u6709\u3002\u4f8b\u5982: 192.168.0.1, 192.168.1.0/24, 192.168.2.0-192.168.2.20",children:(0,f.jsx)(d.A,{autoComplete:"off"})}),(0,f.jsx)(o.A.Item,{label:"\u65f6\u6bb5",name:"timePeriod",children:(0,f.jsx)(j,{onRef:k})}),(0,f.jsx)(o.A.Item,{label:"\u89c4\u5219",name:"rule",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u89c4\u5219"}],children:(0,f.jsxs)(u.Ay.Group,{children:[(0,f.jsx)(u.Ay,{value:"allow",children:"\u5141\u8bb8"}),(0,f.jsx)(u.Ay,{value:"reject",children:"\u62d2\u7edd"})]})}),(0,f.jsx)(o.A.Item,{label:"\u6fc0\u6d3b",name:"enabled",valuePropName:"checked",rules:[{required:!0}],children:(0,f.jsx)(g.A,{})})]})})};var E=s(42074),N=s(27891),b=s(68201),C=s(50070);const O=S.A,{Content:T}=r.A,L=a.createRef(),R=()=>{let[e,t]=(0,a.useState)(!1),[s,r]=(0,a.useState)(!1),[o,l]=(0,a.useState)(void 0);const[d,h]=(0,N.j)(N.A.LOGIN_POLICY),u=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u540d\u79f0",dataIndex:"name",render:(e,t)=>{let s=(0,f.jsx)("div",{children:e});return(0,C.as)("login-policy-detail")&&(s=(0,f.jsx)(E.N_,{to:"/login-policy/".concat(t.id),children:e})),s}},{title:"\u4f18\u5148\u7ea7",key:"priority",dataIndex:"priority",sorter:!0,hideInSearch:!0},{title:"\u52a8\u4f5c",key:"rule",dataIndex:"rule",hideInSearch:!0,render:e=>"allow"===e?"\u5141\u8bb8":"\u62d2\u7edd"},{title:"\u64cd\u4f5c",valueType:"option",key:"option",render:(e,s,a,r)=>[(0,f.jsx)(b.A,{menu:"login-policy-edit",children:(0,f.jsx)("a",{onClick:()=>{t(!0),l(s.id)},children:"\u7f16\u8f91"},"edit")},"login-policy-edit"),(0,f.jsx)(b.A,{menu:"login-policy-del",children:(0,f.jsx)(c.A,{title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64\u884c\u5417?",onConfirm:async()=>{await O.deleteById(s.id),L.current.reload()},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",children:(0,f.jsx)("a",{className:"danger",children:"\u5220\u9664"},"delete")},"confirm-delete")},"login-policy-del")]}];return(0,f.jsx)("div",{children:(0,f.jsxs)(T,{className:"page-container",children:[(0,f.jsx)(i.A,{columns:u,actionRef:L,columnsState:{value:d,onChange:h},request:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,s="",a="";Object.keys(t).length>0&&(s=Object.keys(t)[0],a=Object.values(t)[0]);let r={pageIndex:e.current,pageSize:e.pageSize,name:e.name,field:s,order:a},c=await O.getPaging(r);return{data:c.items,success:!0,total:c.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{pageSize:10},dateFormatter:"string",headerTitle:"\u7528\u6237\u767b\u5f55\u7b56\u7565",toolBarRender:()=>[(0,f.jsx)(b.A,{menu:"login-policy-add",children:(0,f.jsx)(n.A,{type:"primary",onClick:()=>{t(!0)},children:"\u65b0\u5efa"},"button")})]}),(0,f.jsx)(v,{id:o,visible:e,confirmLoading:s,handleCancel:()=>{t(!1),l(void 0)},handleOk:async e=>{r(!0);try{let s;s=e.id?await O.updateById(e.id,e):await O.create(e),s&&t(!1),L.current.reload()}finally{r(!1)}}})]})})}},68201:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(50070);const r=e=>{let{menu:t,children:s}=e;if(Array.isArray(t)){if((0,a.as)(...t))return s}else if((0,a.as)(t))return s}},27891:(e,t,s)=>{s.d(t,{A:()=>n,j:()=>i});var a=s(98409),r=s(9950);let c=new class{constructor(){this.ASSET="cs-asset",this.CREDENTIAL="cs-credential",this.COMMAND="cs-command",this.ACCESS_GATEWAY="cs-access-gateway",this.ONLINE_SESSION="cs-online-session",this.OFFLINE_SESSION="cs-offline-session",this.LOGIN_LOG="cs-login-log",this.STORAGE_LOG="cs-storage-log",this.JOB="cs-job",this.STORAGE="cs-storage",this.LOGIN_POLICY="cs-login-policy",this.ACCESS_SECURITY="cs-access-security",this.USER="cs-user",this.ROLE="cs-role",this.USER_GROUP="cs-user-group",this.COMMAND_FILTER="cs-command-filter",this.STRATEGY="cs-strategy"}};const n=c,i=e=>{let[t,s]=(0,r.useState)(o(e));return[t,t=>{new Promise((e=>{s(t),e(t)})).then((t=>{l(e,t)}))}]},o=e=>{switch(e){case c.ASSET:case c.CREDENTIAL:case c.COMMAND:case c.ACCESS_GATEWAY:case c.ONLINE_SESSION:case c.OFFLINE_SESSION:}return d(e,{})},l=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},d=(e,t)=>{let s=localStorage.getItem(e);if(!a.A.hasText(s))return t;try{return JSON.parse(s)}catch(r){return t}}},98409:(e,t,s)=>{s.d(t,{A:()=>a});const a=new class{constructor(){this.hasText=function(e){return!(void 0===e||null===e||0===e.length)},this.zeroPad=function(e,t){let s=e.toString();for(;s.length<t;)s="0"+s;return s}}}},69627:(e,t,s)=>{s.d(t,{N:()=>r});const a={1:"\u4e00",2:"\u4e8c",3:"\u4e09",4:"\u56db",5:"\u4e94",6:"\u516d",0:"\u65e5"},r=e=>"\u661f\u671f"+a[e]}}]);