"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[2891],{16018:(e,t,s)=>{s.d(t,{A:()=>r});var i=s(93766),a=s(21215),n=s.n(a);class r{constructor(e){this.group="",this.getById=async e=>{let t=await i.A.get("/".concat(this.group,"/").concat(e));if(1===t.code)return t.data},this.getPaging=async e=>{let t=n().stringify(e),s=await i.A.get("/".concat(this.group,"/paging?").concat(t));return 1!==s.code?{}:s.data},this.getAll=async()=>{let e=await i.A.get("/".concat(this.group));return 1!==e.code?[]:e.data},this.create=async e=>1===(await i.A.post("/".concat(this.group),e)).code,this.updateById=async(e,t)=>1===(await i.A.put("/".concat(this.group,"/").concat(e),t)).code,this.deleteById=async e=>1===(await i.A.delete("/".concat(this.group,"/").concat(e))).code,this.group=e}}},40670:(e,t,s)=>{s.d(t,{A:()=>c});var i=s(16018),a=s(21215),n=s.n(a),r=s(93766);class o extends i.A{constructor(){super("sessions"),this.GetCommandPagingBySessionId=async(e,t)=>{let s=n().stringify(t),i=await r.A.get("/".concat(this.group,"/").concat(e,"/commands/paging?").concat(s));return 1!==i.code?{}:i.data},this.create=async(e,t)=>{let s=await r.A.post("/".concat(this.group,"?assetId=").concat(e,"&mode=").concat(t));return 1!==s.code?{}:s.data},this.connect=async e=>1===(await r.A.post("/".concat(this.group,"/").concat(e,"/connect"))).code,this.disconnect=async e=>1===(await r.A.post("/".concat(this.group,"/").concat(e,"/disconnect"))).code,this.clear=async()=>1===(await r.A.post("/".concat(this.group,"/clear"))).code,this.stats=async e=>{let t=await r.A.get("/".concat(this.group,"/").concat(e,"/stats"));return 1!==t.code?{}:t.data},this.resize=async(e,t,s)=>1===(await r.A.post("/sessions/".concat(e,"/resize?width=").concat(t,"&height=").concat(s))).code}}const c=new o},60715:(e,t,s)=>{s.d(t,{A:()=>M});var i=s(9950),a=s(50559),n=s(87427),r=s(92759),o=s(54175),c=s(1158),l=s(48538),d=s(56231),h=s(55902),m=s(80737),p=s(52735),g=s(2557),u=s(84703),y=s(87827),f=s(31023),x=s(26142),A=s(39742),k=s(94500),j=s(2835),w=s(56149),b=s(42025),I=s(47738),C=s(46995),v=s(20735),F=s(87621),D=s(9313),T=s(51598),R=s(37866),S=s(44070),N=s(27379),z=s(21215),L=s.n(z),E=s(93766),V=s(39608),K=s(27646),P=s(83813),q=s(44414);const B=(0,i.lazy)((()=>s.e(1092).then(s.bind(s,81092)))),{Text:U}=a.A,O=n.A.confirm;class H extends i.Component{constructor(){super(...arguments),this.mkdirFormRef=i.createRef(),this.renameFormRef=i.createRef(),this.state={storageType:void 0,storageId:void 0,currentDirectory:"/",currentDirectoryInput:"/",files:[],loading:!1,currentFileKey:void 0,selectedRowKeys:[],uploading:{},callback:void 0,minHeight:280,upload:!1,download:!1,delete:!1,rename:!1,edit:!1,editorVisible:!1,fileName:"",fileContent:""},this.reSetStorageId=e=>{this.setState({storageId:e},(()=>{this.loadFiles("/")}))},this.refresh=async()=>{this.loadFiles(this.state.currentDirectory),this.state.callback&&this.state.callback()},this.loadFiles=async e=>{this.setState({loading:!0});try{(0,K.Im)(e)&&(e="/");let t=new FormData;t.append("dir",e);let s=await E.A.post("/".concat(this.state.storageType,"/").concat(this.state.storageId,"/ls"),t);if(1!==s.code)return void r.Ay.error(s.message);const i=s.data.map((e=>({key:e.path,...e}))),a=(e,t)=>{let s=e.name.toUpperCase(),i=t.name.toUpperCase();return s<i?-1:s>i?1:0};let n=i.filter((e=>!0===e.isDir));n.sort(a);let o=i.filter((e=>!1===e.isDir));o.sort(a),n.push(...o),"/"!==e&&n.splice(0,0,{key:"..",name:"..",path:"..",isDir:!0,disabled:!0}),this.setState({files:n,currentDirectory:e,currentDirectoryInput:e})}finally{this.setState({loading:!1,selectedRowKeys:[]})}},this.handleCurrentDirectoryInputChange=e=>{this.setState({currentDirectoryInput:e.target.value})},this.handleCurrentDirectoryInputPressEnter=e=>{this.loadFiles(e.target.value)},this.handleUploadDir=()=>{let e=window.document.getElementById("dir-upload").files,t=0;for(let s=0;s<e.length;s++){let i=e[s].webkitRelativePath,a=i.substring(0,i.length-e[s].name.length);this.uploadFile(e[s],this.state.currentDirectory+"/"+a,(()=>{t++,t===e.length&&this.refresh()}))}},this.handleUploadFile=()=>{let e=window.document.getElementById("file-upload").files,t=0;for(let s=0;s<e.length;s++){const i=e[s];if(!i)return;this.uploadFile(i,this.state.currentDirectory,(()=>{t++,t===e.length&&this.refresh()}))}},this.uploadFile=(e,t,s)=>{const{name:a,size:n}=e;let l="".concat(V.E8,"/").concat(this.state.storageType,"/").concat(this.state.storageId,"/upload?X-Auth-Token=").concat((0,K.gf)(),"&dir=").concat(t);const d=a,h=new XMLHttpRequest;let m=0,p=0;const g=(e,t)=>{if(e){let e=(0,q.jsxs)(i.Fragment,{children:[(0,q.jsx)("div",{children:a}),(0,q.jsxs)("div",{children:[(0,K.qI)(n)," / ",(0,K.qI)(n)]}),(0,q.jsx)(o.A,{percent:100})]});c.A.success({key:d,message:"\u4e0a\u4f20\u6210\u529f",duration:5,description:e,placement:"bottomRight"}),s&&s()}else{let e=(0,q.jsxs)(i.Fragment,{children:[(0,q.jsx)("div",{children:a}),(0,q.jsx)(U,{type:"danger",children:t})]});c.A.error({key:d,message:"\u4e0a\u4f20\u5931\u8d25",duration:10,description:e,placement:"bottomRight"})}};h.upload.addEventListener("progress",(e=>{if(e.lengthComputable){let t=(0,q.jsxs)(i.Fragment,{children:[(0,q.jsx)("div",{children:a}),(0,q.jsxs)("div",{children:[(0,K.qI)(e.loaded),"/",(0,K.qI)(n)]}),(0,q.jsx)(o.A,{percent:99})]});if(e.loaded===e.total)return void c.A.info({key:d,message:"\u5411\u76ee\u6807\u673a\u5668\u4f20\u8f93\u4e2d...",duration:null,description:t,placement:"bottomRight",onClose:()=>{h.abort(),r.Ay.info('\u60a8\u5df2\u53d6\u6d88\u4e0a\u4f20"'.concat(a,'"'),10)}});if(p=Math.min(Math.floor(100*e.loaded/e.total),99),m===p)return;t=(0,q.jsxs)(i.Fragment,{children:[(0,q.jsx)("div",{children:a}),(0,q.jsxs)("div",{children:[(0,K.qI)(e.loaded)," / ",(0,K.qI)(n)]}),(0,q.jsx)(o.A,{percent:p})]}),c.A.info({key:d,message:"\u4e0a\u4f20\u4e2d...",duration:null,description:t,placement:"bottomRight",onClose:()=>{h.abort(),r.Ay.info('\u60a8\u5df2\u53d6\u6d88\u4e0a\u4f20"'.concat(a,'"'),10)}}),m=p}}),!1),h.onreadystatechange=e=>{if(4===h.readyState)h.status>=200&&h.status<300?g(!0,"\u4e0a\u4f20\u6210\u529f"):h.status>=400&&h.status<500&&g(!1,"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef");else{let t=e.currentTarget.responseText.split("\u32a5").filter((e=>""!==e));if(t.length>0){let e=t[t.length-1],s=parseInt(e);p=Math.min(Math.floor(100*s/n),99);let l=(0,q.jsxs)(i.Fragment,{children:[(0,q.jsx)("div",{children:a}),(0,q.jsxs)("div",{children:[(0,K.qI)(s),"/",(0,K.qI)(n)]}),(0,q.jsx)(o.A,{percent:p})]});c.A.info({key:d,message:"\u5411\u76ee\u6807\u673a\u5668\u4f20\u8f93\u4e2d...",duration:null,description:l,placement:"bottomRight",onClose:()=>{h.abort(),r.Ay.info('\u60a8\u5df2\u53d6\u6d88\u4e0a\u4f20"'.concat(a,'"'),10)}})}}},h.onerror=()=>{g(!1,"\u670d\u52a1\u5668\u5185\u90e8\u9519\u8bef")},h.open("POST",l,!0);let u=new FormData;u.append("file",e,a),h.send(u)},this.delete=async e=>{let t=new FormData;t.append("file",e);let s=await E.A.post("/".concat(this.state.storageType,"/").concat(this.state.storageId,"/rm"),t);1!==s.code&&r.Ay.error(s.message)},this.showEditor=async(e,t)=>{r.Ay.loading({key:t,content:"Loading"});let s=await E.A.get("".concat(V.E8,"/").concat(this.state.storageType,"/").concat(this.state.storageId,"/download?file=").concat(window.encodeURIComponent(t),"&t=").concat((new Date).getTime()));this.setState({currentFileKey:t,fileName:e,fileContent:s,editorVisible:!0}),r.Ay.destroy(t)},this.hideEditor=()=>{this.setState({editorVisible:!1,fileName:"",fileContent:"",currentFileKey:""})},this.edit=async()=>{this.setState({confirmLoading:!0});let e="".concat(V.E8,"/").concat(this.state.storageType,"/").concat(this.state.storageId,"/edit"),t=new FormData;t.append("file",this.state.currentFileKey),t.append("fileContent",this.state.fileContent);let s=await E.A.post(e,t);1!==s.code&&r.Ay.error(s.message),this.setState({confirmLoading:!1}),this.hideEditor()}}componentDidMount(){this.props.onRef&&this.props.onRef(this),this.props.storageId&&this.setState({storageId:this.props.storageId,storageType:this.props.storageType,callback:this.props.callback,minHeight:this.props.minHeight,upload:this.props.upload,download:this.props.download,delete:this.props.delete,rename:this.props.rename,edit:this.props.edit},(()=>{this.loadFiles(this.state.currentDirectory)}))}render(){const e=[{title:"\u540d\u79f0",dataIndex:"name",key:"name",render:(e,t)=>{let s;if(t.isDir)s=(0,q.jsx)(f.A,{});else if(t.isLink)s=(0,q.jsx)(x.A,{});else{switch(t.name.split(".").pop().toLowerCase()){case"doc":case"docx":s=(0,q.jsx)(A.A,{});break;case"xls":case"xlsx":s=(0,q.jsx)(k.A,{});break;case"bmp":case"jpg":case"jpeg":case"png":case"tif":case"gif":case"pcx":case"tga":case"exif":case"svg":case"psd":case"ai":case"webp":s=(0,q.jsx)(j.A,{});break;case"md":s=(0,q.jsx)(w.A,{});break;case"pdf":s=(0,q.jsx)(b.A,{});break;case"txt":s=(0,q.jsx)(I.A,{});break;case"zip":case"gz":case"tar":case"tgz":s=(0,q.jsx)(C.A,{});break;default:s=(0,q.jsx)(v.A,{})}}return(0,q.jsxs)("span",{className:"dode",children:[s,"\xa0\xa0",t.name]})},sorter:(e,t)=>".."===e.key||".."===t.key?0:e.name.localeCompare(t.name),sortDirections:["descend","ascend"]},{title:"\u5927\u5c0f",dataIndex:"size",key:"size",render:(e,t)=>t.isDir||t.isLink?(0,q.jsx)("span",{className:"dode"}):(0,q.jsx)("span",{className:"dode",children:(0,K.qI)(e)}),sorter:(e,t)=>".."===e.key||".."===t.key?0:e.size-t.size},{title:"\u4fee\u6539\u65e5\u671f",dataIndex:"modTime",key:"modTime",sorter:(e,t)=>".."===e.key||".."===t.key?0:e.modTime.localeCompare(t.modTime),sortDirections:["descend","ascend"],render:(e,t)=>(0,q.jsx)("span",{className:"dode",children:e})},{title:"\u5c5e\u6027",dataIndex:"mode",key:"mode",render:(e,t)=>(0,q.jsx)("span",{className:"dode",children:e})},{title:"\u64cd\u4f5c",dataIndex:"action",key:"action",width:210,render:(e,t)=>{if(".."===t.key)return;let s=!this.state.download,i=!this.state.edit;return(t.isDir||t.isLink)&&(s=!0,i=!0),(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(l.A,{type:"link",size:"small",disabled:i,onClick:()=>this.showEditor(t.name,t.key),children:"\u7f16\u8f91"}),(0,q.jsx)(l.A,{type:"link",size:"small",disabled:s,onClick:async()=>{(0,K.RG)("".concat(V.E8,"/").concat(this.state.storageType,"/").concat(this.state.storageId,"/download?file=").concat(window.encodeURIComponent(t.key),"&X-Auth-Token=").concat((0,K.gf)(),"&t=").concat((new Date).getTime()))},children:"\u4e0b\u8f7d"}),(0,q.jsx)(l.A,{type:"link",size:"small",disabled:!this.state.rename,onClick:()=>{this.setState({renameVisible:!0,currentFileKey:t.key})},children:"\u91cd\u547d\u540d"}),(0,q.jsx)(d.A,{title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64\u6587\u4ef6\u5417?",onConfirm:async()=>{await this.delete(t.key),await this.refresh()},okText:"\u662f",cancelText:"\u5426",children:(0,q.jsx)(l.A,{type:"link",size:"small",disabled:!this.state.delete,danger:!0,children:"\u5220\u9664"})})]})}}],{selectedRowKeys:t}=this.state,s={selectedRowKeys:t,onChange:e=>{this.setState({selectedRowKeys:e})},getCheckboxProps:e=>({disabled:e.disabled})};let a=t.length>0;a&&(this.state.delete||(a=!1));const o=(0,q.jsxs)("div",{className:"fs-header",children:[(0,q.jsx)("div",{className:"fs-header-left",children:(0,q.jsx)(h.A,{value:this.state.currentDirectoryInput,onChange:this.handleCurrentDirectoryInputChange,onPressEnter:this.handleCurrentDirectoryInputPressEnter})}),(0,q.jsx)("div",{className:"fs-header-right",children:(0,q.jsxs)(m.A,{children:[(0,q.jsx)("div",{className:"fs-header-right-item",children:(0,q.jsx)(p.A,{title:"\u521b\u5efa\u6587\u4ef6\u5939",children:(0,q.jsx)(l.A,{type:"primary",size:"small",disabled:!this.state.upload,icon:(0,q.jsx)(F.A,{}),onClick:()=>{this.setState({mkdirVisible:!0})},ghost:!0})})}),(0,q.jsx)("div",{className:"fs-header-right-item",children:(0,q.jsxs)(p.A,{title:"\u4e0a\u4f20\u6587\u4ef6",children:[(0,q.jsx)(l.A,{type:"primary",size:"small",icon:(0,q.jsx)(D.A,{}),disabled:!this.state.upload,onClick:()=>{window.document.getElementById("file-upload").click()},ghost:!0}),(0,q.jsx)("input",{type:"file",id:"file-upload",style:{display:"none"},onChange:this.handleUploadFile,multiple:!0})]})}),(0,q.jsx)("div",{className:"fs-header-right-item",children:(0,q.jsxs)(p.A,{title:"\u4e0a\u4f20\u6587\u4ef6\u5939",children:[(0,q.jsx)(l.A,{type:"primary",size:"small",icon:(0,q.jsx)(T.A,{}),disabled:!this.state.upload,onClick:()=>{window.document.getElementById("dir-upload").click()},ghost:!0}),(0,q.jsx)("input",{type:"file",id:"dir-upload",style:{display:"none"},onChange:this.handleUploadDir,webkitdirectory:"",multiple:!0})]})}),(0,q.jsx)("div",{className:"fs-header-right-item",children:(0,q.jsx)(p.A,{title:"\u5237\u65b0",children:(0,q.jsx)(l.A,{type:"primary",size:"small",icon:(0,q.jsx)(R.A,{}),onClick:this.refresh,ghost:!0})})}),(0,q.jsx)("div",{className:"fs-header-right-item",children:(0,q.jsx)(p.A,{title:"\u6279\u91cf\u5220\u9664",children:(0,q.jsx)(l.A,{type:"primary",size:"small",ghost:!0,danger:!0,disabled:!a,icon:(0,q.jsx)(S.A,{}),loading:this.state.delBtnLoading,onClick:()=>{let e=this.state.selectedRowKeys;const t=(0,q.jsxs)("div",{children:["\u60a8\u786e\u5b9a\u8981\u5220\u9664\u9009\u4e2d\u7684",(0,q.jsx)(U,{style:{color:"#1890FF"},strong:!0,children:e.length}),"\u6761\u8bb0\u5f55\u5417\uff1f"]});O({icon:(0,q.jsx)(N.A,{}),content:t,onOk:async()=>{for(let t=0;t<e.length;t++)".."!==e[t]&&await this.delete(e[t]);this.refresh()},onCancel(){}})}})})})]})})]});return(0,q.jsxs)("div",{children:[(0,q.jsx)(g.A,{title:o,bordered:!0,size:"small",style:{minHeight:this.state.minHeight},children:(0,q.jsx)(u.A,{columns:e,rowSelection:s,dataSource:this.state.files,size:"small",pagination:!1,loading:this.state.loading,onRow:e=>({onDoubleClick:t=>{if(e.isDir||e.isLink)if(".."===e.path){let e=this.state.currentDirectory,t=e.substring(0,e.lastIndexOf("/"));this.loadFiles(t)}else this.loadFiles(e.path)}})})}),this.state.mkdirVisible?(0,q.jsx)(n.A,{title:"\u521b\u5efa\u6587\u4ef6\u5939",visible:this.state.mkdirVisible,okButtonProps:{form:"mkdir-form",key:"submit",htmlType:"submit"},onOk:()=>{this.mkdirFormRef.current.validateFields().then((async e=>{this.mkdirFormRef.current.resetFields();let t={dir:this.state.currentDirectory+"/"+e.dir},s=L().stringify(t);this.setState({confirmLoading:!0});let i=await E.A.post("/".concat(this.state.storageType,"/").concat(this.state.storageId,"/mkdir?").concat(s));1===i.code?(r.Ay.success("\u521b\u5efa\u6210\u529f"),this.loadFiles(this.state.currentDirectory)):r.Ay.error(i.message),this.setState({confirmLoading:!1,mkdirVisible:!1})})).catch((e=>{}))},confirmLoading:this.state.confirmLoading,onCancel:()=>{this.setState({mkdirVisible:!1})},children:(0,q.jsx)(y.A,{ref:this.mkdirFormRef,id:"mkdir-form",children:(0,q.jsx)(y.A.Item,{name:"dir",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6587\u4ef6\u5939\u540d\u79f0"}],children:(0,q.jsx)(h.A,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u6587\u4ef6\u5939\u540d\u79f0"})})})}):void 0,this.state.renameVisible?(0,q.jsx)(n.A,{title:"\u91cd\u547d\u540d",visible:this.state.renameVisible,okButtonProps:{form:"rename-form",key:"submit",htmlType:"submit"},onOk:()=>{this.renameFormRef.current.validateFields().then((async e=>{this.renameFormRef.current.resetFields();try{let t=this.state.currentDirectory;t.endsWith("/")||(t+="/");let s={oldName:this.state.currentFileKey,newName:t+e.newName};if(s.oldName===s.newName)return void r.Ay.success("\u91cd\u547d\u540d\u6210\u529f");let i=L().stringify(s);this.setState({confirmLoading:!0});let a=await E.A.post("/".concat(this.state.storageType,"/").concat(this.state.storageId,"/rename?").concat(i));1===a.code?(r.Ay.success("\u91cd\u547d\u540d\u6210\u529f"),this.refresh()):r.Ay.error(a.message)}finally{this.setState({confirmLoading:!1,renameVisible:!1})}})).catch((e=>{}))},confirmLoading:this.state.confirmLoading,onCancel:()=>{this.setState({renameVisible:!1})},children:(0,q.jsx)(y.A,{id:"rename-form",ref:this.renameFormRef,initialValues:{newName:(0,K.WP)(this.state.currentFileKey)},children:(0,q.jsx)(y.A.Item,{name:"newName",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u65b0\u7684\u540d\u79f0"}],children:(0,q.jsx)(h.A,{autoComplete:"off",placeholder:"\u65b0\u7684\u540d\u79f0"})})})}):void 0,(0,q.jsx)(n.A,{title:"\u7f16\u8f91 "+this.state.fileName,className:"modal-no-padding",visible:this.state.editorVisible,destroyOnClose:!0,width:.8*window.innerWidth,centered:!0,okButtonProps:{form:"rename-form",key:"submit",htmlType:"submit"},onOk:this.edit,confirmLoading:this.state.confirmLoading,onCancel:this.hideEditor,children:(0,q.jsx)(i.Suspense,{fallback:(0,q.jsx)(P.A,{}),children:(0,q.jsx)(B,{language:"javascript",height:.8*window.innerHeight,theme:"vs-dark",value:this.state.fileContent,options:{selectOnLineNumbers:!0},editorDidMount:(e,t)=>{e.focus()},editorWillUnmount:()=>{},onChange:(e,t)=>{this.setState({fileContent:e})}})})})]})}}const M=H},18202:(e,t,s)=>{s.d(t,{s:()=>i});const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,s=null;return function(){s&&clearTimeout(s),s=setTimeout((()=>{e.apply(this,arguments),s=null}),t)}}},98409:(e,t,s)=>{s.d(t,{A:()=>i});const i=new class{constructor(){this.hasText=function(e){return!(void 0===e||null===e||0===e.length)},this.zeroPad=function(e,t){let s=e.toString();for(;s.length<t;)s="0"+s;return s}}}}}]);