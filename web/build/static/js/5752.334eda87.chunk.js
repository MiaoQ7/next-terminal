"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[5752],{53343:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(16018),l=n(93766);class o extends s.A{constructor(){super("commands"),this.changeOwner=async(e,t)=>1===(await l.A.post("/".concat(this.group,"/").concat(e,"/change-owner?owner=").concat(t))).code}}const c=new o},50544:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(16018);class l extends s.A{constructor(){super("worker/commands")}}const o=new l},52082:(e,t,n)=>{var s;n.d(t,{A:()=>l});const l=(s=class e{constructor(e,t){this.type=e,this.content=t}toString(){return this.type+this.content}static parse(t){let n=parseInt(t.substring(0,1)),s=t.substring(1,t.length);return new e(n,s)}},s.Closed=0,s.Connected=1,s.Data=2,s.Resize=3,s.Ping=4,s)},58059:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var s=n(9950),l=n(42074),o=n(9437),c=n(88257),a=n(27646),r=n(93766),i=n(50559),d=n(92759),m=n(51955),u=n(48538),h=n(57811),A=n(69216),p=n(99019),x=n(80737),b=n(99674),w=n(52082),v=n(21215),f=n.n(v),y=n(39608),j=n(31628),g=n.n(j),I=n(78777),S=n(14017),C=n(89379);const E={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6a8.03 8.03 0 00-11.3 0l-230 229.9L461.4 404a8.03 8.03 0 00-11.3 0L266.3 586.7a8.03 8.03 0 000 11.3l39.5 39.7z"}}]},name:"line-chart",theme:"outlined"};var k=n(38913),N=function(e,t){return s.createElement(k.A,(0,C.A)((0,C.A)({},e),{},{ref:t,icon:E}))};N.displayName="LineChartOutlined";const F=s.forwardRef(N);var q=n(60715),z=(n(89879),n(91524)),L=n(87094),T=n(41988),P=n(54175),O=n(41920),W=n(40670),D=n(44414);const B={uptime:0,load1:0,load5:0,load10:0,memTotal:0,memFree:0,memAvailable:0,memBuffers:0,memCached:0,swapTotal:0,swapFree:0,network:{},fileSystems:[],cpu:{user:0,system:0,nice:0,idle:0,ioWait:0,irq:0,softIrq:0,guest:0}},H=e=>{let{sessionId:t,visible:n,queryInterval:l=5e3}=e,[o,c]=(0,s.useState)(B),[r,i]=(0,s.useState)({});(0,O.useQuery)("stats",(()=>W.A.stats(t)),{refetchInterval:l,enabled:n,onSuccess:e=>{i(o),c(e)}});const d=parseInt((o.uptime/1e3/60/60/24).toString()),m=(100*(o.memTotal-o.memAvailable)/o.memTotal).toFixed(2);let u=o.network,h=o.fileSystems,A=0;return 0!==o.swapTotal&&(A=(100*(o.swapTotal-o.swapFree)/o.swapTotal).toFixed(2)),(0,D.jsxs)("div",{children:[(0,D.jsxs)(z.A,{title:"\u7cfb\u7edf\u4fe1\u606f",column:4,children:[(0,D.jsx)(z.A.Item,{label:"\u4e3b\u673a\u540d\u79f0",children:o.hostname}),(0,D.jsxs)(z.A.Item,{label:"\u8fd0\u884c\u65f6\u957f",children:[d,"\u5929"]})]}),(0,D.jsx)(L.A,{justify:"center",align:"middle",children:(0,D.jsx)(T.A,{children:(0,D.jsxs)(z.A,{title:"\u8d1f\u8f7d",column:4,children:[(0,D.jsx)(z.A.Item,{label:"Load1",children:(0,D.jsx)("div",{className:"description-content",children:(0,D.jsx)(P.A,{percent:o.load1,steps:20,size:"small"})})}),(0,D.jsx)(z.A.Item,{label:"Load5",children:(0,D.jsx)("div",{className:"description-content",children:(0,D.jsx)(P.A,{percent:o.load5,steps:20,size:"small"})})}),(0,D.jsx)(z.A.Item,{label:"Load10",children:(0,D.jsx)("div",{className:"description-content",children:(0,D.jsx)(P.A,{percent:o.load10,steps:20,size:"small"})})})]})})}),(0,D.jsxs)(z.A,{title:"CPU",column:4,children:[(0,D.jsxs)(z.A.Item,{label:"\u7528\u6237",children:[o.cpu.user.toFixed(2),"%"]}),(0,D.jsxs)(z.A.Item,{label:"\u7cfb\u7edf",children:[o.cpu.system.toFixed(2),"%"]}),(0,D.jsxs)(z.A.Item,{label:"\u7a7a\u95f2",children:[o.cpu.idle.toFixed(2),"%"]}),(0,D.jsxs)(z.A.Item,{label:"IO\u7b49\u5f85",children:[o.cpu.ioWait.toFixed(2),"%"]}),(0,D.jsxs)(z.A.Item,{label:"\u786c\u4e2d\u65ad",children:[o.cpu.irq.toFixed(2),"%"]}),(0,D.jsxs)(z.A.Item,{label:"\u8f6f\u4e2d\u65ad",children:[o.cpu.softIrq.toFixed(2),"%"]}),(0,D.jsxs)(z.A.Item,{label:"nice",children:[o.cpu.nice.toFixed(2),"%"]}),(0,D.jsxs)(z.A.Item,{label:"guest",children:[o.cpu.guest.toFixed(2),"%"]})]}),(0,D.jsxs)(z.A,{title:"\u5185\u5b58",column:4,children:[(0,D.jsx)(z.A.Item,{label:"\u7269\u7406\u5185\u5b58\u5927\u5c0f",children:(0,a.qI)(o.memTotal)}),(0,D.jsx)(z.A.Item,{label:"\u5269\u4f59\u5185\u5b58\u5927\u5c0f",children:(0,a.qI)(o.memFree)}),(0,D.jsx)(z.A.Item,{label:"\u53ef\u7528\u5185\u5b58\u5927\u5c0f",children:(0,a.qI)(o.memAvailable)}),(0,D.jsx)(z.A.Item,{label:"\u4f7f\u7528\u5360\u6bd4",children:(0,D.jsx)("div",{className:"description-content",children:(0,D.jsx)(P.A,{percent:m,steps:20,size:"small"})})}),(0,D.jsxs)(z.A.Item,{label:"Buffers/Cached",children:[(0,a.qI)(o.memBuffers)," / ",(0,a.qI)(o.memCached)]}),(0,D.jsx)(z.A.Item,{label:"\u4ea4\u6362\u5185\u5b58\u5927\u5c0f",children:(0,a.qI)(o.swapTotal)}),(0,D.jsx)(z.A.Item,{label:"\u4ea4\u6362\u5185\u5b58\u5269\u4f59",children:(0,a.qI)(o.swapFree)}),(0,D.jsx)(z.A.Item,{label:"\u4f7f\u7528\u5360\u6bd4",children:(0,D.jsx)("div",{className:"description-content",children:(0,D.jsx)(P.A,{percent:A,steps:20,size:"small"})})})]}),(0,D.jsx)(z.A,{title:"\u78c1\u76d8",column:4,children:h.map(((e,t)=>(0,D.jsxs)(s.Fragment,{children:[(0,D.jsx)(z.A.Item,{label:"\u6302\u8f7d\u8def\u5f84",children:e.mountPoint},"\u6302\u8f7d\u8def\u5f84"+t),(0,D.jsx)(z.A.Item,{label:"\u5df2\u7ecf\u4f7f\u7528",children:(0,a.qI)(e.used)},"\u5df2\u7ecf\u4f7f\u7528"+t),(0,D.jsx)(z.A.Item,{label:"\u5269\u4f59\u7a7a\u95f4",children:(0,a.qI)(e.free)},"\u5269\u4f59\u7a7a\u95f4"+t),(0,D.jsx)(z.A.Item,{label:"\u4f7f\u7528\u5360\u6bd4",children:(0,D.jsx)("div",{className:"description-content",children:(0,D.jsx)(P.A,{percent:(100*e.used/(e.used+e.free)).toFixed(2),steps:20,size:"small"})})},"\u4f7f\u7528\u5360\u6bd4"+t)]},"\u78c1\u76d8"+t)))}),(0,D.jsx)(z.A,{title:"\u7f51\u7edc",column:4,children:Object.keys(u).map(((e,t)=>{let n=r.network,l=0,o=0;return void 0!==n[e]&&(l=(u[e].rx-n[e].rx)/5),void 0!==n[e]&&(o=(u[e].tx-n[e].tx)/5),(0,D.jsxs)(s.Fragment,{children:[(0,D.jsx)(z.A.Item,{label:"\u7f51\u5361",children:e},"\u7f51\u5361"+t),(0,D.jsx)(z.A.Item,{label:"IPv4",children:u[e].ipv4},"IPv4"+t),(0,D.jsxs)(z.A.Item,{label:"\u63a5\u6536",children:[(0,a.qI)(u[e].rx)," \xa0 ",(0,a.qI)(l),"/\u79d2"]},"\u63a5\u6536"+t),(0,D.jsxs)(z.A.Item,{label:"\u53d1\u9001",children:[(0,a.qI)(u[e].tx)," \xa0 ",(0,a.qI)(o),"/\u79d2"]},"\u53d1\u9001"+t)]},"\u7f51\u7edc"+t)}))})]})};var V=n(18202),M=n(53343),R=n(98409),Q=n(50544),_=n(66212);const{Text:J}=i.A,U=()=>{const[e]=(0,l.ok)(),t=e.get("assetId"),n=e.get("assetName"),i=e.get("isWorker"),[v,j]=(0,s.useState)({width:window.innerWidth,height:window.innerHeight});let[C,E]=(0,s.useState)([]),[k,N]=(0,s.useState)(),[z,L]=(0,s.useState)(),[T,P]=(0,s.useState)(),[O,W]=(0,s.useState)({}),[B,U]=(0,s.useState)(!1),[X,G]=(0,s.useState)(!1),[K,Y]=(0,s.useState)(999),[Z,$]=(0,s.useState)(5e3);const ee=(e,t)=>{e.writeln("\x1b[1;3;31m".concat(t,"\x1b[0m "))},te=e=>{T&&T.send(new w.A(w.A.Data,e))},ne=()=>{k&&k.focus()},se=async e=>{let t=new o.Terminal({fontFamily:'monaco, Consolas, "Lucida Console", monospace',fontSize:15,theme:{background:"#1b1b1b"}}),n=document.getElementById("terminal");t.open(n);const s=new c.FitAddon;if(t.loadAddon(s),s.fit(),t.focus(),!e)return void ee(t,"\u53c2\u6570\u7f3a\u5931\uff0c\u8bf7\u5173\u95ed\u6b64\u9875\u9762\u540e\u91cd\u65b0\u6253\u5f00\u3002");let[l,m]=await(async e=>{let t=await r.A.post("/sessions?assetId=".concat(e,"&mode=native"));return 1!==t.code?[void 0,t.message]:[t.data,""]})(e);if(!l)return void ee(t,"\u521b\u5efa\u4f1a\u8bdd\u5931\u8d25\uff0c".concat(m));let u=l.id;t.writeln("trying to connect to the server ..."),document.body.oncopy=e=>(e.preventDefault(),"0"!==l.copy||(d.Ay.warn("\u7981\u6b62\u590d\u5236"),!1)),document.body.onpaste=e=>(e.preventDefault(),"0"!==l.paste||(d.Ay.warn("\u7981\u6b62\u7c98\u8d34"),!1));let h,A=(0,a.gf)(),p={cols:t.cols,rows:t.rows,"X-Auth-Token":A},x=f().stringify(p),b=new WebSocket("".concat(y.IV,"/sessions/").concat(u,"/ssh?").concat(x));b.onopen=e=>{h=setInterval((()=>{b.send(new w.A(w.A.Ping,"").toString())}),1e4),(0,_.I)()},b.onerror=e=>{ee(t,"websocket error ".concat(e.data))},b.onclose=e=>{console.log("e",e),t.writeln("connection is closed."),h&&clearInterval(h)},t.onData((e=>{void 0!==b&&b.send(new w.A(w.A.Data,e).toString())})),b.onmessage=e=>{let n=w.A.parse(e.data);switch(n.type){case w.A.Connected:t.clear(),(async e=>{let t=await r.A.post("/sessions/".concat(e,"/connect"));1!==t.code&&d.Ay.error(t.message)})(u),(async()=>{if(R.A.hasText(i)){let e=await Q.A.getAll();E(e)}else{let e=await M.A.getAll();E(e)}})();break;case w.A.Data:t.write(n.content);break;case w.A.Closed:console.log("\u670d\u52a1\u7aef\u901a\u77e5\u9700\u8981\u5173\u95ed\u8fde\u63a5"),t.writeln("\x1b[1;3;31m".concat(n.content,"\x1b[0m ")),b.close()}},W(l),N(t),L(s),P(b)},le=e=>{const t="\u8981\u79bb\u5f00\u7f51\u7ad9\u5417\uff1f";return(e||window.event).returnValue=t,t};(0,s.useEffect)((()=>{document.title=n,se(t)}),[t]),(0,s.useEffect)((()=>{if(k&&T&&z&&T.readyState===WebSocket.OPEN){z&&z.fit(),ne();let e={cols:k.cols,rows:k.rows};T.send(new w.A(w.A.Resize,window.btoa(JSON.stringify(e))).toString())}window.addEventListener("beforeunload",le);let e=(0,V.s)((()=>{j({width:window.innerWidth,height:window.innerHeight})}));return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("beforeunload",le)}}),[v.width,v.height]);const oe=C.map((e=>({key:e.id,label:e.name})));return(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{id:"terminal",style:{overflow:"hidden",height:v.height,width:v.width,backgroundColor:"#1b1b1b"}}),(0,D.jsx)(g(),{children:(0,D.jsx)(m.A,{style:{position:"absolute",top:50,right:50,zIndex:K},children:(0,D.jsx)(u.A,{icon:(0,D.jsx)(I.A,{}),onClick:()=>{U(!0),Y(999)}})})}),(0,D.jsx)(g(),{children:(0,D.jsx)(m.A,{style:{position:"absolute",top:50,right:100,zIndex:K},children:(0,D.jsx)(h.A,{overlay:(0,D.jsx)(A.A,{onClick:e=>{for(const t of C)t.id===e.key&&te(t.content)},items:oe}),trigger:["click"],placement:"bottomLeft",children:(0,D.jsx)(u.A,{icon:(0,D.jsx)(S.A,{})})})})}),(0,D.jsx)(g(),{children:(0,D.jsx)(m.A,{style:{position:"absolute",top:100,right:100,zIndex:K},children:(0,D.jsx)(u.A,{icon:(0,D.jsx)(F,{}),onClick:()=>{G(!0),Y(999)}})})}),(0,D.jsx)(p.A,{title:"\u4f1a\u8bdd\u8be6\u60c5",placement:"right",width:.8*window.innerWidth,closable:!0,onClose:()=>{U(!1),Y(1001),ne()},visible:B,children:(0,D.jsx)(q.A,{storageId:O.id,storageType:"sessions",upload:"1"===O.upload,download:"1"===O.download,delete:"1"===O.delete,rename:"1"===O.rename,edit:"1"===O.edit,minHeight:window.innerHeight-103})}),(0,D.jsx)(p.A,{title:"\u72b6\u6001\u4fe1\u606f",placement:"right",width:.8*window.innerWidth,closable:!0,onClose:()=>{G(!1),Y(1001),ne()},visible:X,extra:(0,D.jsxs)(x.A,{children:[(0,D.jsx)("div",{style:{width:100},children:(0,D.jsx)(J,{children:"\u67e5\u8be2\u65f6\u95f4\u95f4\u9694"})}),(0,D.jsxs)(b.A,{defaultValue:"5000",style:{width:80},onChange:e=>{$(parseInt(e))},children:[(0,D.jsx)(b.A.Option,{value:"1000",children:"1\u79d2"}),(0,D.jsx)(b.A.Option,{value:"5000",children:"5\u79d2"}),(0,D.jsx)(b.A.Option,{value:"15000",children:"15\u79d2"}),(0,D.jsx)(b.A.Option,{value:"30000",children:"30\u79d2"})]})]}),children:(0,D.jsx)(H,{sessionId:O.id,visible:X,queryInterval:Z})})]})}},66212:(e,t,n)=>{n.d(t,{I:()=>s});const s=()=>{let e=document.getElementsByClassName("xterm-viewport");for(let t=0;t<e.length;t++){let n,s=e[t];s.addEventListener("scroll",(function(e){s.toggleAttribute("scroll",!0),n&&clearTimeout(n),n=setTimeout((()=>{s.toggleAttribute("scroll")}),500)}))}}},41988:(e,t,n)=>{n.d(t,{A:()=>s});const s=n(55352).A},91524:(e,t,n)=>{n.d(t,{h:()=>v,A:()=>g});var s=n(64467),l=n(5544),o=n(82284),c=n(48738),a=n.n(c),r=n(18909),i=n(9950),d=n(5741),m=n(39156),u=n(86557);const h=function(e){return e.children};var A=n(58168);function p(e){return void 0!==e&&null!==e}const x=function(e){var t,n=e.itemPrefixCls,l=e.component,o=e.span,c=e.className,r=e.style,d=e.labelStyle,m=e.contentStyle,u=e.bordered,h=e.label,A=e.content,x=e.colon,b=l;return u?i.createElement(b,{className:a()((t={},(0,s.A)(t,"".concat(n,"-item-label"),p(h)),(0,s.A)(t,"".concat(n,"-item-content"),p(A)),t),c),style:r,colSpan:o},p(h)&&i.createElement("span",{style:d},h),p(A)&&i.createElement("span",{style:m},A)):i.createElement(b,{className:a()("".concat(n,"-item"),c),style:r,colSpan:o},i.createElement("div",{className:"".concat(n,"-item-container")},(h||0===h)&&i.createElement("span",{className:a()("".concat(n,"-item-label"),(0,s.A)({},"".concat(n,"-item-no-colon"),!x)),style:d},h),(A||0===A)&&i.createElement("span",{className:a()("".concat(n,"-item-content")),style:m},A)))};function b(e,t,n){var s=t.colon,l=t.prefixCls,o=t.bordered,c=n.component,a=n.type,r=n.showLabel,d=n.showContent,m=n.labelStyle,u=n.contentStyle;return e.map((function(e,t){var n=e.props,h=n.label,p=n.children,b=n.prefixCls,w=void 0===b?l:b,v=n.className,f=n.style,y=n.labelStyle,j=n.contentStyle,g=n.span,I=void 0===g?1:g,S=e.key;return"string"===typeof c?i.createElement(x,{key:"".concat(a,"-").concat(S||t),className:v,style:f,labelStyle:(0,A.A)((0,A.A)({},m),y),contentStyle:(0,A.A)((0,A.A)({},u),j),span:I,colon:s,component:c,itemPrefixCls:w,bordered:o,label:r?h:null,content:d?p:null}):[i.createElement(x,{key:"label-".concat(S||t),className:v,style:(0,A.A)((0,A.A)((0,A.A)({},m),f),y),span:1,colon:s,component:c[0],itemPrefixCls:w,bordered:o,label:h}),i.createElement(x,{key:"content-".concat(S||t),className:v,style:(0,A.A)((0,A.A)((0,A.A)({},u),f),j),span:2*I-1,component:c[1],itemPrefixCls:w,bordered:o,content:p})]}))}const w=function(e){var t=i.useContext(v),n=e.prefixCls,s=e.vertical,l=e.row,o=e.index,c=e.bordered;return s?i.createElement(i.Fragment,null,i.createElement("tr",{key:"label-".concat(o),className:"".concat(n,"-row")},b(l,e,(0,A.A)({component:"th",type:"label",showLabel:!0},t))),i.createElement("tr",{key:"content-".concat(o),className:"".concat(n,"-row")},b(l,e,(0,A.A)({component:"td",type:"content",showContent:!0},t)))):i.createElement("tr",{key:o,className:"".concat(n,"-row")},b(l,e,(0,A.A)({component:c?["th","td"]:"td",type:"item",showLabel:!0,showContent:!0},t)))};var v=i.createContext({}),f={xxl:3,xl:3,lg:3,md:3,sm:2,xs:1};function y(e,t,n){var s=e;return(void 0===t||t>n)&&(s=(0,m.Ob)(e,{span:n})),s}function j(e){var t,n=e.prefixCls,c=e.title,m=e.extra,h=e.column,A=void 0===h?f:h,p=e.colon,x=void 0===p||p,b=e.bordered,j=e.layout,g=e.children,I=e.className,S=e.style,C=e.size,E=e.labelStyle,k=e.contentStyle,N=i.useContext(d.QO),F=N.getPrefixCls,q=N.direction,z=F("descriptions",n),L=i.useState({}),T=(0,l.A)(L,2),P=T[0],O=T[1],W=function(e,t){if("number"===typeof e)return e;if("object"===(0,o.A)(e))for(var n=0;n<u.ye.length;n++){var s=u.ye[n];if(t[s]&&void 0!==e[s])return e[s]||f[s]}return 3}(A,P);i.useEffect((function(){var e=u.Ay.subscribe((function(e){"object"===(0,o.A)(A)&&O(e)}));return function(){u.Ay.unsubscribe(e)}}),[]);var D=function(e,t){var n=(0,r.A)(e).filter((function(e){return e})),s=[],l=[],o=t;return n.forEach((function(e,c){var a,r=null===(a=e.props)||void 0===a?void 0:a.span,i=r||1;if(c===n.length-1)return l.push(y(e,r,o)),void s.push(l);i<o?(o-=i,l.push(e)):(l.push(y(e,i,o)),s.push(l),o=t,l=[])})),s}(g,W),B=i.useMemo((function(){return{labelStyle:E,contentStyle:k}}),[E,k]);return i.createElement(v.Provider,{value:B},i.createElement("div",{className:a()(z,(t={},(0,s.A)(t,"".concat(z,"-").concat(C),C&&"default"!==C),(0,s.A)(t,"".concat(z,"-bordered"),!!b),(0,s.A)(t,"".concat(z,"-rtl"),"rtl"===q),t),I),style:S},(c||m)&&i.createElement("div",{className:"".concat(z,"-header")},c&&i.createElement("div",{className:"".concat(z,"-title")},c),m&&i.createElement("div",{className:"".concat(z,"-extra")},m)),i.createElement("div",{className:"".concat(z,"-view")},i.createElement("table",null,i.createElement("tbody",null,D.map((function(e,t){return i.createElement(w,{key:t,index:t,colon:x,prefixCls:z,vertical:"vertical"===j,bordered:b,row:e})})))))))}j.Item=h;const g=j},87094:(e,t,n)=>{n.d(t,{A:()=>s});const s=n(78786).A}}]);