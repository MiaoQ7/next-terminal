"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[6565],{16018:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(93766),n=a(21215),r=a.n(n);class i{constructor(e){this.group="",this.getById=async e=>{let t=await s.A.get("/".concat(this.group,"/").concat(e));if(1===t.code)return t.data},this.getPaging=async e=>{let t=r().stringify(e),a=await s.A.get("/".concat(this.group,"/paging?").concat(t));return 1!==a.code?{}:a.data},this.getAll=async()=>{let e=await s.A.get("/".concat(this.group));return 1!==e.code?[]:e.data},this.create=async e=>1===(await s.A.post("/".concat(this.group),e)).code,this.updateById=async(e,t)=>1===(await s.A.put("/".concat(this.group,"/").concat(e),t)).code,this.deleteById=async e=>1===(await s.A.delete("/".concat(this.group,"/").concat(e))).code,this.group=e}}},80398:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(16018),n=a(93766);class r extends s.A{constructor(){var e;super("assets"),e=this,this.GetAll=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=await n.A.get("/".concat(e.group,"?protocol=").concat(t));return 1!==a.code?[]:a.data},this.connTest=async e=>{let t=await n.A.post("/".concat(this.group,"/").concat(e,"/tcping"));return 1!==t.code?[!1,t.message]:[t.data.active,t.data.message]},this.importAsset=async e=>{const t=new FormData;t.append("file",e);let a=await n.A.post("/".concat(this.group,"/import"),t,{"Content-Type":"multipart/form-data"});return 1!==a.code?[!1,a.message]:[!0,a.data]},this.changeOwner=async(e,t)=>1===(await n.A.post("/".concat(this.group,"/").concat(e,"/change-owner?owner=").concat(t))).code}}const i=new r},52142:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(21215),n=a.n(s),r=a(93766);const i=new class{constructor(){this.group="authorised",this.GetAssetPaging=async e=>{let t=n().stringify(e),a=await r.A.get("/".concat(this.group,"/assets/paging?").concat(t));return 1!==a.code?{}:a.data},this.GetUserPaging=async e=>{let t=n().stringify(e),a=await r.A.get("/".concat(this.group,"/users/paging?").concat(t));return 1!==a.code?{}:a.data},this.GetUserGroupPaging=async e=>{let t=n().stringify(e),a=await r.A.get("/".concat(this.group,"/user-groups/paging?").concat(t));return 1!==a.code?{}:a.data},this.AuthorisedAssets=async e=>1===(await r.A.post("/".concat(this.group,"/assets"),e)).code,this.AuthorisedUsers=async e=>1===(await r.A.post("/".concat(this.group,"/users"),e)).code,this.AuthorisedUserGroups=async e=>1===(await r.A.post("/".concat(this.group,"/user-groups"),e)).code,this.GetSelected=async e=>{let t=n().stringify(e),a=await r.A.get("/".concat(this.group,"/selected?").concat(t));return 1!==a.code?[]:a.data},this.DeleteById=async e=>1===(await r.A.delete("/".concat(this.group,"/").concat(e))).code}}},75098:(e,t,a)=>{a.d(t,{A:()=>o});var s=a(93766),n=a(21215),r=a.n(n),i=a(16018);class c extends i.A{constructor(){super("login-policies"),this.Bind=async(e,t)=>1===(await s.A.post("/".concat(this.group,"/").concat(e,"/bind"),t)).code,this.Unbind=async(e,t)=>1===(await s.A.post("/".concat(this.group,"/").concat(e,"/unbind"),t)).code,this.GetUserPagingByForbiddenCommandId=async(e,t)=>{let a=r().stringify(t),n=await s.A.get("/".concat(this.group,"/").concat(e,"/users/paging?").concat(a));return 1!==n.code?{}:n.data},this.GetUserIdByLoginPolicyId=async e=>{let t=await s.A.get("/".concat(this.group,"/").concat(e,"/users/id"));return 1!==t.code?[]:t.data}}}const o=new c},54081:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(16018),n=a(93766);class r extends s.A{constructor(){super("strategies"),this.GetAll=async()=>{let e=await n.A.get("/".concat(this.group));return 1!==e.code?[]:e.data}}}const i=new r},16623:(e,t,a)=>{a.d(t,{A:()=>i});var s=a(16018),n=a(93766);class r extends s.A{constructor(){super("users"),this.resetTotp=async e=>1===(await n.A.post("/".concat(this.group,"/").concat(e,"/reset-totp"))).code,this.changePassword=async(e,t)=>{let a=new FormData;return a.set("password",t),1===(await n.A.post("/".concat(this.group,"/").concat(e,"/change-password"),a)).code},this.changeStatus=async(e,t)=>1!==(await n.A.patch("/".concat(this.group,"/").concat(e,"/status?status=").concat(t))).code}}const i=new r},76702:(e,t,a)=>{a.d(t,{A:()=>w});var s=a(9950),n=a(42074),r=a(52142),i=a(27666),c=a(48538),o=a(87827),l=a(87427),d=a(99674),u=a(54081),h=a(16623),g=a(44414);const p={labelCol:{span:6},wrapperCol:{span:14}},y=e=>{let{id:t,visible:a,handleOk:n,handleCancel:i,confirmLoading:c}=e;const[y]=o.A.useForm();let[A,m]=(0,s.useState)([]),[w,x]=(0,s.useState)([]),[v,b]=(0,s.useState)([]);(0,s.useEffect)((()=>{a?async function(){let e={key:"userId",assetId:t},a=await r.A.GetSelected(e);m(a);let s=await h.A.getAll();x(s);let n=await u.A.getAll();b(n)}():y.resetFields()}),[a]);let I=v.map((e=>({value:e.id,label:e.name}))),f=w.map((e=>({value:e.id,label:e.nickname,disabled:A.includes(e.id)})));return(0,g.jsx)(l.A,{title:"\u7528\u6237\u6388\u6743",visible:a,maskClosable:!1,destroyOnClose:!0,onOk:()=>{y.validateFields().then((async e=>{await n(e)&&y.resetFields()}))},onCancel:()=>{y.resetFields(),i()},confirmLoading:c,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,g.jsxs)(o.A,{form:y,...p,children:[(0,g.jsx)(o.A.Item,{label:"\u7528\u6237",name:"userIds",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7528\u6237"}],children:(0,g.jsx)(d.A,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"\u8bf7\u9009\u62e9\u7528\u6237",showSearch:!0,filterOption:(e,t)=>{var a;return(null!==(a=null===t||void 0===t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},options:f})}),(0,g.jsx)(o.A.Item,{label:"\u6388\u6743\u7b56\u7565",name:"strategyId",extra:"\u53ef\u63a7\u5236\u6388\u6743\u7528\u6237\u4e0a\u4f20\u4e0b\u8f7d\u6587\u4ef6\u7b49\u529f\u80fd",children:(0,g.jsx)(d.A,{allowClear:!0,style:{width:"100%"},placeholder:"\u6b64\u5b57\u6bb5\u4e0d\u662f\u5fc5\u586b\u7684",showSearch:!0,filterOption:(e,t)=>{var a;return(null!==(a=null===t||void 0===t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},options:I})})]})})};var A=a(68201);const m=s.createRef(),w=e=>{let{active:t,id:a}=e,[o,l]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1);(0,s.useEffect)((()=>{t&&m.current.reload()}),[t]);const h=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u7528\u6237\u540d\u79f0",dataIndex:"userName",render:(e,t)=>(0,g.jsx)(n.N_,{to:"/user/".concat(t.userId),children:e})},{title:"\u6388\u6743\u7b56\u7565\u540d\u79f0",dataIndex:"strategyName",hideInSearch:!0,render:(e,t)=>(0,g.jsx)(n.N_,{to:"/strategy/".concat(t.strategyId),children:e})},{title:"\u6388\u6743\u65e5\u671f",key:"created",dataIndex:"created",hideInSearch:!0},{title:"\u64cd\u4f5c",valueType:"option",key:"option",width:50,render:(e,t,a,s)=>[(0,g.jsx)(A.A,{menu:"asset-authorised-user-del",children:(0,g.jsx)("a",{onClick:async()=>{await r.A.DeleteById(t.id),m.current.reload()},children:"\u79fb\u9664"},"unbind")},"unbind-acc")]}];return(0,g.jsxs)("div",{children:[(0,g.jsx)(i.A,{columns:h,actionRef:m,request:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,s="",n="";Object.keys(t).length>0&&(s=Object.keys(t)[0],n=Object.values(t)[0]);let i={pageIndex:e.current,pageSize:e.pageSize,name:e.name,assetId:a,field:s,order:n},c=await r.A.GetUserPaging(i);return{data:c.items,success:!0,total:c.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10},dateFormatter:"string",headerTitle:"\u6388\u6743\u7684\u7528\u6237\u5217\u8868",toolBarRender:()=>[(0,g.jsx)(A.A,{menu:"asset-authorised-user-add",children:(0,g.jsx)(c.A,{type:"primary",onClick:()=>{l(!0)},children:"\u6388\u6743"},"button")},"bind-acc")]}),(0,g.jsx)(y,{id:a,visible:o,confirmLoading:d,handleCancel:()=>{l(!1)},handleOk:async e=>{u(!0),e.assetId=a;try{r.A.AuthorisedUsers(e)&&l(!1),m.current.reload()}finally{u(!1)}}})]})}},83225:(e,t,a)=>{a.d(t,{A:()=>w});var s=a(9950),n=a(48538),r=a(27666),i=a(52142),c=a(87827),o=a(87427),l=a(99674),d=a(80398),u=a(54081),h=a(44414);const g={labelCol:{span:6},wrapperCol:{span:14}},p=e=>{let{type:t,id:a,visible:n,handleOk:r,handleCancel:p,confirmLoading:y}=e;const[A]=c.A.useForm();let[m,w]=(0,s.useState)([]),[x,v]=(0,s.useState)([]),[b,I]=(0,s.useState)([]);(0,s.useEffect)((()=>{n?async function(){let e={key:"assetId"};"userId"===t?e.userId=a:e.userGroupId=a;let s=await i.A.GetSelected(e);w(s);let n=await d.A.GetAll();v(n);let r=await u.A.GetAll();I(r)}():A.resetFields()}),[n]);let f=b.map((e=>({value:e.id,label:e.name}))),j=x.map((e=>({value:e.id,label:e.name,disabled:m.includes(e.id)})));return(0,h.jsx)(o.A,{title:"\u8d44\u4ea7\u6388\u6743",visible:n,maskClosable:!1,destroyOnClose:!0,onOk:()=>{A.validateFields().then((async e=>{await r(e)&&A.resetFields()}))},onCancel:()=>{A.resetFields(),p()},confirmLoading:y,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,h.jsxs)(c.A,{form:A,...g,children:[(0,h.jsx)(c.A.Item,{label:"\u8d44\u4ea7",name:"assetIds",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u8d44\u4ea7"}],children:(0,h.jsx)(l.A,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"\u8bf7\u9009\u62e9\u8d44\u4ea7",showSearch:!0,filterOption:(e,t)=>{var a;return(null!==(a=null===t||void 0===t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},options:j})}),(0,h.jsx)(c.A.Item,{label:"\u6388\u6743\u7b56\u7565",name:"strategyId",extra:"\u53ef\u63a7\u5236\u6388\u6743\u7528\u6237\u4e0a\u4f20\u4e0b\u8f7d\u6587\u4ef6\u7b49\u529f\u80fd",children:(0,h.jsx)(l.A,{allowClear:!0,style:{width:"100%"},placeholder:"\u6b64\u5b57\u6bb5\u4e0d\u662f\u5fc5\u586b\u7684",showSearch:!0,filterOption:(e,t)=>{var a;return(null!==(a=null===t||void 0===t?void 0:t.label)&&void 0!==a?a:"").toLowerCase().includes(e.toLowerCase())},options:f})})]})})};var y=a(42074),A=a(68201);const m=s.createRef(),w=e=>{let{active:t,id:a,type:c}=e,[o,l]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1);(0,s.useEffect)((()=>{t&&m.current.reload()}),[t]);const g=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u8d44\u4ea7\u540d\u79f0",dataIndex:"assetName",render:(e,t)=>(0,h.jsx)(y.N_,{to:"/asset/".concat(t.assetId),children:e})},{title:"\u6388\u6743\u7b56\u7565\u540d\u79f0",dataIndex:"strategyName",hideInSearch:!0,render:(e,t)=>(0,h.jsx)(y.N_,{to:"/strategy/".concat(t.strategyId),children:e})},{title:"\u6388\u6743\u65e5\u671f",key:"created",dataIndex:"created",hideInSearch:!0},{title:"\u64cd\u4f5c",valueType:"option",key:"option",width:50,render:(e,t,a,s)=>[(0,h.jsx)(A.A,{menu:["user-unbind-asset","user-group-unbind-asset"],children:(0,h.jsx)("a",{onClick:async()=>{await i.A.DeleteById(t.id),m.current.reload()},children:"\u79fb\u9664"},"unbind")})]}];return(0,h.jsxs)("div",{children:[(0,h.jsx)(r.A,{columns:g,actionRef:m,request:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,s="",n="";Object.keys(t).length>0&&(s=Object.keys(t)[0],n=Object.values(t)[0]);let r={pageIndex:e.current,pageSize:e.pageSize,name:e.name,field:s,order:n};r[c]=a;let o=await i.A.GetAssetPaging(r);return{data:o.items,success:!0,total:o.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10},dateFormatter:"string",headerTitle:"\u6388\u6743\u7684\u8d44\u4ea7\u5217\u8868",toolBarRender:()=>[(0,h.jsx)(A.A,{menu:["user-bind-asset","user-group-bind-asset"],children:(0,h.jsx)(n.A,{type:"primary",onClick:()=>{l(!0)},children:"\u6388\u6743"},"button")})]}),(0,h.jsx)(p,{type:c,id:a,visible:o,confirmLoading:d,handleCancel:()=>{l(!1)},handleOk:async e=>{u(!0),e[c]=a;try{i.A.AuthorisedAssets(e)&&l(!1),m.current.reload()}finally{u(!1)}}})]})}},66565:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var s=a(9950),n=a(72381),r=a(6087),i=a(27666),c=a(42074),o=a(75098),l=a(44414);const d=s.createRef(),u=e=>{let{active:t,userId:a}=e;(0,s.useEffect)((()=>{t&&d.current.reload()}),[t]);const n=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u540d\u79f0",dataIndex:"name",render:(e,t)=>(0,l.jsx)(c.N_,{to:"/login-policy/".concat(t.id),children:e})},{title:"\u4f18\u5148\u7ea7",key:"priority",dataIndex:"priority",sorter:!0,hideInSearch:!0},{title:"\u52a8\u4f5c",key:"rule",dataIndex:"rule",hideInSearch:!0,render:e=>"allow"===e?"\u5141\u8bb8":"\u62d2\u7edd"},{title:"\u64cd\u4f5c",valueType:"option",key:"option",render:(e,t,s,n)=>[(0,l.jsx)("a",{onClick:()=>{(async e=>{await o.A.Unbind(e,[{userId:a}]),d.current.reload()})(t.id)},children:"\u89e3\u7ed1"},"edit")]}];return(0,l.jsx)("div",{children:(0,l.jsx)(i.A,{columns:n,actionRef:d,request:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,s="",n="";if(Object.keys(t).length>0&&(s=Object.keys(t)[0],n=Object.values(t)[0]),!a)return{data:[],success:!0,total:0};let r={pageIndex:e.current,pageSize:e.pageSize,name:e.name,userId:a,field:s,order:n},i=await o.A.getPaging(r);return{data:i.items,success:!0,total:i.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10},dateFormatter:"string",headerTitle:"\u7528\u6237\u767b\u5f55\u7b56\u7565",toolBarRender:()=>[]})})};var h=a(83225),g=a(28429),p=a(50070);a(76702);const y=()=>{const e=(0,g.g)().userId,[t,a]=(0,c.ok)();let i=t.get("activeKey");i=i||"info";let[o,d]=(0,s.useState)(i);return(0,l.jsx)("div",{className:"page-detail-warp",children:(0,l.jsxs)(n.A,{activeKey:o,onChange:e=>{d(e),a({activeKey:e})},children:[(0,p.as)("user-detail")&&(0,l.jsx)(n.A.TabPane,{tab:"\u57fa\u672c\u4fe1\u606f",children:(0,l.jsx)(r.A,{active:"info"===o,userId:e})},"info"),(0,p.as)("user-authorised-asset")&&(0,l.jsx)(n.A.TabPane,{tab:"\u6388\u6743\u7684\u8d44\u4ea7",children:(0,l.jsx)(h.A,{active:"asset"===o,id:e,type:"userId"})},"asset"),(0,p.as)("user-login-policy")&&(0,l.jsx)(n.A.TabPane,{tab:"\u767b\u5f55\u7b56\u7565",children:(0,l.jsx)(u,{active:"login-policy"===o,userId:e})},"login-policy")]})})}},6087:(e,t,a)=>{a.d(t,{A:()=>l});var s=a(80575),n=a(91524),r=a(16623),i=a(41920),c=a(98409),o=a(44414);const l=e=>{let{active:t,userId:a}=e,l=(0,i.useQuery)("getUserById",(()=>r.A.getById(a)),{enabled:t&&c.A.hasText(a)}),d=l.data||{};return l.isLoading?(0,o.jsx)("div",{className:"page-detail-info",children:(0,o.jsx)(s.A,{})}):(0,o.jsx)("div",{className:"page-detail-info",children:(0,o.jsxs)(n.A,{title:"\u57fa\u672c\u4fe1\u606f",column:1,children:[(0,o.jsx)(n.A.Item,{label:"\u7528\u6237\u540d",children:d.username}),(0,o.jsx)(n.A.Item,{label:"\u6635\u79f0",children:d.nickname}),(0,o.jsx)(n.A.Item,{label:"\u90ae\u7bb1",children:d.mail}),(0,o.jsx)(n.A.Item,{label:"\u72b6\u6001",children:"enabled"===d.status?"\u5f00\u542f":"\u5173\u95ed"}),(0,o.jsx)(n.A.Item,{label:"\u53cc\u56e0\u7d20\u8ba4\u8bc1",children:d.totpSecret}),(0,o.jsx)(n.A.Item,{label:"\u6765\u6e90",children:"ldap"===d.source?"LDAP":"\u6570\u636e\u5e93"}),(0,o.jsx)(n.A.Item,{label:"\u521b\u5efa\u65f6\u95f4",children:d.created})]})})}},68201:(e,t,a)=>{a.d(t,{A:()=>n});var s=a(50070);const n=e=>{let{menu:t,children:a}=e;if(Array.isArray(t)){if((0,s.as)(...t))return a}else if((0,s.as)(t))return a}},98409:(e,t,a)=>{a.d(t,{A:()=>s});const s=new class{constructor(){this.hasText=function(e){return!(void 0===e||null===e||0===e.length)},this.zeroPad=function(e,t){let a=e.toString();for(;a.length<t;)a="0"+a;return a}}}}}]);