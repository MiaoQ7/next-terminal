(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[8410],{16018:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var a=n(93766),i=n(21215),s=n.n(i);class r{constructor(t){this.group="",this.getById=async t=>{let e=await a.A.get("/".concat(this.group,"/").concat(t));if(1===e.code)return e.data},this.getPaging=async t=>{let e=s().stringify(t),n=await a.A.get("/".concat(this.group,"/paging?").concat(e));return 1!==n.code?{}:n.data},this.getAll=async()=>{let t=await a.A.get("/".concat(this.group));return 1!==t.code?[]:t.data},this.create=async t=>1===(await a.A.post("/".concat(this.group),t)).code,this.updateById=async(t,e)=>1===(await a.A.put("/".concat(this.group,"/").concat(t),e)).code,this.deleteById=async t=>1===(await a.A.delete("/".concat(this.group,"/").concat(t))).code,this.group=t}}},53343:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var a=n(16018),i=n(93766);class s extends a.A{constructor(){super("commands"),this.changeOwner=async(t,e)=>1===(await i.A.post("/".concat(this.group,"/").concat(t,"/change-owner?owner=").concat(e))).code}}const r=new s},40670:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});var a=n(16018),i=n(21215),s=n.n(i),r=n(93766);class c extends a.A{constructor(){super("sessions"),this.GetCommandPagingBySessionId=async(t,e)=>{let n=s().stringify(e),a=await r.A.get("/".concat(this.group,"/").concat(t,"/commands/paging?").concat(n));return 1!==a.code?{}:a.data},this.create=async(t,e)=>{let n=await r.A.post("/".concat(this.group,"?assetId=").concat(t,"&mode=").concat(e));return 1!==n.code?{}:n.data},this.connect=async t=>1===(await r.A.post("/".concat(this.group,"/").concat(t,"/connect"))).code,this.disconnect=async t=>1===(await r.A.post("/".concat(this.group,"/").concat(t,"/disconnect"))).code,this.clear=async()=>1===(await r.A.post("/".concat(this.group,"/clear"))).code,this.stats=async t=>{let e=await r.A.get("/".concat(this.group,"/").concat(t,"/stats"));return 1!==e.code?{}:e.data},this.resize=async(t,e,n)=>1===(await r.A.post("/sessions/".concat(t,"/resize?width=").concat(e,"&height=").concat(n))).code}}const o=new c},52082:(t,e,n)=>{"use strict";var a;n.d(e,{A:()=>i});const i=(a=class t{constructor(t,e){this.type=t,this.content=e}toString(){return this.type+this.content}static parse(e){let n=parseInt(e.substring(0,1)),a=e.substring(1,e.length);return new t(n,a)}},a.Closed=0,a.Connected=1,a.Data=2,a.Resize=3,a.Ping=4,a)},36092:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>E});var a=n(9950),i=n(42074),s=n(53343),r=n(52082),c=n(55902),o=n(68832),l=n(90650),u=n(34999),d=(n(89879),n(40670)),p=n(9437),f=n(88257),g=n(27646),h=n(21215),m=n.n(h),v=n(39608),y=n(94118),A=n(41920),w=n(66212),x=n(98409),S=n(44414);const{Search:b}=c.A,{Content:N}=o.A,E=()=>{let[t,e]=(0,a.useState)([]);const[n,c]=(0,i.ok)();let o=n.get("commandId"),h=(0,A.useQuery)("commandQuery",(()=>s.A.getById(o)),{onSuccess:t=>{let e=t.content.split("\n");e&&k.forEach((t=>{!1===T(t.id)&&z(t.id,e)}))},refetchOnWindowFocus:!1}),[E,C]=(0,a.useState)(""),k=JSON.parse(n.get("assets")),[O,P]=(0,a.useState)(k),j={};for(let a=0;a<k.length;a++)j[k[a].id]=!1,k[a].locked=!1;(0,a.useEffect)((()=>(window.addEventListener("resize",I),function(){window.removeEventListener("resize",I),t.forEach((t=>{t.ws&&t.ws.close(),t.term&&t.term.dispose()}))})),[o]);const I=()=>{t.forEach((t=>{t.fitAddon.fit();let e=t.ws;if(e&&e.readyState===WebSocket.OPEN){let n=t.term,a={cols:n.cols,rows:n.rows};e.send(new r.A(r.A.Resize,window.btoa(JSON.stringify(a))).toString())}}))},T=t=>j[t],z=async(n,a)=>{let i=(await d.A.create(n,"native")).id,s=new p.Terminal({fontFamily:'monaco, Consolas, "Lucida Console", monospace',fontSize:15,theme:{background:"#2d2f2c"},rightClickSelectsWord:!0});const c=new f.FitAddon;s.loadAddon(c),s.open(document.getElementById(n)),c.fit(),s.focus(),s.writeln("Trying to connect to the server ..."),(0,w.I)();let o=(0,g.gf)(),l={cols:s.cols,rows:s.rows,sessionId:i,"X-Auth-Token":o},u=m().stringify(l),h=new WebSocket("".concat(v.IV,"/sessions/").concat(i,"/ssh?").concat(u));var y;s.onData((t=>{h&&h.send(new r.A(r.A.Data,t).toString())})),h.onerror=t=>{s.writeln("Failed to connect to server.")},h.onclose=t=>{s.writeln("Connection is closed.")},h.onmessage=t=>{let e=r.A.parse(t.data);switch(e.type){case r.A.Connected:s.clear(),d.A.connect(i);for(let t=0;t<a.length;t++){let e=a[t];x.A.hasText(e)&&h.send(new r.A(r.A.Data,e+String.fromCharCode(13)).toString())}break;case r.A.Data:s.write(e.content);break;case r.A.Closed:s.writeln("\x1b[1;3;31m".concat(e.content,"\x1b[0m ")),h.close()}},(n=>{t.push(n),e(t.slice())})({id:n,ws:h,term:s,fitAddon:c}),y=!0,j[n]=y};return(0,S.jsxs)("div",{children:[(0,S.jsx)(N,{className:"page-container",children:(0,S.jsx)("div",{className:"page-search",children:(0,S.jsx)(b,{placeholder:"\u8bf7\u8f93\u5165\u6307\u4ee4",value:E,onChange:t=>{let e=t.target.value;C(e)},onSearch:e=>{t.forEach((t=>{let n=t.ws;n.readyState===WebSocket.OPEN&&n.send(new r.A(r.A.Data,e+String.fromCharCode(13)).toString())})),C("")},enterButton:"\u6267\u884c"})})}),(0,S.jsx)(l.A,{spinning:h.isLoading,tip:"\u6b63\u5728\u83b7\u53d6\u6307\u4ee4\u5185\u5bb9...",children:(0,S.jsx)("div",{className:"page-card",children:(0,S.jsx)(u.A,{ghost:!0,gutter:[8,8],wrap:!0,children:O.map((e=>(0,S.jsx)(u.A,{className:"term-container",extra:(0,S.jsx)("div",{style:{cursor:"pointer"},onClick:()=>(e=>{let n=t.find((t=>t.id===e));n.ws.close(),n.term.dispose();let a=O.filter((t=>t.id!==e));P(a)})(e.id),children:(0,S.jsx)(y.A,{})}),title:e.name,layout:"center",headerBordered:!0,size:"small",colSpan:12,bordered:!0,children:(0,S.jsx)("div",{id:e.id,style:{width:"100%",height:"100%"}})},e.id)))})})})]})}},98409:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});const a=new class{constructor(){this.hasText=function(t){return!(void 0===t||null===t||0===t.length)},this.zeroPad=function(t,e){let n=t.toString();for(;n.length<e;)n="0"+n;return n}}}},66212:(t,e,n)=>{"use strict";n.d(e,{I:()=>a});const a=()=>{let t=document.getElementsByClassName("xterm-viewport");for(let e=0;e<t.length;e++){let n,a=t[e];a.addEventListener("scroll",(function(t){a.toggleAttribute("scroll",!0),n&&clearTimeout(n),n=setTimeout((()=>{a.toggleAttribute("scroll")}),500)}))}}},82413:(t,e,n)=>{"use strict";n.d(e,{A:()=>s});var a=n(5544),i=n(9950);function s(){var t=i.useReducer((function(t){return t+1}),0);return(0,a.A)(t,2)[1]}},16661:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var a=n(9950),i=n(82413),s=n(86557);const r=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=(0,a.useRef)({}),n=(0,i.A)();return(0,a.useEffect)((function(){var a=s.Ay.subscribe((function(a){e.current=a,t&&n()}));return function(){return s.Ay.unsubscribe(a)}}),[]),e.current}},90650:(t,e,n)=>{"use strict";n.d(e,{A:()=>S});var a=n(58168),i=n(64467),s=n(23029),r=n(92901),c=n(85501),o=n(52962),l=n(48738),u=n.n(l),d=n(95491),p=n.n(d),f=n(33926),g=n(9950),h=n(5741),m=n(39156),v=n(27895),y=function(t,e){var n={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.indexOf(a)<0&&(n[a]=t[a]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(t);i<a.length;i++)e.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(t,a[i])&&(n[a[i]]=t[a[i]])}return n},A=((0,v.P)("small","default","large"),null);var w=function(t){(0,c.A)(n,t);var e=(0,o.A)(n);function n(t){var r;(0,s.A)(this,n),(r=e.call(this,t)).debouncifyUpdateSpinning=function(t){var e=(t||r.props).delay;e&&(r.cancelExistingSpin(),r.updateSpinning=p()(r.originalUpdateSpinning,e))},r.updateSpinning=function(){var t=r.props.spinning;r.state.spinning!==t&&r.setState({spinning:t})},r.renderSpin=function(t){var e,n=t.direction,s=r.props,c=s.spinPrefixCls,o=s.className,l=s.size,d=s.tip,p=s.wrapperClassName,h=s.style,v=y(s,["spinPrefixCls","className","size","tip","wrapperClassName","style"]),w=r.state.spinning,x=u()(c,(e={},(0,i.A)(e,"".concat(c,"-sm"),"small"===l),(0,i.A)(e,"".concat(c,"-lg"),"large"===l),(0,i.A)(e,"".concat(c,"-spinning"),w),(0,i.A)(e,"".concat(c,"-show-text"),!!d),(0,i.A)(e,"".concat(c,"-rtl"),"rtl"===n),e),o),S=(0,f.A)(v,["spinning","delay","indicator","prefixCls"]),b=g.createElement("div",(0,a.A)({},S,{style:h,className:x,"aria-live":"polite","aria-busy":w}),function(t,e){var n=e.indicator,a="".concat(t,"-dot");return null===n?null:(0,m.zO)(n)?(0,m.Ob)(n,{className:u()(n.props.className,a)}):(0,m.zO)(A)?(0,m.Ob)(A,{className:u()(A.props.className,a)}):g.createElement("span",{className:u()(a,"".concat(t,"-dot-spin"))},g.createElement("i",{className:"".concat(t,"-dot-item")}),g.createElement("i",{className:"".concat(t,"-dot-item")}),g.createElement("i",{className:"".concat(t,"-dot-item")}),g.createElement("i",{className:"".concat(t,"-dot-item")}))}(c,r.props),d?g.createElement("div",{className:"".concat(c,"-text")},d):null);if(r.isNestedPattern()){var N=u()("".concat(c,"-container"),(0,i.A)({},"".concat(c,"-blur"),w));return g.createElement("div",(0,a.A)({},S,{className:u()("".concat(c,"-nested-loading"),p)}),w&&g.createElement("div",{key:"loading"},b),g.createElement("div",{className:N,key:"container"},r.props.children))}return b};var c=t.spinning,o=function(t,e){return!!t&&!!e&&!isNaN(Number(e))}(c,t.delay);return r.state={spinning:c&&!o},r.originalUpdateSpinning=r.updateSpinning,r.debouncifyUpdateSpinning(t),r}return(0,r.A)(n,[{key:"componentDidMount",value:function(){this.updateSpinning()}},{key:"componentDidUpdate",value:function(){this.debouncifyUpdateSpinning(),this.updateSpinning()}},{key:"componentWillUnmount",value:function(){this.cancelExistingSpin()}},{key:"cancelExistingSpin",value:function(){var t=this.updateSpinning;t&&t.cancel&&t.cancel()}},{key:"isNestedPattern",value:function(){return!(!this.props||"undefined"===typeof this.props.children)}},{key:"render",value:function(){return g.createElement(h.TG,null,this.renderSpin)}}]),n}(g.Component);w.defaultProps={spinning:!0,size:"default",wrapperClassName:""};var x=function(t){var e=t.prefixCls,n=(0,g.useContext(h.QO).getPrefixCls)("spin",e),i=(0,a.A)((0,a.A)({},t),{spinPrefixCls:n});return g.createElement(w,(0,a.A)({},i))};x.setDefaultIndicator=function(t){A=t};const S=x},86914:(t,e,n)=>{var a=n(88798),i=/^\s+/;t.exports=function(t){return t?t.slice(0,a(t)+1).replace(i,""):t}},88798:t=>{var e=/\s/;t.exports=function(t){for(var n=t.length;n--&&e.test(t.charAt(n)););return n}},95491:(t,e,n)=>{var a=n(24567),i=n(34378),s=n(72588),r=Math.max,c=Math.min;t.exports=function(t,e,n){var o,l,u,d,p,f,g=0,h=!1,m=!1,v=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var n=o,a=l;return o=l=void 0,g=e,d=t.apply(a,n)}function A(t){var n=t-f;return void 0===f||n>=e||n<0||m&&t-g>=u}function w(){var t=i();if(A(t))return x(t);p=setTimeout(w,function(t){var n=e-(t-f);return m?c(n,u-(t-g)):n}(t))}function x(t){return p=void 0,v&&o?y(t):(o=l=void 0,d)}function S(){var t=i(),n=A(t);if(o=arguments,l=this,f=t,n){if(void 0===p)return function(t){return g=t,p=setTimeout(w,e),h?y(t):d}(f);if(m)return clearTimeout(p),p=setTimeout(w,e),y(f)}return void 0===p&&(p=setTimeout(w,e)),d}return e=s(e)||0,a(n)&&(h=!!n.leading,u=(m="maxWait"in n)?r(s(n.maxWait)||0,e):u,v="trailing"in n?!!n.trailing:v),S.cancel=function(){void 0!==p&&clearTimeout(p),g=0,o=f=l=p=void 0},S.flush=function(){return void 0===p?d:x(i())},S}},24567:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},34378:(t,e,n)=>{var a=n(14759);t.exports=function(){return a.Date.now()}},72588:(t,e,n)=>{var a=n(86914),i=n(24567),s=n(50184),r=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,o=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(s(t))return NaN;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=a(t);var n=c.test(t);return n||o.test(t)?l(t.slice(2),n?2:8):r.test(t)?NaN:+t}}}]);