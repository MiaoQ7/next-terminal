"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[8774],{16018:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(93766),n=s(21215),r=s.n(n);class c{constructor(e){this.group="",this.getById=async e=>{let t=await a.A.get("/".concat(this.group,"/").concat(e));if(1===t.code)return t.data},this.getPaging=async e=>{let t=r().stringify(e),s=await a.A.get("/".concat(this.group,"/paging?").concat(t));return 1!==s.code?{}:s.data},this.getAll=async()=>{let e=await a.A.get("/".concat(this.group));return 1!==e.code?[]:e.data},this.create=async e=>1===(await a.A.post("/".concat(this.group),e)).code,this.updateById=async(e,t)=>1===(await a.A.put("/".concat(this.group,"/").concat(e),t)).code,this.deleteById=async e=>1===(await a.A.delete("/".concat(this.group,"/").concat(e))).code,this.group=e}}},43868:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(93766),n=s(16018);class r extends n.A{constructor(){super("roles"),this.GetAll=async()=>{let e=await a.A.get("/".concat(this.group));return 1!==e.code?[]:e.data}}}const c=new r},16623:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(16018),n=s(93766);class r extends a.A{constructor(){super("users"),this.resetTotp=async e=>1===(await n.A.post("/".concat(this.group,"/").concat(e,"/reset-totp"))).code,this.changePassword=async(e,t)=>{let s=new FormData;return s.set("password",t),1===(await n.A.post("/".concat(this.group,"/").concat(e,"/change-password"),s)).code},this.changeStatus=async(e,t)=>1!==(await n.A.patch("/".concat(this.group,"/").concat(e,"/status?status=").concat(t))).code}}const c=new r},99212:(e,t,s)=>{s.r(t),s.d(t,{default:()=>z});var a=s(9950),n=s(68832),r=s(43637),c=s(56231),i=s(87427),l=s(92759),o=s(55902),d=s(84703),u=s(48538),h=s(87827),A=s(17811),m=s(99674),y=s(16623),g=s(43868),p=s(41920),x=s(98409),v=s(44414);const f={labelCol:{span:6},wrapperCol:{span:14}},j=e=>{var t;let{visible:s,handleOk:n,handleCancel:r,confirmLoading:c,id:l}=e;const[d]=h.A.useForm();let[u,j]=(0,a.useState)("user"),w=(0,p.useQuery)("rolesQuery",g.A.GetAll);return(0,p.useQuery)("userQuery",(()=>y.A.getById(l)),{enabled:s&&x.A.hasText(l),onSuccess:e=>{null===e.roles&&(e.roles=void 0),d.setFieldsValue(e),j(null===e||void 0===e?void 0:e.type)}}),(0,v.jsx)(i.A,{title:l?"\u66f4\u65b0\u7528\u6237":"\u65b0\u5efa\u7528\u6237",visible:s,maskClosable:!1,destroyOnClose:!0,onOk:()=>{d.validateFields().then((async e=>{await n(e)&&d.resetFields()}))},onCancel:()=>{d.resetFields(),r()},confirmLoading:c,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,v.jsxs)(h.A,{form:d,...f,children:[(0,v.jsx)(h.A.Item,{name:"id",noStyle:!0,children:(0,v.jsx)(o.A,{hidden:!0})}),(0,v.jsx)(h.A.Item,{label:"\u767b\u5f55\u8d26\u6237",name:"username",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u767b\u5f55\u8d26\u6237"}],children:(0,v.jsx)(o.A,{autoComplete:"off",placeholder:"\u8bf7\u8f93\u5165\u767b\u5f55\u8d26\u6237"})}),(0,v.jsx)(h.A.Item,{label:"\u6635\u79f0",name:"nickname",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u7528\u6237\u6635\u79f0"}],children:(0,v.jsx)(o.A,{placeholder:"\u8bf7\u8f93\u5165\u6635\u79f0"})}),(0,v.jsx)(h.A.Item,{label:"\u7c7b\u578b",name:"type",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7528\u6237\u89d2\u8272"}],children:(0,v.jsxs)(A.Ay.Group,{onChange:e=>{console.log(e.target.value),j(e.target.value)},children:[(0,v.jsx)(A.Ay,{value:"user",children:"\u666e\u901a\u7528\u6237"}),(0,v.jsx)(A.Ay,{value:"admin",children:"\u7ba1\u7406\u7528\u6237"})]})}),"admin"===u&&(0,v.jsx)(h.A.Item,{label:"\u89d2\u8272",name:"roles",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u7528\u6237\u89d2\u8272"}],children:(0,v.jsx)(m.A,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"\u8bf7\u9009\u62e9\u7528\u6237\u89d2\u8272",children:null===(t=w.data)||void 0===t?void 0:t.map((e=>(0,v.jsx)(m.A.Option,{children:e.name},e.id)))})}),(0,v.jsx)(h.A.Item,{label:"\u90ae\u7bb1",name:"mail",rules:[{required:!1,type:"email",message:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7bb1"}],children:(0,v.jsx)(o.A,{type:"email",placeholder:"\u8bf7\u8f93\u5165\u90ae\u7bb1"})}),l?null:(0,v.jsx)(h.A.Item,{label:"\u767b\u5f55\u5bc6\u7801",name:"password",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u767b\u5f55\u5bc6\u7801"}],children:(0,v.jsx)(o.A,{type:"password",autoComplete:"new-password",placeholder:"\u8f93\u5165\u767b\u5f55\u5bc6\u7801"})})]})})};var w=s(28429),S=s(42074),C=s(43151),k=s(27666),I=s(52998),E=s(27379),b=s(89379);const O={icon:function(e,t){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304z",fill:e}},{tag:"path",attrs:{d:"M232 840h560V536H232v304zm280-226a48.01 48.01 0 0128 87v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 0128-87z",fill:t}},{tag:"path",attrs:{d:"M484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z",fill:e}}]}},name:"lock",theme:"twotone"};var T=s(38913),N=function(e,t){return a.createElement(T.A,(0,b.A)((0,b.A)({},e),{},{ref:t,icon:O}))};N.displayName="LockTwoTone";const L=a.forwardRef(N);var R=s(27891),_=s(50070),G=s(68201);const P=y.A,{Content:F}=n.A,B=a.createRef(),z=()=>{let[e,t]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1),[h,A]=(0,a.useState)(void 0),[m,y]=(0,a.useState)([]);const[g,p]=(0,R.j)(R.A.USER);let f=(0,w.Zp)();const b=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u7528\u6237\u6635\u79f0",dataIndex:"nickname",key:"nickname",sorter:!0,render:(e,t)=>{let s=(0,v.jsx)("div",{children:e});return(0,_.as)("user-detail")&&(s=(0,v.jsx)(S.N_,{to:"/user/".concat(t.id),children:e})),s}},{title:"\u767b\u5f55\u8d26\u53f7",dataIndex:"username",key:"username",sorter:!0},{title:"\u90ae\u7bb1",dataIndex:"mail",key:"mail"},{title:"\u72b6\u6001",dataIndex:"status",key:"status",hideInSearch:!0,render:(e,t,s)=>(0,v.jsx)(r.A,{checkedChildren:"\u542f\u7528",unCheckedChildren:"\u7981\u7528",checked:"disabled"!==e,onChange:e=>{O(t.id,e,s)}})},{title:"\u5728\u7ebf\u72b6\u6001",dataIndex:"online",key:"online",valueType:"radio",sorter:!0,valueEnum:{true:{text:"\u5728\u7ebf",status:"success"},false:{text:"\u79bb\u7ebf",status:"default"}}},{title:"\u521b\u5efa\u65f6\u95f4",key:"created",dataIndex:"created",hideInSearch:!0},{title:"\u64cd\u4f5c",valueType:"option",key:"option",render:(e,s,a,n)=>[(0,v.jsx)(G.A,{menu:"user-edit",children:(0,v.jsx)("a",{onClick:()=>{t(!0),A(s.id)},children:"\u7f16\u8f91"},"edit")},"user-edit"),(0,v.jsx)(G.A,{menu:"user-del",children:(0,v.jsx)(c.A,{title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64\u884c\u5417?",onConfirm:async()=>{await P.deleteById(s.id),B.current.reload()},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",children:(0,v.jsx)("a",{className:"danger",children:"\u5220\u9664"},"delete")},"confirm-delete")},"user-del"),(0,v.jsx)(C.A,{onSelect:e=>{switch(e){case"user-detail":f("/user/".concat(s.id,"?activeKey=info"));break;case"user-authorised-asset":f("/user/".concat(s.id,"?activeKey=asset"));break;case"user-login-policy":f("/user/".concat(s.id,"?activeKey=login-policy"))}},menus:[{key:"user-detail",name:"\u8be6\u60c5",disabled:!(0,_.as)("user-detail")},{key:"user-authorised-asset",name:"\u6388\u6743\u8d44\u4ea7",disabled:!(0,_.as)("user-authorised-asset")},{key:"user-login-policy",name:"\u767b\u5f55\u7b56\u7565",disabled:!(0,_.as)("user-login-policy")}]},"actionGroup")]}],O=async(e,t,s)=>{await P.changeStatus(e,t?"enabled":"disabled"),B.current.reload()},T=()=>{i.A.confirm({title:"\u60a8\u786e\u5b9a\u8981\u91cd\u7f6e\u7528\u6237\u7684\u53cc\u56e0\u7d20\u8ba4\u8bc1\u4fe1\u606f\u5417\uff1f",icon:(0,v.jsx)(E.A,{}),content:"\u91cd\u7f6e\u540e\u7528\u6237\u65e0\u9700\u4e8c\u6b21\u8ba4\u8bc1\u5373\u53ef\u767b\u5f55\u7cfb\u7edf\u3002",onOk:()=>new Promise((async(e,t)=>{await P.resetTotp(m.join(",")),e(),l.Ay.success("\u91cd\u7f6e\u6210\u529f")})).catch((()=>console.log("Oops errors!")))})},N=()=>{let e="";i.A.confirm({title:"\u4fee\u6539\u5bc6\u7801",icon:(0,v.jsx)(L,{}),content:(0,v.jsx)(o.A.Password,{onChange:t=>e=t.target.value,placeholder:"\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801"}),onOk:()=>new Promise((async(t,s)=>{if(!x.A.hasText(e))return s(),void l.Ay.warn("\u8bf7\u8f93\u5165\u5bc6\u7801");await P.changePassword(m.join(","),e),t(),l.Ay.success("\u4fee\u6539\u6210\u529f")})).catch((()=>console.log("Oops errors!")))})};return(0,v.jsxs)(F,{className:"page-container",children:[(0,v.jsx)(k.A,{columns:b,actionRef:B,columnsState:{value:g,onChange:p},rowSelection:{selections:[d.A.SELECTION_ALL,d.A.SELECTION_INVERT],selectedRowKeys:m,onChange:e=>{y(e)}},request:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,s="",a="";Object.keys(t).length>0&&(s=Object.keys(t)[0],a=Object.values(t)[0]);let n={pageIndex:e.current,pageSize:e.pageSize,nickname:e.nickname,username:e.username,mail:e.mail,online:e.online,field:s,order:a},r=await P.getPaging(n);return{data:r.items,success:!0,total:r.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10},dateFormatter:"string",headerTitle:"\u7528\u6237\u5217\u8868",toolBarRender:()=>[(0,v.jsx)(G.A,{menu:"user-add",children:(0,v.jsx)(u.A,{type:"primary",onClick:()=>{t(!0)},children:"\u65b0\u5efa"},"button")}),(0,v.jsx)(G.A,{menu:"user-change-password",children:(0,v.jsx)(u.A,{disabled:I.A.isEmpty(m),onClick:N,children:"\u4fee\u6539\u5bc6\u7801"},"button")}),(0,v.jsx)(G.A,{menu:"user-reset-totp",children:(0,v.jsx)(u.A,{disabled:I.A.isEmpty(m),onClick:T,children:"\u91cd\u7f6e\u53cc\u56e0\u7d20\u8ba4\u8bc1"},"button")})]}),(0,v.jsx)(j,{id:h,visible:e,confirmLoading:s,handleCancel:()=>{t(!1),A(void 0)},handleOk:async e=>{n(!0);try{let s;s=e.id?await P.updateById(e.id,e):await P.create(e),s&&t(!1),B.current.reload()}finally{n(!1)}}})]})}},68201:(e,t,s)=>{s.d(t,{A:()=>n});var a=s(50070);const n=e=>{let{menu:t,children:s}=e;if(Array.isArray(t)){if((0,a.as)(...t))return s}else if((0,a.as)(t))return s}},27891:(e,t,s)=>{s.d(t,{A:()=>c,j:()=>i});var a=s(98409),n=s(9950);let r=new class{constructor(){this.ASSET="cs-asset",this.CREDENTIAL="cs-credential",this.COMMAND="cs-command",this.ACCESS_GATEWAY="cs-access-gateway",this.ONLINE_SESSION="cs-online-session",this.OFFLINE_SESSION="cs-offline-session",this.LOGIN_LOG="cs-login-log",this.STORAGE_LOG="cs-storage-log",this.JOB="cs-job",this.STORAGE="cs-storage",this.LOGIN_POLICY="cs-login-policy",this.ACCESS_SECURITY="cs-access-security",this.USER="cs-user",this.ROLE="cs-role",this.USER_GROUP="cs-user-group",this.COMMAND_FILTER="cs-command-filter",this.STRATEGY="cs-strategy"}};const c=r,i=e=>{let[t,s]=(0,n.useState)(l(e));return[t,t=>{new Promise((e=>{s(t),e(t)})).then((t=>{o(e,t)}))}]},l=e=>{switch(e){case r.ASSET:case r.CREDENTIAL:case r.COMMAND:case r.ACCESS_GATEWAY:case r.ONLINE_SESSION:case r.OFFLINE_SESSION:}return d(e,{})},o=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},d=(e,t)=>{let s=localStorage.getItem(e);if(!a.A.hasText(s))return t;try{return JSON.parse(s)}catch(n){return t}}},52998:(e,t,s)=>{s.d(t,{A:()=>a});const a=new class{constructor(){this.isEmpty=function(e){return!e||0===e.length}}}},98409:(e,t,s)=>{s.d(t,{A:()=>a});const a=new class{constructor(){this.hasText=function(e){return!(void 0===e||null===e||0===e.length)},this.zeroPad=function(e,t){let s=e.toString();for(;s.length<t;)s="0"+s;return s}}}},43151:(e,t,s)=>{s.d(t,{A:()=>p});var a=s(89379),n=s(53986),r=(s(27361),s(48538)),c=(s(84490),s(57811)),i=(s(53552),s(69216)),l=(s(93481),s(4122)),o=s(44414),d=s(94889),u=s(55067),h=s(48738),A=s.n(h),m=s(9950);s.p;var y=["key","name"],g=function(e){var t=e.className,s=e.style,r=e.onSelect,d=e.menus,h=void 0===d?[]:d,g=e.children,p=(0,(0,m.useContext)(l.Ay.ConfigContext).getPrefixCls)("pro-table-dropdown"),x=(0,o.jsx)(i.A,{onClick:function(e){null===r||void 0===r||r(e.key)},items:h.map((function(e){var t=e.key,s=e.name,r=(0,n.A)(e,y);return(0,a.A)((0,a.A)({key:t},r),{},{title:r.title,label:s})}))});return(0,o.jsx)(c.A,{overlay:x,className:A()(p,t),children:(0,o.jsx)("a",{style:s,children:g||(0,o.jsx)(u.A,{})})})};g.Button=function(e){var t=e.children,s=e.menus,a=e.onSelect,n=e.className,u=e.style,h=(0,(0,m.useContext)(l.Ay.ConfigContext).getPrefixCls)("pro-table-dropdown"),y=(0,o.jsx)(i.A,{onClick:function(e){return a&&a(e.key)},items:null===s||void 0===s?void 0:s.map((function(e){return{label:e.name,key:e.key}}))});return(0,o.jsx)(c.A,{overlay:y,className:A()(h,n),children:(0,o.jsxs)(r.A,{style:u,children:[t," ",(0,o.jsx)(d.A,{})]})})};const p=g}}]);