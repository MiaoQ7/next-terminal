"use strict";(self.webpackChunknext_terminal=self.webpackChunknext_terminal||[]).push([[9406],{16018:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(93766),s=n(21215),c=n.n(s);class r{constructor(e){this.group="",this.getById=async e=>{let t=await a.A.get("/".concat(this.group,"/").concat(e));if(1===t.code)return t.data},this.getPaging=async e=>{let t=c().stringify(e),n=await a.A.get("/".concat(this.group,"/paging?").concat(t));return 1!==n.code?{}:n.data},this.getAll=async()=>{let e=await a.A.get("/".concat(this.group));return 1!==e.code?[]:e.data},this.create=async e=>1===(await a.A.post("/".concat(this.group),e)).code,this.updateById=async(e,t)=>1===(await a.A.put("/".concat(this.group,"/").concat(e),t)).code,this.deleteById=async e=>1===(await a.A.delete("/".concat(this.group,"/").concat(e))).code,this.group=e}}},80398:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(16018),s=n(93766);class c extends a.A{constructor(){var e;super("assets"),e=this,this.GetAll=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=await s.A.get("/".concat(e.group,"?protocol=").concat(t));return 1!==n.code?[]:n.data},this.connTest=async e=>{let t=await s.A.post("/".concat(this.group,"/").concat(e,"/tcping"));return 1!==t.code?[!1,t.message]:[t.data.active,t.data.message]},this.importAsset=async e=>{const t=new FormData;t.append("file",e);let n=await s.A.post("/".concat(this.group,"/import"),t,{"Content-Type":"multipart/form-data"});return 1!==n.code?[!1,n.message]:[!0,n.data]},this.changeOwner=async(e,t)=>1===(await s.A.post("/".concat(this.group,"/").concat(e,"/change-owner?owner=").concat(t))).code}}const r=new c},53343:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(16018),s=n(93766);class c extends a.A{constructor(){super("commands"),this.changeOwner=async(e,t)=>1===(await s.A.post("/".concat(this.group,"/").concat(e,"/change-owner?owner=").concat(t))).code}}const r=new c},58706:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(93766);const s=new class{constructor(){this.getAll=async()=>{let e=await a.A.get("/tags");return 1!==e.code?[]:e.data}}}},16623:(e,t,n)=>{n.d(t,{A:()=>r});var a=n(16018),s=n(93766);class c extends a.A{constructor(){super("users"),this.resetTotp=async e=>1===(await s.A.post("/".concat(this.group,"/").concat(e,"/reset-totp"))).code,this.changePassword=async(e,t)=>{let n=new FormData;return n.set("password",t),1===(await s.A.post("/".concat(this.group,"/").concat(e,"/change-password"),n)).code},this.changeStatus=async(e,t)=>1!==(await s.A.patch("/".concat(this.group,"/").concat(e,"/status?status=").concat(t))).code}}const r=new c},50544:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(16018);class s extends a.A{constructor(){super("worker/commands")}}const c=new s},75602:(e,t,n)=>{n.d(t,{K:()=>a});const a={rdp:"cyan",ssh:"blue",telnet:"geekblue",vnc:"purple",kubernetes:"volcano"}},38350:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(9950),s=n(41920),c=n(16623),r=n(87427),i=n(90650),o=n(99674),l=n(44414);const d=e=>{var t;let{lastOwner:n,open:d,handleOk:h,handleCancel:u}=e,[g,A]=(0,a.useState)(!1),[m,p]=(0,a.useState)(n),x=(0,s.useQuery)("usersQuery",c.A.getAll,{enabled:d});return(0,l.jsx)("div",{children:(0,l.jsx)(r.A,{title:"\u66f4\u6362\u6240\u6709\u8005",confirmLoading:g,open:d,onOk:async()=>{A(!0),await h(m),A(!1)},onCancel:u,destroyOnClose:!0,children:(0,l.jsx)(i.A,{spinning:x.isLoading,children:(0,l.jsx)(o.A,{defaultValue:n,style:{width:"100%"},onChange:e=>{p(e)},children:null===(t=x.data)||void 0===t?void 0:t.map((e=>(0,l.jsx)(o.A.Option,{value:e.id,children:e.nickname},e.id)))})})})})}},99406:(e,t,n)=>{n.r(t),n.d(t,{default:()=>G});var a=n(9950),s=n(68832),c=n(56231),r=n(48538),i=n(92759),o=n(27666),l=n(53343),d=n(73175),h=n(50559),u=n(52735),g=n(12916),A=n(99674),m=n(74947),p=n(87427),x=n(84703),w=n(80737),y=n(75602),j=(n(27646),n(4159)),v=n.n(j),S=n(80398),f=n(98409),O=n(41920),I=n(58706),C=n(44414);const{Title:k}=h.A,E=a.createRef(),T=e=>{let{visible:t,handleOk:n,handleCancel:s,confirmLoading:c,id:r}=e,[i,l]=(0,a.useState)([]);const d=(0,O.useQuery)("getAllTag",I.A.getAll),h=[{title:"\u8d44\u4ea7\u540d\u79f0",dataIndex:"name",key:"name",render:(e,t)=>{let n=e;return n&&n.length>20&&(n=n.substring(0,20)+" ..."),(0,C.jsx)(u.A,{placement:"topLeft",title:e,children:n})}},{title:"\u8fde\u63a5\u534f\u8bae",dataIndex:"protocol",key:"protocol",render:(e,t)=>{const n="".concat(t.ip+":"+t.port);return(0,C.jsx)(u.A,{title:n,children:(0,C.jsx)(g.A,{color:y.K[e],children:e})})}},{title:"\u6807\u7b7e",dataIndex:"tags",key:"tags",render:e=>{if(f.A.hasText(e))return e.split(",").filter((e=>"-"!==e)).map((e=>(0,C.jsx)(g.A,{children:e},e)))},renderFormItem:(e,t,n)=>{var a;let{type:s,defaultRender:c,...r}=t;return"form"===s?null:(0,C.jsx)(A.A,{mode:"multiple",allowClear:!0,children:null===(a=d.data)||void 0===a?void 0:a.map((e=>{if("-"!==e)return(0,C.jsx)(A.A.Option,{children:e},e)}))})}},{title:"\u72b6\u6001",dataIndex:"active",key:"active",render:e=>e?(0,C.jsx)(u.A,{title:"\u8fd0\u884c\u4e2d",children:(0,C.jsx)(m.A,{status:"processing",text:"\u8fd0\u884c\u4e2d"})}):(0,C.jsx)(u.A,{title:"\u4e0d\u53ef\u7528",children:(0,C.jsx)(m.A,{status:"error",text:"\u4e0d\u53ef\u7528"})}),renderFormItem:(e,t,n)=>{let{type:a,defaultRender:s,...c}=t;return"form"===a?null:(0,C.jsxs)(A.A,{children:[(0,C.jsx)(A.A.Option,{value:"true",children:"\u8fd0\u884c\u4e2d"}),(0,C.jsx)(A.A.Option,{value:"false",children:"\u4e0d\u53ef\u7528"})]})}},{title:"\u6240\u6709\u8005",dataIndex:"ownerName",key:"ownerName",hideInSearch:!0},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created",key:"created",hideInSearch:!0,render:(e,t)=>(0,C.jsx)(u.A,{title:e,children:v()(e).fromNow()})}];return(0,C.jsx)("div",{children:(0,C.jsxs)(p.A,{title:"\u9009\u62e9\u8d44\u4ea7",visible:t,width:.8*window.innerWidth,centered:!0,onOk:()=>{n(i)},onCancel:s,children:[(0,C.jsxs)("div",{style:{paddingLeft:24,paddingRight:24},children:[(0,C.jsx)(k,{level:5,children:"\u5f85\u6267\u884c\u8d44\u4ea7\u5217\u8868"}),(0,C.jsx)("div",{children:i.map((e=>(0,C.jsx)(g.A,{color:y.K[e.protocol],closable:!0,onClose:()=>(e=>{let t=i.filter((t=>t.id!==e));l(t.slice())})(e.id),children:e.name},e.id)))})]}),(0,C.jsx)(o.A,{columns:h,actionRef:E,rowSelection:{selections:[x.A.SELECTION_ALL,x.A.SELECTION_INVERT]},tableAlertRender:e=>{let{selectedRowKeys:t,selectedRows:n,onCleanSelected:a}=e;return(0,C.jsxs)(w.A,{size:24,children:[(0,C.jsxs)("span",{children:["\u5df2\u9009 ",t.length," \u9879"]}),(0,C.jsx)("span",{children:(0,C.jsx)("a",{onClick:()=>(e=>{e.forEach((e=>{!1===i.some((t=>t.id===e.id))&&i.push(e)})),l(i.slice())})(n),children:"\u52a0\u5165\u5f85\u6267\u884c\u5217\u8868"})}),(0,C.jsx)("span",{children:(0,C.jsx)("a",{onClick:()=>(e=>{e.forEach((e=>{i=i.filter((t=>t.id!==e.id))})),l(i.slice())})(n),children:"\u4ece\u5f85\u6267\u884c\u5217\u8868\u79fb\u9664"})})]})},request:async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,a="",s="";Object.keys(n).length>0&&(a=Object.keys(n)[0],s=Object.values(n)[0]);let c={pageIndex:t.current,pageSize:t.pageSize,name:t.name,protocol:"ssh",active:t.active,tags:null===(e=t.tags)||void 0===e?void 0:e.join(","),field:a,order:s},r=await S.A.getPaging(c);return{data:r.items,success:!0,total:r.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{pageSize:5},dateFormatter:"string",headerTitle:"\u8d44\u4ea7\u5217\u8868"})]})})};var N=n(27891),b=n(68201),L=n(38350);const{Content:R}=s.A,F=l.A,_=a.createRef(),G=()=>{let[e,t]=(0,a.useState)(!1),[n,s]=(0,a.useState)(!1),[l,h]=(0,a.useState)(!1),[u,g]=(0,a.useState)(void 0);const[A,m]=(0,N.j)(N.A.CREDENTIAL);let[p,x]=(0,a.useState)(void 0),[w,y]=(0,a.useState)(!1);const j=[{dataIndex:"index",valueType:"indexBorder",width:48},{title:"\u540d\u79f0",dataIndex:"name"},{title:"\u5185\u5bb9",dataIndex:"content",key:"content",copyable:!0,ellipsis:!0},{title:"\u6240\u6709\u8005",dataIndex:"ownerName",key:"ownerName",hideInSearch:!0},{title:"\u521b\u5efa\u65f6\u95f4",key:"created",dataIndex:"created",hideInSearch:!0},{title:"\u64cd\u4f5c",valueType:"option",key:"option",render:(e,n,a,r)=>[(0,C.jsx)(b.A,{menu:"command-exec",children:(0,C.jsx)("a",{onClick:()=>{t(!0),g(n.id)},children:"\u6267\u884c"},"run")},"command-exec"),(0,C.jsx)(b.A,{menu:"command-edit",children:(0,C.jsx)("a",{onClick:()=>{s(!0),g(n.id)},children:"\u7f16\u8f91"},"edit")},"command-edit"),(0,C.jsx)(b.A,{menu:"command-change-owner",children:(0,C.jsx)("a",{onClick:()=>{v(n)},children:"\u66f4\u6362\u6240\u6709\u8005"},"change-owner")},"command-change-owner"),(0,C.jsx)(b.A,{menu:"command-del",children:(0,C.jsx)(c.A,{title:"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u6b64\u884c\u5417?",onConfirm:async()=>{await F.deleteById(n.id),_.current.reload()},okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",children:(0,C.jsx)("a",{className:"danger",children:"\u5220\u9664"},"delete")},"confirm-delete")},"command-del")]}],v=e=>{x(e),y(!0)};return(0,C.jsxs)(R,{className:"page-container",children:[(0,C.jsx)(o.A,{columns:j,actionRef:_,columnsState:{value:A,onChange:m},request:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n="",a="";Object.keys(t).length>0&&(n=Object.keys(t)[0],a=Object.values(t)[0]);let s={pageIndex:e.current,pageSize:e.pageSize,name:e.name,field:n,order:a},c=await F.getPaging(s);return{data:c.items,success:!0,total:c.total}},rowKey:"id",search:{labelWidth:"auto"},pagination:{defaultPageSize:10},dateFormatter:"string",headerTitle:"\u52a8\u6001\u6307\u4ee4\u5217\u8868",toolBarRender:()=>[(0,C.jsx)(b.A,{menu:"command-add",children:(0,C.jsx)(r.A,{type:"primary",onClick:()=>{s(!0)},children:"\u65b0\u5efa"},"button")})]}),(0,C.jsx)(d.A,{id:u,visible:n,confirmLoading:l,handleCancel:()=>{s(!1),g(void 0)},handleOk:async e=>{h(!0);try{let t;t=e.id?await F.updateById(e.id,e):await F.create(e),t&&s(!1),_.current.reload()}finally{h(!1)}}}),(0,C.jsx)(T,{visible:e,handleCancel:()=>{t(!1),g(void 0)},handleOk:e=>{if(0===e.length)return void i.Ay.warning("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u4e2a\u8d44\u4ea7");let t=e.map((e=>({id:e.id,name:e.name})));window.location.href="#/execute-command?commandId="+u+"&assets="+JSON.stringify(t)}}),(0,C.jsx)(L.A,{lastOwner:null===p||void 0===p?void 0:p.owner,open:w,handleOk:async e=>{await F.changeOwner(null===p||void 0===p?void 0:p.id,e)&&(y(!1),_.current.reload())},handleCancel:()=>{y(!1)}})]})}},73175:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(9950),s=n(55902),c=n(87827),r=n(87427),i=n(53343),o=n(50544),l=n(44414);const d=i.A,{TextArea:h}=s.A,u=e=>{let{visible:t,handleOk:n,handleCancel:i,confirmLoading:u,id:g,worker:A}=e;const[m]=c.A.useForm();return(0,a.useEffect)((()=>{t?g?(async()=>{let e;e=!0===A?await o.A.getById(g):await d.getById(g),e&&m.setFieldsValue(e)})():m.setFieldsValue({}):m.resetFields()}),[t]),(0,l.jsx)(r.A,{title:g?"\u66f4\u65b0\u52a8\u6001\u6307\u4ee4":"\u65b0\u5efa\u52a8\u6001\u6307\u4ee4",visible:t,maskClosable:!1,destroyOnClose:!0,onOk:()=>{m.validateFields().then((async e=>{await n(e)&&m.resetFields()}))},onCancel:()=>{m.resetFields(),i()},confirmLoading:u,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",children:(0,l.jsxs)(c.A,{form:m,labelCol:{span:6},wrapperCol:{span:14},children:[(0,l.jsx)(c.A.Item,{name:"id",noStyle:!0,children:(0,l.jsx)(s.A,{hidden:!0})}),(0,l.jsx)(c.A.Item,{label:"\u6307\u4ee4\u540d\u79f0",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u4ee4\u540d\u79f0"}],children:(0,l.jsx)(s.A,{placeholder:"\u8bf7\u8f93\u5165\u6307\u4ee4\u540d\u79f0"})}),(0,l.jsx)(c.A.Item,{label:"\u6307\u4ee4\u5185\u5bb9",name:"content",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u6307\u4ee4\u5185\u5bb9"}],children:(0,l.jsx)(h,{autoSize:{minRows:5,maxRows:10},placeholder:"\u4e00\u884c\u4e00\u4e2a\u6307\u4ee4"})})]})})}},68201:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(50070);const s=e=>{let{menu:t,children:n}=e;if(Array.isArray(t)){if((0,a.as)(...t))return n}else if((0,a.as)(t))return n}},27891:(e,t,n)=>{n.d(t,{A:()=>r,j:()=>i});var a=n(98409),s=n(9950);let c=new class{constructor(){this.ASSET="cs-asset",this.CREDENTIAL="cs-credential",this.COMMAND="cs-command",this.ACCESS_GATEWAY="cs-access-gateway",this.ONLINE_SESSION="cs-online-session",this.OFFLINE_SESSION="cs-offline-session",this.LOGIN_LOG="cs-login-log",this.STORAGE_LOG="cs-storage-log",this.JOB="cs-job",this.STORAGE="cs-storage",this.LOGIN_POLICY="cs-login-policy",this.ACCESS_SECURITY="cs-access-security",this.USER="cs-user",this.ROLE="cs-role",this.USER_GROUP="cs-user-group",this.COMMAND_FILTER="cs-command-filter",this.STRATEGY="cs-strategy"}};const r=c,i=e=>{let[t,n]=(0,s.useState)(o(e));return[t,t=>{new Promise((e=>{n(t),e(t)})).then((t=>{l(e,t)}))}]},o=e=>{switch(e){case c.ASSET:case c.CREDENTIAL:case c.COMMAND:case c.ACCESS_GATEWAY:case c.ONLINE_SESSION:case c.OFFLINE_SESSION:}return d(e,{})},l=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},d=(e,t)=>{let n=localStorage.getItem(e);if(!a.A.hasText(n))return t;try{return JSON.parse(n)}catch(s){return t}}},98409:(e,t,n)=>{n.d(t,{A:()=>a});const a=new class{constructor(){this.hasText=function(e){return!(void 0===e||null===e||0===e.length)},this.zeroPad=function(e,t){let n=e.toString();for(;n.length<t;)n="0"+n;return n}}}}}]);